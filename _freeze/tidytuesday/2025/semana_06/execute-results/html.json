{
  "hash": "8e3258ee378fd7f29d443e8b8b319187",
  "result": {
    "engine": "knitr",
    "markdown": "---\nformat:\n  html:\n    code-fold: show\n    code-summary: \"Ocultar código\"\n    code-line-numbers: false\n    code-annotations: false\n    code-link: true\n    code-tools:\n        source: true\n        toggle: true\n        caption: \"Código\"\n    code-overflow: scroll\n    page-layout: full\neditor_options:\n  chunk_output_type: console\ncategories: [\"geom_treemap\", \"geom_from_path\"]\nexecute:\n  eval: false\n  echo: true\n  warning: false\ntitle: \"Semana 06\"\ndate: 2025-02-11\nauthor: Víctor Gauto\n---\n\n\n\n\nAgencias de EE.UU. afectadas por la deshabilitación al acceso de bases de datos.\n\n![Semana 06, 2025](semana_06.png)\n\n## Paquetes\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(treemapify)\nlibrary(ggpath)\nlibrary(tidyverse)\n```\n:::\n\n\n\n\n## Estilos\n\nColores\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nc1 <- \"#0A3161\"\nc2 <- \"#B31942\"\nc3 <- \"grey90\"\n```\n:::\n\n\n\n\nFuentes: Ubuntu y JetBrains Mono\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfont_add(\n  family = \"ubuntu\",\n  regular = \"././fuente/Ubuntu-Regular.ttf\",\n  bold = \"././fuente/Ubuntu-Bold.ttf\",\n  italic = \"././fuente/Ubuntu-Italic.ttf\"\n)\n\nfont_add(\n  family = \"jet\",\n  regular = \"././fuente/JetBrainsMonoNLNerdFontMono-Regular.ttf\"\n)\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n```\n:::\n\n\n\n\n## Epígrafe\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfuente <- glue(\n    \"Datos: <span style='color:{c1};'><span style='font-family:jet;'>\",\n    \"{{<b>tidytuesdayR</b>}}</span> semana 06,<br>\",\n    \"<b>CDC datasets</b> en <i>archive.org</i>, Jon Harmon.</span>\"\n)\n\nautor <- glue(\"<span style='color:{c1};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:jet;'>&#xf099;</span>\")\nicon_instagram <- glue(\"<span style='font-family:jet;'>&#xf16d;</span>\")\nicon_github <- glue(\"<span style='font-family:jet;'>&#xf09b;</span>\")\nicon_mastodon <- glue(\"<span style='font-family:jet;'>&#xf0ad1;</span>\")\nicon_bsky <- glue(\"<span style='font-family:jet;'>&#xe28e;</span>\")\nusuario <- glue(\"<span style='color:{c1};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\n    \"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {icon_instagram} \",\n    \"{icon_mastodon} {icon_bsky} {usuario}\"\n)\n```\n:::\n\n\n\n\n## Datos\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata <- tidytuesdayR::tt_load(2025, 06)\ncdc_datasets <- tuesdata$cdc_datasets\nomb_codes <- tuesdata$omb_codes\nfpi_codes <- tuesdata$fpi_codes\n```\n:::\n\n\n\n\n## Procesamiento\n\nMe interesa la proporción de agencias en las bases de datos eliminadas.\n\nLa figura es un [treemap](https://en.wikipedia.org/wiki/Treemapping), que puede generarse con el paquete [`{treemapify}`](https://wilkox.org/treemapify/).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd <- cdc_datasets |>\n  select(bureau_code) |>\n  separate_wider_delim(\n    cols = bureau_code, delim = \":\", names = c(\"agency_code\", \"bureau_code\")\n  ) |>\n  mutate(\n    across(\n      .cols = everything(),\n      .fns = as.numeric\n    )\n  ) |>\n  inner_join(\n    omb_codes, by = join_by(agency_code, bureau_code),\n    relationship = \"many-to-many\") |>\n  select(agency_name, bureau_name) |>\n  count(agency_name, bureau_name, sort = TRUE) |>\n  select(-agency_name) |>\n  mutate(\n    bureau_name = str_wrap(bureau_name, 15)\n  )\n```\n:::\n\n\n\n\nLogos de las agencias y coordenadas para las flechas curvas.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlogos <- c(\n  `Centers for Disease Control and Prevention` = \"https://www.cdc.gov/TemplatePackage/5.0/img/logo/cdc-logo-tag-right.svg\",\n  `Department of Health and Human Services` = \"https://www.hhs.gov/themes/custom/hhs_uswds/logo-desktop.svg\",\n  `Health Resources and Services Administration` = \"https://www.hrsa.gov/themes/hrsa/uswds_hrsa/images/hrsa-logo.png\",\n  `Centers for Medicare and Medicaid Services` = \"https://www.cms.gov/themes/custom/cms_evo/logo.svg\"\n)\n\nlogos_tbl <- tibble(\n  img = logos,\n  x = c(.5, .5, 1.11, 1.11),\n  y = c(.4, .9, .87, 1.03),\n  width = c(.3, .4, .2, .2)\n)\n```\n:::\n\n\n\n\n## Figura\n\nSubtítulo y figura principal\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmi_subtitulo <- glue(\n  \"La gestión actual de EE.UU. comenzó a <span style='color:{c2}'>deshabilitar\",\n  \"</span> el acceso a<br>bases de datos, en particular de agencias de salud \",\n  \"federales.\"\n)\n\ng <- ggplot(d, aes(area = n, label = bureau_name)) +\n  geom_treemap(\n    alpha = 1, layout = \"srow\", linetype = 1, color = c3, size = 1,\n    fill = c1\n  ) +\n  geom_from_path(\n    data = logos_tbl, aes(x, y, path = img, width = width), inherit.aes = FALSE\n  ) +\n  annotate(\n    geom = \"curve\", x = 1.1, y = 1.01, xend = 1.001, yend = .98,\n    curvature = -.1, color = c2, arrow.fill = c2,\n    arrow = arrow(angle = 15, length = unit(5, \"pt\"), type = \"closed\")\n  ) +\n  annotate(\n    geom = \"curve\", x = 1.1, y = .83, xend = 1.001, yend = .8,\n    curvature = -.1, color = c2, arrow.fill = c2,\n    arrow = arrow(angle = 15, length = unit(5, \"pt\"), type = \"closed\")\n  ) +\n  coord_cartesian(\n    xlim = c(0, 1), ylim = c(0, 1), expand = FALSE, clip = \"off\"\n  ) +\n  labs(subtitle = mi_subtitulo, caption = mi_caption) +\n  theme_void() +\n  theme(\n    aspect.ratio = 1,\n    text = element_text(family = \"ubuntu\"),\n    plot.background = element_rect(fill = c3, color = NA),\n    plot.margin = margin(10, 210, 2, 5),\n    plot.subtitle = element_markdown(\n      color = c1, face = \"bold\", size = 20, margin = margin(b = 10),\n      lineheight = 1.2\n    ),\n    plot.caption = element_markdown(\n      color = c2, size = 10, lineheight = 1.4,\n      margin = margin(t = -45, r = -200, l = 10)\n    ),\n    legend.position = \"none\"\n  )\n```\n:::\n\n\n\n\nGuardo\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\n  plot = g,\n  filename = \"tidytuesday/2025/semana_06.png\",\n  width = 30,\n  height = 25,\n  units = \"cm\"\n)\n```\n:::\n",
    "supporting": [
      "semana_06_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}