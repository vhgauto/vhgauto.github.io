{
  "hash": "f146376d19e3b27205f792ef5d6ffe4e",
  "result": {
    "engine": "knitr",
    "markdown": "---\nformat:\n  html:\n    code-fold: show\n    code-summary: \"Ocultar código\"\n    code-line-numbers: false\n    code-annotations: false\n    code-link: true\n    code-tools:\n        source: true\n        toggle: true\n        caption: \"Código\"\n    code-overflow: scroll\n    page-layout: full\neditor_options:\n  chunk_output_type: console\ncategories:\n  - geom_sf\n  - geom_point_svg\n  - geom_image\nexecute:\n  eval: false\n  echo: true\n  warning: false\ntitle: \"Semana 50\"\ndate: last-modified\nauthor: Víctor Gauto\n---\n\nRotondas presentes en Benavidez, Partido de Tigre, Provincia de Buenos Aires.\n\n::: {.column-page-right}\n\n![Semana 50, 2025](semana_50.png)\n\n:::\n\n## Paquetes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(osmdata)\nlibrary(sf)\nlibrary(patchwork)\nlibrary(tidyverse)\n```\n:::\n\n\n## Estilos\n\nColores.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncel <- c(\"#c3f4f6\", \"#6ad5e8\", \"#32b2da\")\ncc <- rev(grey.colors(14))\n```\n:::\n\n\nFuentes: Ubuntu y JetBrains Mono.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfont_add(\n  family = \"ubuntu\",\n  regular = \"././fuente/Ubuntu-Regular.ttf\",\n  bold = \"././fuente/Ubuntu-Bold.ttf\",\n  italic = \"././fuente/Ubuntu-Italic.ttf\"\n)\n\nfont_add(\n  family = \"jet\",\n  regular = \"././fuente/JetBrainsMonoNLNerdFontMono-Regular.ttf\"\n)\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n```\n:::\n\n\n## Epígrafe\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfuente <- glue(\n  \"Datos: <span style='color:{cel[3]};'><span style='font-family:jet;'>\",\n  \"{{<b>tidytuesdayR</b>}}</span> semana 50, \",\n  \"<b>{{roundabouts}}</b>.</span>\"\n)\n\nautor <- glue(\"<span style='color:{cel[3]};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:jet;'>&#xf099;</span>\")\nicon_instagram <- glue(\"<span style='font-family:jet;'>&#xf16d;</span>\")\nicon_github <- glue(\"<span style='font-family:jet;'>&#xf09b;</span>\")\nicon_mastodon <- glue(\"<span style='font-family:jet;'>&#xf0ad1;</span>\")\nicon_bsky <- glue(\"<span style='font-family:jet;'>&#xe28e;</span>\")\nusuario <- glue(\"<span style='color:{cel[3]};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\n  \"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {icon_instagram} \",\n  \"{icon_mastodon} {icon_bsky} {usuario}\"\n)\n```\n:::\n\n\n## Datos\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata <- tidytuesdayR::tt_load(2025, 50)\nroundabouts <- tuesdata$roundabouts_clean\n```\n:::\n\n\n## Procesamiento\n\nMe interesa crear un mapa de Benavidez mostrando las rotondas presentes. Los componentes del mapa provienen de [Open Street Map](https://www.openstreetmap.org/).\n\nCreo funciones para obtener los datos y luego recortar y extraer los vectores.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nf_osm <- function(KEY) {\n  opq(bbox = st_bbox(v)) |>\n    add_osm_feature(key = KEY) |>\n    osmdata_sf()\n}\n\nf_sf <- function(vector, geometria) {\n  vector[[paste0(\"osm_\", geometria)]] |>\n    st_geometry() |>\n    st_crop(bb)\n}\n```\n:::\n\n\nDefino las rotondas de interés y obtengo su extensión.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nv <- roundabouts |>\n  filter(country == \"Argentina\" & town_city == \"Benavídez\") |>\n  st_as_sf(coords = c(\"lat\", \"long\"), crs = \"EPSG:4326\") |>\n  st_geometry()\n\nbb <- st_buffer(v, dist = 500) |>\n  st_bbox() |>\n  st_as_sfc()\n```\n:::\n\n\nObtengo los vectores de los componentes de la región de interés.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nosm_camino <- f_osm(\"highway\") |>\n  f_sf(\"lines\")\nosm_agua1 <- f_osm(\"water\") |>\n  f_sf(\"multipolygons\")\nosm_agua2 <- f_osm(\"waterway\") |>\n  f_sf(\"multilines\")\nosm_natural1 <- f_osm(\"natural\") |>\n  f_sf(\"multipolygons\")\nosm_natural2 <- f_osm(\"natural\") |>\n  f_sf(\"polygons\")\nosm_edificio1 <- f_osm(\"building\") |>\n  f_sf(\"polygons\")\nosm_edificio2 <- f_osm(\"building\") |>\n  f_sf(\"multipolygons\")\nosm_suelo1 <- f_osm(\"landuse\") |>\n  f_sf(\"polygons\")\nosm_suelo2 <- f_osm(\"landuse\") |>\n  f_sf(\"multipolygons\")\nosm_amenity1 <- f_osm(\"amenity\") |>\n  f_sf(\"multipolygons\")\nosm_amenity2 <- f_osm(\"amenity\") |>\n  f_sf(\"polygons\")\nosm_tienda1 <- f_osm(\"shop\") |>\n  f_sf(\"polygons\")\nosm_ocio1 <- f_osm(\"leisure\") |>\n  f_sf(\"multipolygons\")\nosm_ocio2 <- f_osm(\"leisure\") |>\n  f_sf(\"polygons\")\n```\n:::\n\n\n## Figura\n\nVector y mapa de la Provincia de Buenos Aires.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbsas <- geoAr::get_geo(\"BUENOS AIRES\") |>\n  st_geometry() |>\n  st_union()\n\ng_bsas <- ggplot() +\n  geom_sf(data = bsas, fill = cc[7], color = NA) +\n  geom_sf(\n    data = st_centroid(bb),\n    fill = cc[14],\n    size = 4,\n    shape = 21,\n    color = cel[1],\n    stroke = 2\n  ) +\n  theme_void() +\n  theme_sub_plot(\n    background = element_rect(fill = cc[14], color = \"black\", linewidth = 1),\n    margin = margin_auto(0)\n  )\n```\n:::\n\n\nLogo del paquete [{roundabouts}](https://github.com/EmilHvitfeldt/roundabouts) que contiene los datos. Creo un tibble para luego incorporar la figura.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlogo_url <- \"https://raw.githubusercontent.com/EmilHvitfeldt/roundabouts/refs/heads/main/man/figures/logo.png\"\nlogo_tbl <- tibble(\n  image = logo_url,\n  x = I(.96),\n  y = I(1.065)\n)\n```\n:::\n\n\nUtilizo el símbolo {{< iconify fa6-solid:location-pin style=\"color:#32b2da;\" >}} para señalar las rotondas en el mapa.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npin_url <- \"https://api.iconify.design/fa6-solid/location-pin.svg?color=%2332b2da\"\npin_txt <- paste(readLines(pin_url), collapse = \"\\n\")\npin_tbl <- as_tibble(st_coordinates(v))\n```\n:::\n\n\nTítulo y mapa principal.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmi_titulo <- glue(\n  \"<b style='color:{cel[3]}'>Rotondas</b> presentes en **Benavídez**, \n  Partido de Tigre.\"\n)\n\ng <- ggplot() +\n  geom_sf(data = bb, fill = cc[14], color = NA, linewidth = 1) +\n  geom_sf(data = osm_suelo1, fill = cc[1], color = NA) +\n  geom_sf(data = osm_suelo2, fill = cc[2], color = NA) +\n  geom_sf(data = osm_natural1, fill = cc[3], color = NA) +\n  geom_sf(data = osm_natural2, fill = cc[4], color = NA) +\n  geom_sf(data = osm_agua1, fill = cc[5], color = NA) +\n  geom_sf(data = osm_agua2, fill = cc[6], color = cc[6]) +\n  geom_sf(data = osm_edificio1, fill = cc[7], color = NA) +\n  geom_sf(data = osm_edificio2, fill = cc[8], color = NA) +\n  geom_sf(data = osm_amenity1, fill = cc[9], color = NA) +\n  geom_sf(data = osm_amenity2, fill = cc[10], color = NA) +\n  geom_sf(data = osm_camino, color = \"black\", linewidth = 1) +\n  geom_sf(data = osm_tienda1, fill = cc[11], color = NA) +\n  geom_sf(data = osm_ocio1, fill = cc[12], color = NA) +\n  geom_sf(data = osm_ocio2, fill = cc[13], color = NA) +\n  geom_sf(\n    data = v,\n    fill = cel[1],\n    color = cel[2],\n    shape = 21,\n    size = 5,\n    stroke = 1\n  ) +\n  ggsvg::geom_point_svg(\n    data = pin_tbl,\n    aes(X, Y + .0005),\n    svg = pin_txt,\n    size = 4\n  ) +\n  ggimage::geom_image(data = logo_tbl, aes(x, y, image = image), size = .1) +\n  geom_sf(data = bb, fill = NA, color = \"black\", linewidth = 1) +\n  ggspatial::annotation_scale(\n    location = \"bl\",\n    pad_x = unit(0., \"cm\"),\n    pad_y = unit(-.8, \"cm\"),\n    text_col = \"black\"\n  ) +\n  ggspatial::annotation_north_arrow(\n    location = \"tl\",\n    pad_x = unit(5, \"cm\"),\n    pad_y = unit(.1, \"cm\"),\n    height = unit(1.1, \"cm\"),\n    width = unit(1, \"cm\"),\n  ) +\n  coord_sf(expand = FALSE, clip = \"off\") +\n  labs(title = mi_titulo, caption = mi_caption) +\n  theme_void(base_family = \"ubuntu\") +\n  theme_sub_plot(\n    title = element_markdown(hjust = 0, size = 22, margin = margin(b = 15)),\n    caption = element_markdown(\n      color = cc[12],\n      size = 10,\n      lineheight = 1.2,\n      margin = margin(b = -22, t = 22)\n    )\n  )\n```\n:::\n\n\nComposición del mapa principal con el mapa de Buenos Aires.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ng_mapa <- g +\n  inset_element(g_bsas, -0.022, 0.6, .2, 1) +\n  plot_annotation(theme = theme_sub_plot(margin = margin_auto(30)))\n```\n:::\n\n\nGuardo.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\n  plot = ,\n  filename = \"tidytuesday/2025/semana_50.png\",\n  width = 30,\n  height = 22.14,\n  units = \"cm\"\n)\n```\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}