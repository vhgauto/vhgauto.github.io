{
  "hash": "0fa75df668d70b280c9f8e26c2b78d69",
  "result": {
    "engine": "knitr",
    "markdown": "---\nformat:\n  html:\n    code-fold: show\n    code-summary: \"Ocultar código\"\n    code-line-numbers: false\n    code-annotations: false\n    code-link: true\n    code-tools:\n        source: true\n        toggle: true\n        caption: \"Código\"\n    code-overflow: scroll\n    page-layout: full\neditor_options:\n  chunk_output_type: console\ncategories: [\"geom_segment\", \"geom_label\", \"geom_richtext\"]\nexecute:\n  eval: false\n  echo: true\n  warning: false\ntitle: \"Semana 05\"\ndate: 2025-02-04\nauthor: Víctor Gauto\n---\n\n\n\n\nLugares más frecuentes de la familia Simpson.\n\n![Semana 05, 2025](semana_05.png)\n\n## Paquetes\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(tidyverse)\nlibrary(patchwork)\n```\n:::\n\n\n\n\n## Estilos\n\nColores\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nc1 <- \"#7FABD3\"\nc2 <- \"#3573B9\"\nc3 <- \"#273871\"\nc4 <- \"#FED41D\"\nc5 <- \"white\"\n```\n:::\n\n\n\n\nFuentes: Ubuntu y JetBrains Mono\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfont_add(\n  family = \"ubuntu\",\n  regular = \"././fuente/Ubuntu-Regular.ttf\",\n  bold = \"././fuente/Ubuntu-Bold.ttf\",\n  italic = \"././fuente/Ubuntu-Italic.ttf\"\n)\n\nfont_add(\n  family = \"jet\",\n  regular = \"././fuente/JetBrainsMonoNLNerdFontMono-Regular.ttf\"\n)\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n```\n:::\n\n\n\n\n## Epígrafe\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfuente <- glue(\n    \"Datos: <span style='color:{c2};'><span style='font-family:jet;'>\",\n    \"{{<b>tidytuesdayR</b>}}</span> semana 05, \",\n    \"<b>The Simpsons Dataset</b>, Prashant Banerjee.</span>\"\n)\n\nautor <- glue(\"<span style='color:{c2};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:jet;'>&#xf099;</span>\")\nicon_instagram <- glue(\"<span style='font-family:jet;'>&#xf16d;</span>\")\nicon_github <- glue(\"<span style='font-family:jet;'>&#xf09b;</span>\")\nicon_mastodon <- glue(\"<span style='font-family:jet;'>&#xf0ad1;</span>\")\nicon_bsky <- glue(\"<span style='font-family:jet;'>&#xe28e;</span>\")\nusuario <- glue(\"<span style='color:{c2};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\n    \"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {icon_instagram} \",\n    \"{icon_mastodon} {icon_bsky} {usuario}\"\n)\n```\n:::\n\n\n\n\n## Datos\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata <- tidytuesdayR::tt_load(2025, 05)\nlocations <- tuesdata$simpsons_locations\nscript_lines <- tuesdata$simpsons_script_lines\n```\n:::\n\n\n\n\n## Procesamiento\n\nMe interesa asociar lugares a los integrantes principales de la familia <b>Simpson</b>.\n\nCreo un vector con los nombres y links a sus imágenes sacado de Wikipedia.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfamilia <- c(\n  \"Homer Simpson\", \"Lisa Simpson\", \"Bart Simpson\", \"Marge Simpson\",\n  \"Maggie Simpson\"\n)\n\nlink_familia <- c(\n  Homero = \"https://upload.wikimedia.org/wikipedia/en/0/02/Homer_Simpson_2006.png\",\n  Marge = \"https://upload.wikimedia.org/wikipedia/en/0/0b/Marge_Simpson.png\",\n  Bart = \"https://upload.wikimedia.org/wikipedia/en/a/aa/Bart_Simpson_200px.png\",\n  Lisa = \"https://upload.wikimedia.org/wikipedia/en/e/ec/Lisa_Simpson.png\",\n  Maggie = \"https://upload.wikimedia.org/wikipedia/en/9/9d/Maggie_Simpson.png\"\n)\n\nimg_familia <- glue(\"<img src='{link_familia}' height=90 />\") |>\n  as.character()\n\nimg_familia <- set_names(img_familia, names(link_familia))\n```\n:::\n\n\n\n\nFiltro el dataset del guión obteniendo los 5 sitios más frecuentes por cada integrante.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd <- script_lines |>\n  filter(raw_character_text %in% familia) |>\n  count(raw_character_text, location_id) |>\n  inner_join(locations, by = join_by(location_id == id)) |>\n  select(!normalized_name) |>\n  select(\n    personaje = raw_character_text,\n    lugar = name,\n    n\n  ) |>\n  mutate(\n    personaje = str_remove(personaje, \" Simpson\")\n  ) |>\n  mutate(\n    personaje = if_else(personaje == \"Homer\", \"Homero\", personaje)\n  ) |>\n  mutate(\n    personaje = fct(\n      personaje, levels = c(\"Homero\", \"Marge\", \"Bart\", \"Lisa\", \"Maggie\")\n    )\n  ) |>\n  arrange(personaje, n) |>\n  mutate(\n    puesto = row_number(), .by = personaje\n  ) |>\n  arrange(personaje, puesto) |>\n  mutate(\n    p = n/sum(n),\n    .by = personaje\n  ) |>\n  mutate(\n    puesto = factor(puesto)\n  ) |>\n  mutate(\n    img = img_familia[personaje]\n  ) |>\n  mutate(\n    lugar = str_to_sentence(lugar)\n  ) |>\n  mutate(\n    hjust = if_else(lugar == \"Simpson home\", 1.1, 0)\n  ) |>\n  mutate(\n    relleno = if_else(lugar == \"Simpson home\", c3, c2)\n  ) |>\n  slice_max(order_by = puesto, n = 5, by = personaje, with_ties = FALSE)\n```\n:::\n\n\n\n\nTraduzco los lugares\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd <- d |>\n  mutate(\n    lugar = case_match(\n      lugar,\n      \"Simpson home\" ~ \"Domicilio Simpson\",\n      \"Springfield nuclear power plant\" ~ \"Planta nuclear Springfield\",\n      \"Moe's tavern\" ~ \"Taverna de Moe\",\n      \"Springfield street\" ~ \"Calle de Springfield\",\n      \"Homer's car\" ~ \"Auto de Homero\",\n      \"Evergreen terrace\" ~ \"Techo del domicilio\",\n      \"Simpson master bedroom\" ~ \"Habitación del matrimonio\",\n      \"Marge's car\" ~ \"Auto de Marge\",\n      \"Mother hubbard's sandwich cupboard\" ~ \"Sandwich Armario de la Madre Hubbard\",\n      \"Outer concourse\" ~ \"Afuera del vestíbulo\",\n      \"Olympic village\" ~ \"Villa Olímpica\",\n      \"First church of springfield\" ~ \"1ra Iglesia de Springfield\",\n      \"Springfield elementary school\" ~ \"Escuela Primaria de Springfield\",\n      \"Bart's bedroom\" ~ \"Habitación de Bart\",\n      \"Bart's treehouse\" ~ \"Casita del árbol de Bart\",\n      \"Lisa's bedroom\" ~ \"Habitación de Lisa\",\n      \"Parking structure\" ~ \"Estacionamiento\",\n      \"Springfield zoo\" ~ \"Zoológico de Springfield\",\n      .default = lugar\n    )\n  )\n```\n:::\n\n\n\n\n\n## Figura\n\nGenero un tibble para las etiquetas del eje horizontal.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\neje_x <- tibble(\n  x = seq(.1, .7, .1), y = .5\n) |>\n  mutate(\n    label = paste0(x*100, \"%\")\n  )\n```\n:::\n\n\n\n\nFigura principal.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ng <- ggplot(d, aes(p, puesto)) +\n  geom_segment(\n    aes(x = 0, xend = p, yend = puesto), linewidth = 15, color = c3\n  ) +\n  geom_label(\n    aes(label = lugar, hjust = hjust, fill = I(relleno)),\n    size = 12, size.unit = \"pt\", color = c5, family = \"ubuntu\",\n    label.size = 0, fontface = \"bold\"\n  ) +\n  geom_richtext(\n    aes(I(1), I(.7), label = img), fill = NA, label.color = NA, hjust = 1,\n    vjust = 0\n  ) +\n  labs(caption = mi_caption) +\n  facet_wrap(\n    vars(personaje), ncol = 2, scales = \"free\", strip.position = \"left\",\n    dir = \"h\"\n  ) +\n  scale_x_continuous(\n    breaks = seq(.1, .8, .1),\n    expand = c(.01, 0),\n    labels = scales::label_percent()\n  ) +\n  scale_y_discrete(\n    expand = c(0, .6)\n  ) +\n  coord_cartesian(clip = \"off\") +\n  theme_void() +\n  theme(\n    aspect.ratio = .6,\n    text = element_text(size = 10),\n    plot.margin = margin(t = 15,  b = 15),\n    plot.background = element_rect(fill = c1, color = NA),\n    plot.caption = element_markdown(\n      family = \"ubuntu\", size = 11, color = c3, lineheight = 1.1,\n      margin = margin(t = -20, b = 0, r = 20)\n    ),\n    axis.text.x = element_text(\n      family = \"jet\", color = c5, size = 8, margin = margin(t = -12), hjust = 1\n    ),\n    panel.background = element_rect(fill = c2, color = NA),\n    panel.spacing = unit(1.5, \"line\"),\n    panel.grid.major.x = element_line(\n      color = c1, linewidth = .1, linetype = \"FF\"\n    ),\n    strip.text = element_blank()\n  )\n```\n:::\n\n\n\n\nAgrego sobre la figura principal el título y subtítulo utilizando `patchwork`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmi_titulo <- glue(\n  \"En la familia <span style='color:{c4}'>Simpson</span><br>todo queda en casa\"\n)\n\nmi_subtitulo <- \"Top 5 de lugares en los que aparece<br>\n  cada integrante de la familia\"\n\nh <- ggplot() +\n  annotate(\n    geom = \"richtext\", x = 0, y = c(0, -.9), color = c5, size = c(13, 7),\n    label = c(mi_titulo, mi_subtitulo), family = \"ubuntu\", fontface = \"bold\",\n    lineheight = 1, hjust = 0, fill = NA, label.color = NA\n  ) +\n  coord_cartesian(\n    expand = FALSE, xlim = c(-.02, 1), ylim = c(-1, .5), clip = \"off\"\n  ) +\n  theme_void() +\n  theme(\n    aspect.ratio = .3\n  )\n\ni <- g +\n  inset_element(\n    h,\n    left = .5,\n    bottom = -.01,\n    right = 1,\n    top = .5,\n    align_to = \"full\",\n    clip = FALSE\n  ) +\n  plot_annotation(\n    theme = theme_void()\n  )\n```\n:::\n\n\n\n\nGuardo\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\n  plot = i,\n  filename = \"tidytuesday/2025/semana_05.png\",\n  width = 30,\n  height = 28,\n  units = \"cm\"\n)\n```\n:::\n",
    "supporting": [
      "semana_05_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}