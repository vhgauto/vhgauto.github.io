{
  "hash": "a66732ebe5e9a36353ccc09eeb06ab84",
  "result": {
    "engine": "knitr",
    "markdown": "---\nformat:\n  html:\n    code-fold: show\n    code-summary: \"Ocultar código\"\n    code-line-numbers: false\n    code-annotations: false\n    code-link: true\n    code-tools:\n        source: true\n        toggle: true\n        caption: \"Código\"\n    code-overflow: scroll\n    page-layout: full\neditor_options:\n  chunk_output_type: console\ncategories:\n  - geom_label\n  - geom_line\n  - geom_point\nexecute:\n  eval: false\n  echo: true\n  warning: false\ntitle: \"Semana 31\"\ndate: last-modified\nauthor: Víctor Gauto\n---\n\nEvaluación del **Índice Gini** para una selección de países.\n\n![Semana 31, 2025](semana_31.mp4){loop=\"true\"}\n\n## Paquetes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(gganimate)\nlibrary(tidyverse)\n```\n:::\n\n\n## Estilos\n\nColores.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nc1 <- \"#134130\"\nc2 <- \"#E6AB02\"\nc3 <- \"black\"\nc4 <- \"white\"\n\ncol <- RColorBrewer::brewer.pal(name = \"Dark2\", n = 8)\n```\n:::\n\n\nFuentes: Ubuntu y JetBrains Mono.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfont_add(\n  family = \"ubuntu\",\n  regular = \"././fuente/Ubuntu-Regular.ttf\",\n  bold = \"././fuente/Ubuntu-Bold.ttf\",\n  italic = \"././fuente/Ubuntu-Italic.ttf\"\n)\n\nfont_add(\n  family = \"jet\",\n  regular = \"././fuente/JetBrainsMonoNLNerdFontMono-Regular.ttf\"\n)\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n```\n:::\n\n\n## Epígrafe\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn <- \"<span style='color: white'> . </span>\"\nfuente <- glue(\"Our{n}World{n}in{n}Data\")\nautor <- glue(\"<span style='color:{c2};'>**Víctor{n}Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:jet;'>&#xf099;</span>\")\nicon_instagram <- glue(\"<span style='font-family:jet;'>&#xf16d;</span>\")\nicon_github <- glue(\"<span style='font-family:jet;'>&#xf09b;</span>\")\nicon_mastodon <- glue(\"<span style='font-family:jet;'>&#xf0ad1;</span>\")\nicon_bsky <- glue(\"<span style='font-family:jet;'>&#xe28e;</span>\")\nusuario <- glue(\"<span style='color:{c2};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\"{fuente}<br>{autor}{n}{sep}{n}{usuario}\")\n```\n:::\n\n\n## Datos\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata <- tidytuesdayR::tt_load(2025, 31)\ninequality_processed <- tuesdata$income_inequality_processed\n```\n:::\n\n\n## Procesamiento\n\nMe interesa la evolución del [Índice Gini](https://es.wikipedia.org/wiki/Coeficiente_de_Gini) en los países con mayor registro.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntop_pais <- inequality_processed |> \n  count(Entity, sort = TRUE) |> \n  filter(n >= 30) |> \n  filter(Entity != \"Brazil\") |> \n  pull(Entity)\n\ntop_paise_trad <- c(\n  \"EE.UU.\", \"Reino Unido\", \"Canadá\", \"Alemania\", \"Luxemburgo\",\n  \"Francia\", \"España\"\n)\n\ntop_paise_trad <- set_names(top_paise_trad, top_pais)\n\nd <- inequality_processed |> \n  filter(Entity %in% top_pais) |> \n  mutate(pais = top_paise_trad[Entity])\n```\n:::\n\n\n## Figura\n\nTítulo y figura.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmi_titulo <- glue(\n  \"El **Índice Gini** indica{n}la desigualdad{n}del{n}país.<br>\n  Cuanto{n}más bajo, \n  más igualitaria{n}es la sociedad.\"\n)\n\ng <- ggplot(d, aes(Year, gini_dhi_eq, color = pais, fill = pais, group = pais)) +\n  geom_label(\n    aes(label = pais), hjust = 0, size = 4, size.unit = \"pt\", nudge_x = .5,\n    color = c3, family = \"ubuntu\", label.size = 0\n  ) +\n  geom_line(linewidth = .8, lineend = \"round\") +\n  geom_point(size = 1, shape = 21, color = c4) +\n  scale_x_continuous(breaks = scales::breaks_width(10)) +\n  scale_y_continuous(limits = c(.2, .4), expand = c(0, 0)) +\n  scale_color_manual(values = alpha(col, .5)) +\n  scale_fill_manual(values = alpha(col, .5)) +\n  coord_cartesian(clip = \"off\") +\n  labs(\n    x = NULL,\n    y = \"Índice Gini, luego de impuestos\",\n    title = mi_titulo,\n    caption = mi_caption\n  ) +\n  theme_classic(base_size = 5, base_family = \"ubuntu\") +\n  theme(\n    aspect.ratio = 1,\n    plot.margin = margin(r = 22, l = 5),\n    plot.background = element_blank(),\n    plot.title = element_markdown(color = c1, size = rel(1.2)),\n    plot.caption = element_markdown(),\n    axis.text = element_text(color = c1, family = \"jet\"),\n    axis.text.y = element_text(vjust = 0),\n    axis.title = element_text(color = c1),\n    axis.ticks = element_blank(),\n    axis.line = element_blank(),\n    panel.background = element_blank(),\n    panel.grid.major = element_line(\n      color = c1, linewidth = .1, linetype = \"FF\"\n    ),\n    legend.position = \"none\"\n  ) +\n  transition_reveal(Year) +\n  enter_fade() +\n  exit_shrink() +\n  ease_aes('sine-in-out')\n```\n:::\n\n\nGenero la animación y almaceno.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- animate(\n  plot = g, renderer = av_renderer(), width = 1000, height = 1000, res = 300\n)\n\nanim_save(filename = \"tidytuesday/2025/semana_31.mp4\", animation = p)\n```\n:::\n\n",
    "supporting": [
      "semana_31_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}