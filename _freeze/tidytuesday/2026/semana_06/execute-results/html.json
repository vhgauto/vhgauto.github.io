{
  "hash": "bd67a289e4213094313923b0ad84dc03",
  "result": {
    "engine": "knitr",
    "markdown": "---\nformat:\n  html:\n    code-fold: show\n    code-summary: \"Ocultar código\"\n    code-line-numbers: false\n    code-annotations: false\n    code-link: true\n    code-tools:\n        source: true\n        toggle: true\n        caption: \"Código\"\n    code-overflow: scroll\n    page-layout: full\neditor_options:\n  chunk_output_type: console\ncategories:\n  - geom_spatraster_rgb\n  - geom_spatvector\nexecute:\n  eval: false\n  echo: true\n  warning: false\ntitle: \"Semana 06\"\ndate: last-modified\nauthor: Víctor Gauto\n---\n\nMapas RGB de las ciudades en las que ocurren los **JJ. OO. de Invierno 2026**, Milano y Cortina.\n\n::: {.column-screen-inset}\n\n![Semana 06, 2026](semana_06.png)\n\n:::\n\n## Paquetes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(terra)\nlibrary(tidyterra)\nlibrary(ggspatial)\nlibrary(patchwork)\nlibrary(tidyverse)\n```\n:::\n\n\n## Estilos\n\nColores.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nc1 <- \"#05a3bd\"\nc2 <- \"#da7900\"\nc3 <- \"white\"\nc4 <- \"grey95\"\nc5 <- \"grey30\"\nc6 <- \"grey98\"\n```\n:::\n\n\nFuentes: Ubuntu y JetBrains Mono.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfont_add(\n  family = \"ubuntu\",\n  regular = \"././fuente/Ubuntu-Regular.ttf\",\n  bold = \"././fuente/Ubuntu-Bold.ttf\",\n  italic = \"././fuente/Ubuntu-Italic.ttf\"\n)\n\nfont_add(\n  family = \"jet\",\n  regular = \"././fuente/JetBrainsMonoNLNerdFontMono-Regular.ttf\"\n)\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n```\n:::\n\n\n## Epígrafe\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfuente <- glue(\n  \"Datos: <span style='color:{c1};'><span style='font-family:jet;'>\",\n  \"{{<b>tidytuesdayR</b>}}</span> semana 06, \",\n  \"<b>XXV Olympic Winter Games | Milano Cortina 2026</b>.</span>\"\n)\n\nautor <- glue(\"<span style='color:{c1};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:jet;'>&#xf099;</span>\")\nicon_instagram <- glue(\"<span style='font-family:jet;'>&#xf16d;</span>\")\nicon_github <- glue(\"<span style='font-family:jet;'>&#xf09b;</span>\")\nicon_mastodon <- glue(\"<span style='font-family:jet;'>&#xf0ad1;</span>\")\nicon_bsky <- glue(\"<span style='font-family:jet;'>&#xe28e;</span>\")\nusuario <- glue(\"<span style='color:{c1};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\n  \"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {icon_instagram} \",\n  \"{icon_mastodon} {icon_bsky} {usuario}\"\n)\n```\n:::\n\n\n## Datos\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata <- tidytuesdayR::tt_load(2026, 06)\nschedule <- tuesdata$schedule\n```\n:::\n\n\n## Procesamiento\n\nMe interesa señalar las ciudades de los JJ.OO., Milano y Cortina, en un mapa de Italia, y mostrar mapas satelitales para cada una.\n\nCreo un vector con el nombre de las ciudades, para obtener los datos y generar los mapas. Asigno colores, obtengo las coordenadas y creo vector.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nciudades <- c(\"Cortina d'Ampezzo\", \"Milano\")\n\nciudades_col <- c(c1, c2)\nciudades_col <- set_names(ciudades_col, ciudades)\n\ncortina <- c(12.137351, 46.538333)\nmilan <- c(9.19, 45.466944)\n\ndf <- data.frame(\n  lon = c(12.137351, 9.19),\n  lat = c(46.538333, 45.466944),\n  ciudad = ciudades\n)\n\np <- vect(df, geom = c(\"lon\", \"lat\"), crs = \"EPSG:4326\")\n```\n:::\n\n\nVectores de Italia y de las ciudades.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nit4 <- rgeoboundaries::geoboundaries(country = \"ITA\", adm_lvl = 4) |>\n  terra::vect()\n\nit1 <- rgeoboundaries::geoboundaries(country = \"ITA\", adm_lvl = 1) |>\n  terra::vect()\n\nv <- it4[it4$shapeName %in% ciudades]\n```\n:::\n\n\nFunción para generar un vector buffer circular alrededor de las ciudades.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nf_bb <- function(X) {\n  v <- v[v$shapeName == X]\n  centro <- centroids(v)\n  buffer(centro, width = width(v) * .8, quadsegs = 1000)\n}\n```\n:::\n\n\nFunción para obtener ráster RGB de los buffer de las ciudades.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nf_rgb <- function(X) {\n  b <- f_bb(X)\n\n  maptiles::get_tiles(\n    x = b,\n    provider = \"Esri.WorldImagery\",\n    crop = TRUE,\n    zoom = 13\n  ) |>\n    mask(b)\n}\n```\n:::\n\n\nEjecuto para ambas ciudades y asigno nombres.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nl_rgb <- map(ciudades, f_rgb)\nl_rgb <- set_names(l_rgb, ciudades)\n```\n:::\n\n\n## Figura\n\nFunción para generar los mapas de cada ciudad.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nf_gg <- function(X) {\n  colorX <- if (X == \"Milano\") ciudades_col[2] else ciudades_col[1]\n  locationX <- if (X == \"Milano\") \"br\" else \"bl\"\n\n  ggplot() +\n    geom_spatraster_rgb(\n      data = l_rgb[[X]],\n      maxcell = prod(dim(l_rgb[[X]]))\n    ) +\n    geom_spatvector(\n      data = v[v$shapeName == X],\n      fill = NA,\n      color = colorX,\n      linetype = 1,\n      linewidth = .6\n    ) +\n    geom_spatvector(\n      data = v[v$shapeName == X],\n      fill = NA,\n      color = c3,\n      linetype = 2,\n      linewidth = .6\n    ) +\n    geom_spatvector(\n      data = f_bb(X),\n      fill = NA,\n      color = colorX,\n      linewidth = 1\n    ) +\n    annotation_scale(\n      location = locationX,\n      bar_cols = c(c3, colorX),\n      height = unit(.2, \"cm\"),\n      line_col = colorX,\n      text_family = \"jet\"\n    ) +\n    coord_sf(clip = \"off\") +\n    labs(title = X) +\n    theme_void(base_family = \"ubuntu\") +\n    theme_sub_plot(\n      title = element_text(\n        hjust = .5,\n        face = \"bold\",\n        size = 15,\n        color = colorX,\n        margin = margin_auto(0)\n      )\n    )\n}\n```\n:::\n\n\nGenero los mapas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nl_gg <- map(ciudades, f_gg)\n```\n:::\n\n\nMapa de Italia señalando las ciudades.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_it <- ggplot() +\n  geom_spatvector(\n    data = it1,\n    fill = c4,\n    color = c5,\n    linewidth = .2\n  ) +\n  geom_spatvector(\n    data = v,\n    aes(fill = shapeName),\n    color = NA,\n    show.legend = FALSE\n  ) +\n  annotate(\n    geom = \"segment\",\n    x = I(c(.48, .23)),\n    xend = I(c(.65, .1)),\n    y = I(c(.92, .84)),\n    yend = I(c(.98, .95)),\n    arrow = arrow(angle = 20, length = unit(5, \"pt\"), type = \"closed\")\n  ) +\n  annotate(\n    geom = \"label\",\n    x = I(c(.65, .1)),\n    y = I(c(.98, .95)),\n    label = ciudades,\n    fill = NA,\n    border.color = NA,\n    fontface = \"bold\",\n    family = \"ubuntu\",\n    hjust = .5,\n    vjust = 0,\n    color = ciudades_col,\n    size = 3\n  ) +\n  coord_sf(clip = \"off\", expand = TRUE) +\n  scale_fill_manual(\n    values = ciudades_col\n  ) +\n  theme_void()\n```\n:::\n\n\nLogo de los JJ. OO. para incorporar a la figura.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlogo <- \"https://upload.wikimedia.org/wikipedia/commons/7/71/2026_Winter_Olympics_logo_%28Energy%29.svg\"\nlogo_txt <- paste(readLines(logo), collapse = \"\\n\")\n```\n:::\n\n\nCombino los mapas y agrego el logo.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ng <- wrap_plots(\n  list(gg_it, l_gg[[1]], l_gg[[2]]),\n  nrow = 1\n) +\n  annotation_custom(\n    ggsvg::svg_to_rasterGrob(logo_txt),\n    xmin = I(-2),\n    xmax = I(-2.3),\n    ymin = I(.2),\n    ymax = I(-.1)\n  ) &\n  plot_annotation(\n    title = glue(\n      \"Durante los <b style='color:{c1};'>JJ. OO. de Invierno 2026</b> se van a disputar <b style='color:{c2};'>{nrow(schedule)}</b> eventos deportivos\"\n    ),\n    caption = mi_caption,\n    theme = theme(\n      plot.title = element_markdown(\n        family = \"ubuntu\",\n        size = 21,\n        hjust = .5,\n        margin = margin_auto(10)\n      ),\n      plot.caption = element_markdown(\n        family = \"ubuntu\",\n        color = c2,\n        size = 8,\n        lineheight = 1.3,\n        margin = margin(t = 5, b = 3)\n      ),\n      plot.background = element_rect(fill = c6, color = NA)\n    )\n  )\n```\n:::\n\n\nGuardo.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\n  plot = g,\n  filename = \"tidytuesday/2026/semana_06.png\",\n  width = 30,\n  height = 12,\n  units = \"cm\"\n)\n```\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}