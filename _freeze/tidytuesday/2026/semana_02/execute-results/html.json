{
  "hash": "285d8adb4863f34e19f86cfcce90d2be",
  "result": {
    "engine": "knitr",
    "markdown": "---\nformat:\n  html:\n    code-fold: show\n    code-summary: \"Ocultar código\"\n    code-line-numbers: false\n    code-annotations: false\n    code-link: true\n    code-tools:\n        source: true\n        toggle: true\n        caption: \"Código\"\n    code-overflow: scroll\n    page-layout: full\neditor_options:\n  chunk_output_type: console\ncategories:\n  - geom_spatvector\nexecute:\n  eval: false\n  echo: true\n  warning: false\ntitle: \"Semana 02\"\ndate: last-modified\nauthor: Víctor Gauto\n---\n\n[Lenguajes de África](https://en.wikipedia.org/wiki/Languages_of_Africa), ordenados por cantidad de personas que los hablan.\n\n::: {.column-page-right}\n\n![Semana 02, 2026](semana_02.mp4)\n\n:::\n\n## Paquetes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(tidyverse)\n```\n:::\n\n\n## Estilos\n\nColores de la [bandera panafricana](https://en.wikipedia.org/wiki/Pan-African_flag).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nc1 <- \"#AC3E48\"\nc2 <- \"#000000\"\nc3 <- \"#00863D\"\n```\n:::\n\n\nFuentes: Ubuntu, JetBrains Mono y Anton.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfont_add(\n  family = \"ubuntu\",\n  regular = \"././fuente/Ubuntu-Regular.ttf\",\n  bold = \"././fuente/Ubuntu-Bold.ttf\",\n  italic = \"././fuente/Ubuntu-Italic.ttf\"\n)\n\nfont_add(\n  family = \"jet\",\n  regular = \"././fuente/JetBrainsMonoNLNerdFontMono-Regular.ttf\"\n)\n\nfont_add_google(\n  name = \"Anton\",\n  family = \"anton\"\n)\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n```\n:::\n\n\n## Epígrafe\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfuente <- glue(\n  \"Datos: <span style='color:{c1};'><span style='font-family:jet;'>\",\n  \"{{<b>tidytuesdayR</b>}}</span> semana 02, \",\n  \"<b>Languages of Africa, Wikipedia</b>.</span>\"\n)\n\nautor <- glue(\"<span style='color:{c1};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:jet;'>&#xf099;</span>\")\nicon_instagram <- glue(\"<span style='font-family:jet;'>&#xf16d;</span>\")\nicon_github <- glue(\"<span style='font-family:jet;'>&#xf09b;</span>\")\nicon_mastodon <- glue(\"<span style='font-family:jet;'>&#xf0ad1;</span>\")\nicon_bsky <- glue(\"<span style='font-family:jet;'>&#xe28e;</span>\")\nusuario <- glue(\"<span style='color:{c1};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\n  \"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {icon_instagram} \",\n  \"{icon_mastodon} {icon_bsky} {usuario}\"\n)\n```\n:::\n\n\n## Datos\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata <- tidytuesdayR::tt_load(2026, 02)\nafrica <- tuesdata$africa\n```\n:::\n\n\n## Procesamiento\n\nMe interesa visualizar todos los idiomas, ordenados por la cantidad de hablantes, con una animación en `.mp4`.\n\nAgrego estilo al número de posición y lenguaje.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd <- africa |>\n  reframe(s = sum(native_speakers), .by = language) |>\n  mutate(language = str_wrap(language, 20)) |>\n  mutate(language = str_replace(language, \"\\\\n\", \"<br>\")) |>\n  mutate(language = fct_reorder(language, s)) |>\n  mutate(language = fct_rev(language)) |>\n  arrange(desc(language)) |>\n  mutate(id = row_number()) |>\n  mutate(\n    label = glue(\n      \"<span style='color:#4d4d4d;font-size:8pt;'>{id}. </span>\",\n      \"<b style='font-size:9pt;'>{language}</b>\"\n    )\n  )\n```\n:::\n\n\nMapa del continente africano.\n\n\n::: {.cell}\n\n```{.r .cell-code}\naf <- filter(rnaturalearth::ne_countries(), continent == \"Africa\") |>\n  terra::vect() |>\n  terra::aggregate()\n```\n:::\n\n\n## Figura\n\nColores para cada idioma.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncol <- rep(\n  colorRampPalette(c(c1, c2, c3))(20),\n  length.out = nrow(d)\n)\n```\n:::\n\n\nFunción para generar y almacenar cada fotograma de la animación.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nf_gg <- function(i) {\n  ii <- str_pad(as.character(i), width = 3, pad = \"0\")\n  g <- ggplot() +\n    tidyterra::geom_spatvector(\n      data = af,\n      fill = \"grey95\",\n      color = NA\n    ) +\n    annotate(\n      geom = \"richtext\",\n      x = I(.5),\n      y = I(seq(1, 0, length.out = 10)),\n      label = filter(d, between(id, i, i + 9))$label,\n      fill = NA,\n      color = col[i],\n      lineheight = 0,\n      family = \"anton\",\n      label.padding = unit(7, \"lines\"),\n      label.color = NA\n    ) +\n    coord_sf(clip = \"off\", expand = FALSE) +\n    labs(\n      title = glue(\n        \"Los lenguajes de <b style='color: {c1};'>ÁFRICA</b>\"\n      ),\n      caption = mi_caption\n    ) +\n    theme_void(base_family = \"ubuntu\", base_size = 5) +\n    theme_sub_axis_y(text = element_blank()) +\n    theme_sub_plot(\n      background = element_rect(fill = \"grey80\"),\n      title = element_markdown(\n        color = c3,\n        size = 10,\n        margin = margin(t = 3, b = 8)\n      ),\n      caption = element_markdown(\n        margin = margin(t = 10, b = 1),\n        color = c3,\n        hjust = .5\n      )\n    )\n\n  ggsave(\n    g,\n    filename = paste0(\"tidytuesday/2026/.semana_02/\", ii, \".png\"),\n    width = 700,\n    height = 700,\n    units = \"px\",\n    dpi = 300\n  )\n  cat(\"\\n--\", ii, \"--\\n\")\n}\n```\n:::\n\n\nItero para todos los idiomas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nti <- 1\ntf <- nrow(d) - 9\nwalk(ti:tf, f_gg)\n```\n:::\n\n\nGenero el video a partir de los `.png`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nav::av_encode_video(\n  input = list.files(\n    \"tidytuesday/2026/.semana_02/\",\n    full.names = TRUE\n  ),\n  output = \"tidytuesday/2026/semana_02.mp4\",\n  framerate = 7\n)\n```\n:::\n\n\nElimino las figuras individuales.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunlink(\"tidytuesday/2026/.semana_02/\", recursive = TRUE)\n```\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}