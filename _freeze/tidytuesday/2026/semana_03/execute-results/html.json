{
  "hash": "2210a30d76fd28af01fdc17c36fee236",
  "result": {
    "engine": "knitr",
    "markdown": "---\nformat:\n  html:\n    code-fold: show\n    code-summary: \"Ocultar código\"\n    code-line-numbers: false\n    code-annotations: false\n    code-link: true\n    code-tools:\n        source: true\n        toggle: true\n        caption: \"Código\"\n    code-overflow: scroll\n    page-layout: full\n    auto-play-media: true\neditor_options:\n  chunk_output_type: console\nexecute:\n  eval: false\n  echo: true\n  warning: false\ntitle: \"Semana 03\"\ndate: last-modified\nauthor: Víctor Gauto\n---\n\nAnimación de imágenes de [Astronomy Picture of the Day](https://apod.nasa.gov/apod/astropix.html) relacionadas a **Argentina**.\n\n::: {.column-page-right}\n\n![Semana 03, 2026](semana_03.mp4){loop=True}\n\n:::\n\n## Paquetes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(tidyverse)\nlibrary(magick)\n```\n:::\n\n\n## Estilos\n\nColores.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nc1 <- \"#000000\"\nc2 <- \"#000000\"\nc3 <- \"#000000\"\n```\n:::\n\n\n## Epígrafe\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmi_caption <- \"Selección de fotografías asociadas a ARGENTINA \\n {tidytuesdayR} semana 3 | Víctor Gauto | @vhgauto\"\n```\n:::\n\n\n## Datos\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata <- tidytuesdayR::tt_load(2026, 03)\napod <- tuesdata$apod\n```\n:::\n\n\n## Procesamiento\n\nMe interesan sólamente aquellas imágenes asociadas a **Argentina** y crear una animación con todas ellas.\n\nSelecciono imágenes que en su descripción mencionen **Argentina**, creo una columna para identificar la imagen y remuevo saltos de línea al inicio y final del copyright.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd <- apod |>\n  filter(str_detect(explanation, \"Argentina\")) |>\n  select(copyright, date, url) |>\n  mutate(id = str_pad(row_number(), width = 2, pad = \"0\")) |>\n  drop_na() |>\n  mutate(copyright = str_remove(copyright, \"\\n\")) |>\n  mutate(copyright = str_remove(copyright, \"\\n$\"))\n```\n:::\n\n\nSelecciono las columnas de identificación de cada imagen y la URL. Descargo todas las imágenes disponibles.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npwalk(\n  select(d, id, url),\n  \\(id, url) {\n    download.file(\n      url = url,\n      destfile = paste0(\"tidytuesday/2026/.test/\", id, \".jpg\"),\n      mode = \"wb\",\n      quiet = TRUE\n    )\n    cat(id, \"\\n\")\n  }\n)\n```\n:::\n\n\n## Figura\n\nFunción que toma cada imagen descargada y obtiene su tamaño. De acuerdo a la relación altura/ancho, se define el nuevo tamaño de la imagen. Luego, se extiende a un tamaño unificado (1000x1300) y se añaden anotaciones: título, copyright, fecha, descripción y fuente.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nf_image <- function(i) {\n  ii <- str_pad(i, width = 2, pad = \"0\")\n  lista_img <- list.files(\"tidytuesday/2026/.test/\", full.names = TRUE)\n  ancho <- image_read(path = lista_img[i]) |>\n    image_info() |>\n    pull(width)\n\n  alto <- image_read(path = lista_img[i]) |>\n    image_info() |>\n    pull(height)\n\n  if (ancho >= alto) {\n    geo <- \"1000x\"\n  } else {\n    geo <- \"x1000\"\n  }\n\n  image_read(\n    path = list.files(\"tidytuesday/2026/.test/\", full.names = TRUE)[i]\n  ) |>\n    image_scale(geometry = geo) |>\n    image_extent(\"1200x1300\", color = 'white') |>\n    image_annotate(\n      text = \"Astronomy Picture of the Day\",\n      size = 50,\n      font = \"Times\",\n      gravity = \"north\",\n      location = \"+0+10\",\n      weight = 800\n    ) |>\n    image_annotate(\n      text = paste0(d$copyright[i], \" | \", d$date[i]),\n      size = 20,\n      font = \"Trebuchet\",\n      gravity = \"northwest\",\n      location = \"+10+70\"\n    ) |>\n    image_annotate(\n      text = mi_caption,\n      size = 20,\n      font = \"Trebuchet\",\n      gravity = \"southeast\",\n      location = \"+10+10\"\n    ) |>\n    image_write(paste0(\"tidytuesday/2026/.test2/\", ii, \".jpg\"))\n  cat(ii, \"\\n\")\n}\n```\n:::\n\n\nEjecuto para todas las imágenes disponibles.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwalk(1:nrow(d), f_image)\n```\n:::\n\n\nCreo la animación a partir de todas las imágenes generadas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nav::av_encode_video(\n  input = list.files(\"tidytuesday/2026/.test2/\", full.names = TRUE),\n  output = \"tidytuesday/2026/semana_03.mp4\",\n  framerate = 2\n)\n```\n:::\n\n\nElimino todas las figuras creadas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunlink(\"tidytuesday/2026/.test2/\", recursive = TRUE)\n```\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}