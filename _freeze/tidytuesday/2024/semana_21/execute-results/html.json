{
  "hash": "ade8bacf9c2de6b4785ca1a1ffed779b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 21\"\nsubtitle: \"Figura semana 21\"\nauthor: Víctor Gauto\ndate: \"2024-05-27\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_col, geom_hline]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2024/s21/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(tidyverse)\n\n# fuente ------------------------------------------------------------------\n\n# colores\nc1 <- \"#312A56\"\nc2 <- \"#11C638\"\nc3 <- \"#95D69A\"\nc4 <- \"#EF9708\"\nc5 <- \"#F0BC95\"\nc6 <- \"#E2E2E2\"\n\n# fuente: Ubuntu\nfont_add(\n  family = \"ubuntu\", \n  regular = \"fuente/Ubuntu-Regular.ttf\",\n  bold = \"fuente/Ubuntu-Bold.ttf\",\n  italic = \"fuente/Ubuntu-Italic.ttf\")\n\n# monoespacio & íconos\nfont_add(\n  family = \"jet\", \n  regular = \"fuente/JetBrainsMonoNLNerdFontMono-Regular.ttf\")\n\n# bebas\nfont_add(\n  family = \"bebas\",\n  regular = \"fuente/BebasNeue-Regular.ttf\"\n)\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# caption\nfuente <- glue(\n  \"Datos: <span style='color:{c3};'><span style='font-family:jet;'>\",\n  \"{{<b>tidytuesdayR</b>}}</span> semana {21}, \",\n  \"Carbon Majors.</span>\")\nautor <- glue(\"<span style='color:{c3};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:jet;'>&#xf099;</span>\")\nicon_instagram <- glue(\"<span style='font-family:jet;'>&#xf16d;</span>\")\nicon_github <- glue(\"<span style='font-family:jet;'>&#xf09b;</span>\")\nicon_mastodon <- glue(\"<span style='font-family:jet;'>&#xf0ad1;</span>\")\nusuario <- glue(\"<span style='color:{c3};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\n  \"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {icon_instagram} \",\n  \"{icon_mastodon} {usuario}\")\n\n# datos -------------------------------------------------------------------\n\ntuesdata <- tidytuesdayR::tt_load(2024, 21)\nemissions <- tuesdata$emissions\n\n# me interesa la relación entre las emisiones de empresas privadas y estatales\n\nd <- emissions |> \n  filter(parent_type != \"Nation State\") |> \n  reframe(\n    s = sum(total_emissions_MtCO2e),\n    .by = c(year, parent_type)\n  ) |> \n  filter(year >= 1900) |> \n  rename(\n    año = year,\n    tipo = parent_type\n  )\n\n# año en el que las empresas estatales superan el 50% de las emisiones de CO2\nd_50 <- d |>\n  pivot_wider(\n    names_from = tipo,\n    values_from = s\n  ) |> \n  mutate(\n    tot = `State-owned Entity` + `Investor-owned Company`\n  ) |> \n  mutate(\n    estatal = `State-owned Entity`/tot,\n    privado = `Investor-owned Company`/tot\n  ) |> \n  arrange(año) |> \n  filter(between(estatal, .49, .52))\n\n# figura ------------------------------------------------------------------\n\n# subtítulo y aclaración\nmi_subtitle <- glue(\n  \"Las empresas productoras de cemento, petróleo, gas y carbón son grandes<br>\",\n  \" generadoras de CO<sub>2</sub>. Desde el s. XX, la proporción de las \",\n  \"emisiones causadas<br>por empresas <b style='color: {c4};'>estatales</b>\",\n  \" ha aumentado respecto de las <b style='color: {c2};'>privadas</b>.\"\n)\n\nmi_label <- glue(\n  \"A partir del <b>{d_50$año}</b>, las empresas \n  <b style='color: {c4};'>estatales</b><br>\",\n  \"han producido más del <b>50%</b> de las emisiones.\"\n)\n\n# figura\ng <- ggplot(d, aes(año, s, fill = tipo, color = tipo)) +\n  geom_col(position = position_fill(), linewidth = .5, alpha = 1, color = c1) +\n  geom_hline(\n    yintercept = .5, color = c6, linewidth = 1, alpha = .6, linetype = \"33\") +\n  annotate(\n    geom = \"richtext\", x = 1945, y = .6, hjust = .5, vjust = 0, \n    color = c6, family = \"ubuntu\", size = 6, label = mi_label, fill = c1, \n    label.color = NA, label.r = unit(0, \"mm\"), label.padding = unit(5, \"mm\")\n  ) +\n  annotate(\n    geom = \"curve\", x = 1975, y = .6, xend = d_50$año-1, yend = d_50$estatal,\n    color = c6, linewidth = 1,\n    arrow = arrow(length = unit(3, \"mm\"), type = \"closed\", angle = 20)\n  ) +\n  scale_x_continuous(\n    breaks = scales::breaks_width(20)\n  ) +\n  scale_y_continuous(\n    breaks = scales::breaks_width(.25),\n    labels = scales::label_percent()\n  ) +\n  scale_fill_manual(\n    values = c(c2, c4)\n  ) +\n  coord_cartesian(expand = FALSE) +\n  labs(subtitle = mi_subtitle, caption = mi_caption) +\n  theme_void() +\n  theme(\n    aspect.ratio = 1,\n    plot.margin = margin(22, 30, 10, 23),\n    plot.background = element_rect(fill = c1, color = c3, linewidth = 3),\n    plot.subtitle = element_markdown(\n      family = \"ubuntu\", size = 20, margin = margin(b = 20), color = c6,\n      lineheight = unit(1.3, \"line\")\n    ),\n    plot.caption = element_markdown(\n      family = \"ubuntu\", color = c5, size = 15, margin = margin(t = 25),\n      lineheight = unit(1.3, \"line\")\n    ),\n    panel.grid.major = element_line(\n      color = c6, linewidth = .2, linetype = \"44\"\n    ),\n    axis.text.x = element_text(\n      family = \"bebas\", size = 30, color = c6, margin = margin(t = 10)\n    ),\n    axis.text.y = element_text(\n      family = \"jet\", size = 15, color = c6, margin = margin(r = 10), vjust = 0,\n      hjust = 1\n    ),\n    legend.position = \"none\"\n  )\n\n# guardo\nggsave(\n  plot = g,\n  filename = \"2024/s21/viz.png\",\n  width = 30,\n  height = 34,\n  units = \"cm\")\n\n# abro\nbrowseURL(\"2024/s21/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2024/s21/viz.png)\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}