{
  "hash": "50d5f47df8bc2e204d83085f674b0320",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 06\"\nsubtitle: \"Figura semana 06\"\nauthor: Víctor Gauto\ndate: \"2024-02-12\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_sf, geom_segment, geom_richtext]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2024/s06/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\nMapa de Patrimonios de la Humanidad de UNESCO, inspirado en esta [figura](https://100.datavizproject.com/data-type/viz46/) de [1 dataset, 100 visualizations](https://100.datavizproject.com/).\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(sf)\nlibrary(patchwork)\nlibrary(tidyverse)\n\n# fuente ------------------------------------------------------------------\n\n# colores\nc1 <- \"#3274DA\"\nc2 <- \"#F05440\"\nc3 <- \"#1B9E77\"\nc4 <- \"#D95F02\"\nc5 <- \"#7570B3\"\nc6 <- \"grey95\"\nc7 <- \"grey90\"\nc8 <- \"grey80\"\nc9 <- \"grey40\"\nc10 <- \"black\"\nc11 <- \"white\"\n\n# fuente: Ubuntu\nfont_add(\n  family = \"ubuntu\", \n  regular = \"fuente/Ubuntu-Regular.ttf\",\n  bold = \"fuente/Ubuntu-Bold.ttf\",\n  italic = \"fuente/Ubuntu-Italic.ttf\")\n\n# fuente: Victor\nfont_add(\n  family = \"victor\", \n  regular = \"fuente/VictorMono-ExtraLight.ttf\",\n  bold = \"fuente/VictorMono-VariableFont_wght.ttf\",\n  italic = \"fuente/VictorMono-ExtraLightItalic.ttf\")\n\n# íconos\nfont_add(\"fa-brands\", \"icon/Font Awesome 6 Brands-Regular-400.otf\")\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# caption\nfuente <- glue(\n  \"Datos: <span style='color:{c2};'><span style='font-family:mono;'>\",\n  \"{{<b>tidytuesdayR</b>}}</span> semana {6}. \",\n  \"UNESCO World Heritage Sites.</span>\")\nautor <- glue(\"<span style='color:{c2};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:fa-brands;'>&#xf099;</span>\")\nicon_github <- glue(\"<span style='font-family:fa-brands;'>&#xf09b;</span>\")\nicon_mastodon <- glue(\"<span style='font-family:fa-brands;'>&#xf4f6;</span>\")\nusuario <- glue(\"<span style='color:{c2};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\n  \"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {icon_mastodon} \n  {usuario}\")\n\n# datos -------------------------------------------------------------------\n\ntuesdata <- tidytuesdayR::tt_load(2024, 6)\nheritage <- tuesdata$heritage |> \n  rename(pais = country)\n\n# quiero visualizar la geografía de Europa, con los países resaltados y la \n# cantidad de sitios, por año, por país\n\n# creo un buffer alrededor del centroide de Noruega\nnoruega <- rnaturalearth::ne_countries(\n  country = \"Norway\",\n  scale = \"medium\",\n  returnclass = \"sf\") |> \n  select(pais = sovereignt) |> \n  st_make_valid() |> \n  st_transform(crs = 7005)\n\nnoruega_centro <- st_union(noruega) |> \n  st_make_valid() |> \n  st_centroid()\n\ncentro_buffer <- st_buffer(noruega_centro, dist = 1.8e6, nQuadSegs = 5000) |> \n  st_transform(crs = 7005) |>\n  st_make_valid() |> \n  terra::vect()\n\n# vector de países de Europa\neuropa <- rnaturalearth::ne_countries(\n  continent = \"europe\",\n  scale = \"large\",\n  returnclass = \"sf\") |> \n  select(pais = sovereignt) |> \n  st_transform(crs = 7005) |>\n  st_make_valid() |> \n  terra::vect()\n\n# obtengo un recorte de Europa al buffer\neuropa_crop <- terra::crop(europa, centro_buffer) |>\n  st_as_sf() |> \n  # remuevo Francia, para evitar problemas con sus territorios de ultramar\n  filter(pais != \"France\") |> \n  group_by(pais) |> \n  summarise(geometry = st_union(geometry))\n\n# logo de patrimonios de UNESCO\nlogo <- \"<img src='2024/s06/logo.png' width=20></img>\"\n\n# combino los datos de Europa y heritage\nd <- inner_join(heritage, europa_crop, by = join_by(pais)) |> \n  mutate(color = c(c1, c2, c3)) |> \n  st_as_sf()\n\nd_centro <- d |> \n  mutate(centro = st_centroid(geometry, of_largest_polygon = FALSE)) |> \n  as_tibble() |> \n  select(-geometry) |> \n  st_as_sf()\n\n# sitios de los que salen las líneas\nd_capitales <- tibble(\n  pais = d_centro$pais) |> \n  mutate(\n    x = c(-1e6, -1.3e6, -.9e6),\n    y = c(7.1e6, 6.6e6, 6.7e6)) |> \n  st_as_sf(coords = c(\"x\", \"y\")) |> \n  st_set_crs(value = 7005)\n\n# longitud de las líneas\nlargo_linea <- 1.2e6\n\n# anotaciones de las cantidades de patrimonios de UNESCO\nd_lineas <- d_capitales |> \n  st_coordinates() |> \n  as_tibble() |> \n  mutate(pais = d_capitales$pais, .before = 1) |> \n  mutate(\n    xend = case_match(\n      pais,\n      \"Norway\" ~ X,\n      \"Denmark\" ~ X - largo_linea*.3,\n      \"Sweden\" ~ X + largo_linea*.8)) |> \n  mutate(\n    yend = case_match(\n      pais,\n      \"Norway\" ~ Y + largo_linea*.7,\n      \"Denmark\" ~ Y,\n      \"Sweden\" ~ Y)) |> \n  mutate(\n    año_2004 = d$`2004`,\n    año_2022 = d$`2022`) |> \n  mutate(label = glue(\n    \"{logo}<span style='color:{c1}'>{año_2004}</span><br>\",\n    \"{logo}<span style='color:{c2}'>{año_2022}</span>\")) |> \n  mutate(\n    hjust = c(.5, 1, 0),\n    vjust = c(0, 0, .5))\n\n# figura ------------------------------------------------------------------\n\n# etiquetas de los países, leyenda\nlabel_pais <- c(\"Dinamarca\", \"Noruega\", \"Suecia\") |> str_to_upper()\nlabel_color <- c(c3, c4, c5)\nlabel_leyenda <- glue(\"<p style='color:{label_color}'>{label_pais}</p>\")\n\n# anotación de los años\nbb <- st_bbox(centro_buffer)\nlabel_año <- glue(\n  \"{logo}<span style='color:{c1}'>2004</span><br>\",\n  \"{logo}<span style='color:{c2}'>2022</span>\")\n\n# logo UNESCO\nlogo_unesco <- \"<img src='2024/s06/unesco_logo.png' width=120></img>\"\n\n# figura\ng <- ggplot() +\n  # océano\n  geom_sf(\n    data = st_as_sf(centro_buffer), fill = c6, color = NA) +\n  # Europa\n  geom_sf(data = europa_crop, fill = c8, color = c11) +\n  # Noruega, Dinamarca, Suecia\n  geom_sf(data = d, aes(fill = pais), color = NA) +\n  # Europa, contorno\n  geom_sf(data = europa_crop, fill = NA, color = c11) +\n  # círculo externo\n  geom_sf(\n    data = st_as_sf(centro_buffer), fill = NA, color = c9, linewidth = .5) +\n  # puntos origen de las líneas\n  geom_sf(data = d_capitales, size = 2) +\n  # líneas\n  geom_segment(\n    data = d_lineas, aes(X, Y, xend = xend, yend = yend), color = c10) +\n  # heritage\n  geom_richtext(\n    data = d_lineas, \n    aes(xend, yend, label = label, hjust = hjust, vjust = vjust),\n    fill = c11, label.color = c10, size = 7, family = \"victor\",\n    label.r = unit(0, \"mm\"), label.size = unit(.5, \"mm\")) +\n  # años\n  annotate(\n    geom = \"richtext\", x = bb[\"xmax\"], y = bb[\"ymax\"], label = label_año, \n    fill = c11, label.color = NA, hjust = 1, vjust = 1, family = \"victor\",\n    size = 7) +\n  # logo UNESCO\n  annotate(\n    geom = \"richtext\", x = bb[\"xmin\"], y = bb[\"ymax\"], label = logo_unesco, \n    fill = NA, label.color = NA, hjust = 0, vjust = .8, \n    size = 13) +\n  scale_fill_brewer(palette = \"Dark2\", labels = label_leyenda) +\n  coord_sf(clip = \"off\") +\n  labs(caption = mi_caption, fill = NULL) +\n  guides(fill = guide_legend(override.aes = list(fill = NA))) +\n  theme_void() +\n  theme(\n    aspect.ratio = 1,\n    plot.margin = margin(r = 3.3, l = 3.3),\n    plot.background = element_rect(fill = c7, color = c9, linewidth = 3),\n    plot.caption = element_markdown(\n      family = \"ubuntu\", color = c1, size = 13, \n      margin = margin(b = 10, r = 10)),\n    legend.position = c(0, 0),\n    legend.justification = c(0, 0),\n    legend.direction = \"vertical\",\n    legend.text = element_markdown(family = \"ubuntu\", color = c10, size = 25),\n    legend.key.size = unit(2, \"line\")\n  )\n\n# guardo\nggsave(\n  plot = g,\n  filename = \"2024/s06/viz.png\",\n  width = 30,\n  height = 31,\n  units = \"cm\")\n\n# abro\nbrowseURL(\"2024/s06/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2024/s06/viz.png)\n\n\n",
    "supporting": [
      "semana_06_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}