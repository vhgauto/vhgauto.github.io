{
  "hash": "04e09affabcf7532d7c3a6350140b052",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 43\"\nsubtitle: \"Figura semana 43\"\nauthor: Víctor Gauto\ndate: \"2024-10-28\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_vline, geom_col, geom_richtext, argentina]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2024/s43/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\nPosición Argentina en superficie, acceso a internet, población y expectativa de vida.\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(glue)\nlibrary(ggtext)\nlibrary(ggh4x)\nlibrary(showtext)\nlibrary(tidytext)\nlibrary(tidyverse)\n\n# fuente ------------------------------------------------------------------\n\n# colores\ncol <- MoMAColors::moma.colors(palette_name = \"Smith\")\n# col <- MoMAColors::moma.colors(palette_name = \"Budnitz\")\nc1 <- \"grey40\"\nc2 <- \"white\"\n\n# fuente: Ubuntu\nfont_add(\n  family = \"ubuntu\", \n  regular = \"fuente/Ubuntu-Regular.ttf\",\n  bold = \"fuente/Ubuntu-Bold.ttf\",\n  italic = \"fuente/Ubuntu-Italic.ttf\"\n)\n\n# monoespacio & íconos\nfont_add(\n  family = \"jet\", \n  regular = \"fuente/JetBrainsMonoNLNerdFontMono-Regular.ttf\"\n)\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# caption\nfuente <- glue(\n  \"Datos: <span style='color:{col[4]};'><span style='font-family:jet;'>\",\n  \"{{<b>tidytuesdayR</b>}}</span> semana {43}, \",\n  \"<b>CIA World Factbook</b>.</span>\"\n)\nautor <- glue(\"<span style='color:{col[4]};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:jet;'>&#xf099;</span>\")\nicon_instagram <- glue(\"<span style='font-family:jet;'>&#xf16d;</span>\")\nicon_github <- glue(\"<span style='font-family:jet;'>&#xf09b;</span>\")\nicon_mastodon <- glue(\"<span style='font-family:jet;'>&#xf0ad1;</span>\")\nusuario <- glue(\"<span style='color:{col[4]};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\n  \"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {icon_instagram} \",\n  \"{icon_mastodon} {usuario}\"\n)\n\n# datos -------------------------------------------------------------------\n\ntuesdata <- tidytuesdayR::tt_load(2024, 43)\ncia <- tuesdata$cia_factbook\n\n# me interesa la posición de Argentina respecto del resto de los países\n\n# parámetros de interés y sus traducciones\nparam_c <- c(\"area\", \"life_exp_at_birth\", \"population\", \"internet_ratio\")\nparam_trad <- c(\n  glue(\"<b style='color: {col[1]}'>Superficie (km<sup>2</sup>)</b>\"),\n  glue(\"<b style='color: {col[2]}'>Expectativa de vida</b>\"),\n  glue(\"<b style='color: {col[3]}'>Población</b>\"),\n  glue(\"<b style='color: {col[4]}'>Población que usa internet (%)</b>\")\n)\nnames(param_trad) <- param_c\n\n# acomodo los datos y obtengo el porcentaje de personas con internet\nd <- cia |> \n  select(country, area, internet_users, life_exp_at_birth, population) |> \n  mutate(\n    internet_ratio = internet_users/population*100\n  ) |> \n  drop_na() |> \n  pivot_longer(\n    cols = -country,\n    names_to = \"param\",\n    values_to = \"valor\"\n  ) |> \n  mutate(\n    arg = if_else(\n      country == \"Argentina\",\n      \"Arg\",\n      param\n    )\n  ) |> \n  filter(param != \"internet_users\") |> \n  mutate(trad = param_trad[param])\n\n# figura ------------------------------------------------------------------\n\n# cantidad de países y grilla de posiciones\nn_pais <- length(unique(d$country))\n\ngrid_label <- tibble(\n  x = 1:n_pais,\n  y = Inf,\n  label = rev(x)\n) |> \n  filter(label == label - (label %% 25) | x == n_pais) |> \n  mutate(label = glue(\"#{label}\"))\n\n# escalas individuales del eje vertical (facetas)\nejes_y <- list(\n  # espectativa de vida\n  scale_y_continuous(\n    breaks = seq(0, 100, 20),\n    limits = c(0, 100),\n    expand = c(0, 0)\n  ),\n  # población\n  scale_y_log10(\n    breaks = 10^(0:9),\n    limits = c(1, 10^9),\n    labels = format(\n      10^(0:9), scientific = FALSE, big.mark = \".\", decimal.mark = \",\"\n    )\n  ),\n  # internet\n  scale_y_continuous(\n    breaks = seq(0, 100, 20),\n    limits = c(0, 100),\n    expand = c(0, 0)\n  ),\n  # superficie\n  scale_y_log10(\n    breaks = 10^(0:9),\n    labels = format(\n      10^(0:9), scientific = FALSE, big.mark = \".\", decimal.mark = \",\"\n    )\n  )\n)\n\n# bandera e ícono\nbandera <- glue(\n  \"https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/\",\n  \"Flag_of_Argentina.svg/320px-Flag_of_Argentina.svg.png\"\n)\n  \ntriangulo <- glue(\"<span style='font-family:jet;'>&#xf1a09;</span>\")\n\n# posición de Argentina en cada parámetro\nd_arg <- d |> \n  arrange(param, desc(valor)) |> \n  mutate(pos = row_number(), .by = param) |> \n  filter(country == \"Argentina\") |> \n  mutate(\n    label = glue(\n      \"#{pos}<br><img src='{bandera}' width=30></img><br>{triangulo}\"\n    )\n  )\n\n# parámetros y estilo de c/u para el subtítulo\np1 <- glue(\"<b style='color: {col[2]};'>expectativa de vida</b>\")\np2 <- glue(\"<b style='color: {col[3]};'>población</b>\")\np3 <- glue(\"<b style='color: {col[4]};'>acceso a internet</b>\")\np4 <- glue(\"<b style='color: {col[1]};'>superficie</b>\")\n\nmi_subtítulo <- glue(\n  \"Posición <b>Argentina</b> en {p1}, {p2}, {p3}<br>y {p4} a nivel mundial, \",\n  \"considerando 208 paises.\"\n)\n\n# figura\ng <- ggplot(d, aes(reorder_within(country, valor, trad), valor, fill = arg)) +\n  \n  geom_vline(\n    data = grid_label, aes(xintercept = x), color = c1, linewidth = .2\n  ) +\n  geom_col(color = NA, show.legend = FALSE, width = 1) +\n  geom_richtext(\n    data = grid_label, aes(x, y, label = label), inherit.aes = FALSE,\n    family = \"jet\", label.color = NA, fill = col[5], color = c1, size = 3\n  ) +\n  \n  geom_richtext(\n    data = d_arg, aes(label = label), fill = NA, label.color = NA, vjust = .1,\n    size = 5, color = c2, lineheight = .1, family = \"jet\"\n  ) +\n  \n  facet_wrap(vars(trad), ncol = 2, scales = \"free\") +\n  coord_cartesian(clip = \"off\") +\n  facetted_pos_scales(y = ejes_y) +\n  scale_fill_manual(\n    breaks = unique(d$arg),\n    values = as.character(c(col))\n  ) +\n  labs(x = NULL, y = NULL, subtitle = mi_subtítulo, caption = mi_caption) +\n  theme_classic() +\n  theme(\n    plot.margin = margin(r = 20, l = 10),\n    plot.background = element_rect(\n      fill = col[5], color = col[3], linewidth = 3\n    ),\n    plot.subtitle = element_markdown(\n      family = \"ubuntu\", size = 23, hjust = .5, color = c2,\n      lineheight = unit(1.1, \"line\"), margin = margin(b = 20, t = 10)\n    ),\n    plot.caption = element_markdown(\n      family = \"ubuntu\", size = 13, color = col[2],\n      margin = margin(b = 10, t = 15)\n    ),\n    axis.ticks = element_blank(),\n    axis.text = element_text(family = \"jet\", color = c2, size = 11),\n    axis.text.x = element_blank(),\n    axis.line = element_blank(),\n    panel.background = element_rect(fill = col[5]),\n    panel.grid.major.y = element_line(color = c1, linewidth = .2),\n    panel.grid.major.x = element_blank(),\n    panel.grid.minor.x = element_blank(),\n    panel.spacing.x = unit(1.5, \"line\"),\n    panel.spacing.y = unit(1.1, \"line\"),\n    panel.border = element_blank(),\n    strip.background = element_blank(),\n    strip.text = element_markdown(\n      family = \"ubuntu\", hjust = 0, size = 20, color = col[4],\n      margin = margin(b = 15)\n    )\n  )\n\n# guardo\nggsave(\n  plot = g,\n  filename = \"2024/s43/viz.png\",\n  width = 30,\n  height = 30,\n  units = \"cm\"\n)\n\n# abro\nbrowseURL(glue(\"{getwd()}/2024/s43/viz.png\"))\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2024/s43/viz.png)\n\n\n",
    "supporting": [
      "semana_43_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}