{
  "hash": "c4682cfdb338361a26a3f3e1d1de8a4d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 10\"\nsubtitle: \"Figura semana 10\"\nauthor: Víctor Gauto\ndate: \"2024-03-11\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_hline, geom_text, geom_rect, geom_smooth]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2024/s10/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\nTendencias en la recolección de basura de [Mr. Trash Wheel](https://www.mrtrashwheel.com/).\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(ggfx)\nlibrary(tidyverse)\n\n# fuente ------------------------------------------------------------------\n\n# colores\ncolores <- MetBrewer::met.brewer(name = \"Redon\", n = 10) |> \n  as.character()\n\nc1 <- colores[1]\nc2 <- colores[10]\nc3 <- \"black\"\nc4 <- \"grey95\"\nc5 <- \"grey30\"\n\n# fuente: Ubuntu\nfont_add(\n  family = \"ubuntu\", \n  regular = \"fuente/Ubuntu-Regular.ttf\",\n  bold = \"fuente/Ubuntu-Bold.ttf\",\n  italic = \"fuente/Ubuntu-Italic.ttf\")\n\n# fuente: Victor\nfont_add(\n  family = \"victor\", \n  regular = \"fuente/VictorMono-ExtraLight.ttf\",\n  bold = \"fuente/VictorMono-VariableFont_wght.ttf\",\n  italic = \"fuente/VictorMono-ExtraLightItalic.ttf\")\n\n# fuente: Bebas Neue\nfont_add(\n  family = \"bebas\", \n  regular = \"fuente/BebasNeue-Regular.ttf\")\n\n# íconos\nfont_add(\"fa-brands\", \"icon/Font Awesome 6 Brands-Regular-400.otf\")\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# caption\nfuente <- glue(\n  \"Datos: <span style='color:{c1};'><span style='font-family:mono;'>\",\n  \"{{<b>tidytuesdayR</b>}}</span> semana {10}, \",\n  \"**Mr. Trash Wheel Baltimore Healthy Harbor**</span>\")\nautor <- glue(\"<span style='color:{c1};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:fa-brands;'>&#xf099;</span>\")\nicon_instagram <- glue(\"<span style='font-family:fa-brands;'>&#xf16d;</span>\")\nicon_github <- glue(\"<span style='font-family:fa-brands;'>&#xf09b;</span>\")\nicon_mastodon <- glue(\"<span style='font-family:fa-brands;'>&#xf4f6;</span>\")\nusuario <- glue(\"<span style='color:{c1};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\n  \"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {icon_instagram} \",\n  \"{icon_mastodon} {usuario}\")\n\n# datos -------------------------------------------------------------------\n\ntuesdata <- tidytuesdayR::tt_load(2024, 10)\ntrashwheel <- tuesdata$trashwheel\n\n# me interesa ver las tendencias de cantidad de toneladas mensuales, por año\nd <- trashwheel |> \n  mutate(Date = mdy(Date)) |> \n  select(peso = Weight, fecha = Date) |> \n  mutate(mes = month(fecha)) |> \n  mutate(año = year(fecha)) |> \n  drop_na() |> \n  mutate(año = factor(año))\n\n# figura ------------------------------------------------------------------\n\n# iniciales de los meses, eje horizontal\nx_meses <- ymd(glue(\"2024-{1:12}-01\")) |> \n  format(\"%B\") |> \n  str_to_upper() |> \n  str_sub(start = 0, end = 1) |> \n  fct_inorder()\n\n# rectángulo para los paneles\nx_i <- .5\nx_f <- 12.5\ny_i <- 1.5\ny_f <- 4\n\nrect_tbl <- tibble(\n  xmin = x_i,\n  xmax = x_f,\n  ymin = y_i,\n  ymax = y_f,\n  año = unique(d$año)\n)\n\n# meses en eje horizontal, en todos los paneles\nmeses_lst <- tibble(\n  x = 1:12,\n  y = y_i,\n  label = x_meses\n) |> list()\n\nmeses_tbl <- tibble(\n  año = unique(d$año),\n  data = meses_lst\n) |> \n  unnest(data)\n\n# años, en cada panel\naño_tbl <- tibble(\n  x = 6.5, y = 4, año = factor(2014:2023)\n)\n\n# pesos sobre las horizontales\npeso_tbl <- tibble(\n  x = rep(.7, 4),\n  y = rep(2:3, 2),\n  label = rep(glue(\"{2:3}tn\"), 2),\n  año = fct(c(\"2014\", \"2014\", \"2019\", \"2019\"))\n)\n\n# logo de Mr. Trash Wheel\nlogo <- \"<img src='2024/s10/logo.png' width='70'></img>\"\n\n# título\nmi_title <- glue(\n  \"{logo} <b style='color:{c1}'>Mr. Trash Wheel</b> se \",\n  \"encarga de interceptar la basura sobre un curso de agua, \",\n  \"en la ciudad de Baltimore, <b>EEUU</b>. Tendencias anuales \",\n  \"en la recolección de residuos.\"\n)\n\n# figura\ng <- ggplot(d, aes(mes, peso, color = año)) +\n  # horizontales\n  geom_hline(\n    yintercept = c(2, 3), linetype = 2, linewidth = .1\n  ) +\n  # pesos\n  geom_text(\n    data = peso_tbl, aes(x, y, label = label), hjust = 0, vjust = -.1,\n    family = \"victor\", size = 2.5, color = c3\n  ) +\n  # paneles\n  geom_rect(\n    data = rect_tbl, \n    aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax, fill = año),\n    inherit.aes = FALSE, show.legend = FALSE) +\n  # tendencias, con sombra\n  with_shadow(\n    geom_smooth(\n    method = loess, formula = y ~ x, se = FALSE, show.legend = FALSE,\n    lineend = \"round\"),\n    sigma = 10, x_offset = 8, y_offset = 8\n    ) +\n  # meses\n  geom_text(\n    data = meses_tbl, aes(x, y, label = label, color = año),\n    size = 5, family = \"bebas\", vjust = -.1, show.legend = FALSE\n  ) +\n  # año\n  geom_text(\n    data = año_tbl, aes(x, y, label = año, color = año), show.legend = FALSE,\n    family = \"bebas\", size = 7, vjust = 1.1\n  ) +\n  facet_wrap(vars(año), nrow = 2, scales = \"free\") +\n  scale_x_continuous(\n    breaks = 1:12, labels = x_meses\n  ) +\n  scale_y_continuous(\n    breaks = seq(.5, 6, .5)\n  ) +\n  scale_color_manual(\n    values = colores\n  ) +\n  scale_fill_manual(\n    values = alpha(colores, .4)\n  ) +\n  labs(title = mi_title, caption = mi_caption) +\n  coord_cartesian(\n    ylim = c(1.5, 4), xlim = c(.5, 12.5), expand = FALSE, clip = \"off\") +\n  theme_void() +\n  theme(\n    aspect.ratio = 1,\n    plot.margin = margin(r = 10, l = 10),\n    plot.background = element_rect(fill = c4, color = c5, linewidth = 3),\n    plot.title = element_markdown(\n      color = c5, family = \"ubuntu\", size = 10,\n      margin = margin(b = 10, t = 5)),\n    plot.caption = element_markdown(\n      color = c2, family = \"ubuntu\", margin = margin(t = 15, b = 5, r = 5), \n      size = 8),\n    strip.text = element_blank(),\n    panel.spacing = unit(.5, \"line\")\n  )\n\n# guardo\nggsave(\n  plot = g,\n  filename = \"2024/s10/viz.png\",\n  width = 30,\n  height = 14.922,\n  units = \"cm\")\n\n# abro\nbrowseURL(\"2024/s10/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2024/s10/viz.png)\n\n\n",
    "supporting": [
      "semana_10_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}