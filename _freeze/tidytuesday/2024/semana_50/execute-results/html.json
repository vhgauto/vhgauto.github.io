{
  "hash": "d11db59692dd69dc73eb220fd8c14e32",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 50\"\nsubtitle: \"Figura semana 50\"\nauthor: Víctor Gauto\ndate: \"2024-12-16\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_rect, geom_col, geom_richtext]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2024/s50/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\nPopularidad en fragancias de perfumes.\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(tidyverse)\n\n# fuente ------------------------------------------------------------------\n\n# colores\ncc <- PrettyCols::prettycols(palette = \"Dark\")\nc1 <- \"grey20\"\nc2 <- \"black\"\nc3 <- \"grey95\"\n\n# fuente: Ubuntu\nfont_add(\n  family = \"ubuntu\",\n  regular = \"fuente/Ubuntu-Regular.ttf\",\n  bold = \"fuente/Ubuntu-Bold.ttf\",\n  italic = \"fuente/Ubuntu-Italic.ttf\"\n)\n\n# monoespacio & íconos\nfont_add(\n  family = \"jet\",\n  regular = \"fuente/JetBrainsMonoNLNerdFontMono-Regular.ttf\"\n)\n\n# Bebas Neue\nfont_add(\n  family = \"bebas\",\n  regular = \"fuente/BebasNeue-Regular.ttf\"\n)\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# caption\nfuente <- glue(\n  \"Datos: <span style='color:{cc[2]};'><span style='font-family:jet;'>\",\n  \"{{<b>tidytuesdayR</b>}}</span> semana {50}, \",\n  \"<b>Parfumo</b>.</span>\"\n)\nautor <- glue(\"<span style='color:{cc[2]};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:jet;'>&#xf099;</span>\")\nicon_instagram <- glue(\"<span style='font-family:jet;'>&#xf16d;</span>\")\nicon_github <- glue(\"<span style='font-family:jet;'>&#xf09b;</span>\")\nicon_mastodon <- glue(\"<span style='font-family:jet;'>&#xf0ad1;</span>\")\nicon_bsky <- glue(\"<span style='font-family:jet;'>&#xe28e;</span>\")\nusuario <- glue(\"<span style='color:{cc[2]};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\n  \"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {icon_instagram} \",\n  \"{icon_mastodon} {icon_bsky} {usuario}\"\n)\n\n# datos -------------------------------------------------------------------\n\ntuesdata <- tidytuesdayR::tt_load(2024, 50)\nparfumo <- tuesdata$parfumo_data_clean\n\n# me interesan las fragancias principales y la cantidad de veces que se usó \n# desde el 1900\n\n# las 9 fragancias principales\ntop_accords <- parfumo |> \n  select(Main_Accords) |> \n  drop_na() |>\n  separate_longer_delim(\n    cols = Main_Accords,\n    delim = \", \"\n  ) |> \n  count(Main_Accords, sort = TRUE) |> \n  slice_max(order_by = n, n = 9) |> \n  pull(Main_Accords)\n\n# obtengo la cantidad de fragancias por año\nd <- parfumo |> \n  select(Release_Year, Main_Accords) |> \n  drop_na() |>\n  separate_longer_delim(\n    cols = Main_Accords,\n    delim = \", \"\n  ) |> \n  filter(Main_Accords %in% top_accords) |> \n  count(Release_Year, Main_Accords) |> \n  filter(between(Release_Year, 1900, 2023)) |> \n  mutate(Main_Accords = fct_reorder(Main_Accords, n, max)) |> \n  mutate(Main_Accords = fct_rev(Main_Accords)) |> \n  filter(n >= 5)\n\n# figura ------------------------------------------------------------------\n\n# datos para el fondo de cada panel\nrect_tbl <- tibble(\n  xmin = 1900,\n  xmax = 2025,\n  ymin = 0,\n  ymax = 1000,\n  Main_Accords = unique(d$Main_Accords)\n)\n\n# etiquetas de las fragancias (strip)\nburbujas <- \"<span style='font-family:jet;'>&#xf05e3;</span>\"\nesencias <- sort(unique(d$Main_Accords))\nesencias_label <- glue(\n  \"<b style='color:{c(cc, cc[1:4])}'>{burbujas} {esencias} {burbujas}</b>\"\n)\nesencias_label <- set_names(esencias_label, esencias)\n\n# eje horizontal\neje_x <- c(seq(1900, 2000, 25), max(d$Release_Year))\n\n# logo de Parfumo\nlogo <- \"https://images.parfumo.de/logos/logo.png\"\nlogo_label <- glue(\"<img src='{logo}' width=120 />\")\nlogo_tbl <- tibble(\n  x = 1900,\n  y = -375,\n  label = logo_label,\n  Main_Accords = factor(\"Citrus\")\n)\n\n# subtítulo\nmi_subtitulo <- glue(\n  \"Las 9 <b>fragancias</b> más populares en perfumes muestran un<br>\",\n  \"crecimiento exponencial desde el inicio del S. XX.\"\n)\n\n# figura\ng <- ggplot(d, aes(Release_Year, n, color = Main_Accords, fill = Main_Accords)) +\n  geom_rect(\n    data = rect_tbl, inherit.aes = FALSE, show.legend = FALSE,\n    aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax, fill = Main_Accords)\n  ) +\n  geom_col(\n    color = NA,show.legend = FALSE, alpha = 1, width = 1\n  ) +\n  geom_richtext(\n    data = logo_tbl, aes(x, y, label = logo_label), hjust = 0,\n    vjust = 0, fill = NA, label.color = NA, show.legend = FALSE\n  ) +\n  facet_wrap(\n    vars(Main_Accords), nrow = 3, scales = \"free\",\n    labeller = as_labeller(esencias_label)\n  ) +\n  scale_x_continuous(\n    breaks = eje_x,\n    limits = c(1900, 2025),\n    labels = eje_x,\n    expand = c(0, 0)\n  ) +\n  scale_y_continuous(\n    expand = c(0, 0)\n  ) +\n  scale_fill_manual(\n    values = alpha(c(cc, cc), .3)\n  ) +\n  scale_color_manual(\n    values = c(cc, cc)\n  ) +\n  coord_cartesian(clip = \"off\", xlim = c(1900, 2025), ylim = c(0, 1000)) +\n  labs(x = NULL, subtitle = mi_subtitulo, caption = mi_caption) +\n  theme_void(base_size = 15) +\n  theme(\n    aspect.ratio = 1,\n    plot.margin = margin(r = 25, l = 13, b = 5, t = 5),\n    plot.background = element_rect(fill = c3, color = cc[3], linewidth = 3),\n    plot.subtitle = element_markdown(\n      family = \"ubuntu\", color = c2, size = 27, margin = margin(t = 15, b = 15),\n      hjust = .5, lineheight = 1\n    ),\n    plot.caption = element_markdown(\n      family = \"ubuntu\", color = cc[3], margin = margin(t = 25, b = 5),\n      size = 14\n    ),\n    panel.spacing = unit(25, \"pt\"),\n    panel.grid.major = element_line(\n      color = c1, linewidth = .1, linetype = 2\n    ),\n    axis.text.x = element_text(\n      family = \"bebas\", color = c2, margin = margin(t = 12), size = 20\n    ),\n    axis.text.y = element_text(\n      family = \"jet\", color = c2, margin = margin(r = 5), hjust = 1\n    ),\n    strip.background = element_blank(),\n    strip.text = element_markdown(\n      family = \"ubuntu\", hjust = 0, margin = margin(b = 0), size = 22\n    )\n  )\n\n# guardo\nggsave(\n  plot = g,\n  filename = \"2024/s50/viz.png\",\n  width = 30,\n  height = 34.5,\n  units = \"cm\"\n)\n\n# abro\nbrowseURL(paste0(getwd(), \"/2024/s50/viz.png\"))\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2024/s50/viz.png)\n\n\n",
    "supporting": [
      "semana_50_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}