{
  "hash": "a8d403526daf9c3a774805e067fece07",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 12\"\nsubtitle: \"Figura semana 12\"\nauthor: Víctor Gauto\ndate: \"2024-03-25\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_bump, geom_point, geom_text]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2024/s12/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\nPersonajes de <b>X-Men</b> populares.\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(ggbump)\nlibrary(tidyverse)\n\n# fuente ------------------------------------------------------------------\n\n# colores\ncol <- MetBrewer::met.brewer(name = \"Isfahan2\", n = 5)\nc1 <- \"grey20\"\nc2 <- \"grey40\"\n\n# fuente: Ubuntu\nfont_add(\n  family = \"ubuntu\", \n  regular = \"fuente/Ubuntu-Regular.ttf\",\n  bold = \"fuente/Ubuntu-Bold.ttf\",\n  italic = \"fuente/Ubuntu-Italic.ttf\")\n\n# fuente: Victor\nfont_add(\n  family = \"victor\", \n  regular = \"fuente/VictorMono-ExtraLight.ttf\",\n  bold = \"fuente/VictorMono-VariableFont_wght.ttf\",\n  italic = \"fuente/VictorMono-ExtraLightItalic.ttf\")\n\n# fuente: Bebas Neue\nfont_add(\n  family = \"bebas\", \n  regular = \"fuente/BebasNeue-Regular.ttf\")\n\n# fuente: Marvel\nfont_add_google(\n  name = \"Marvel\",\n  family = \"marvel\"\n)\n\n# íconos\nfont_add(\"fa-brands\", \"icon/Font Awesome 6 Brands-Regular-400.otf\")\nfont_add(\"fa-regular\", \"icon/Font Awesome 6 Free-Regular-400.otf\")\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# caption\nfuente <- glue(\n  \"Datos: <span style='color:{col[1]};'><span style='font-family:mono;'>\",\n  \"{{<b>tidytuesdayR</b>}}</span> semana {12}. \",\n  \"Mutant Moneyball: A Data Driven Ultimate X-Men, <b>Anderson Evans</b></span>\")\nautor <- glue(\"<span style='color:{col[1]};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:fa-brands;'>&#xf099;</span>\")\nicon_instagram <- glue(\"<span style='font-family:fa-brands;'>&#xf16d;</span>\")\nicon_github <- glue(\"<span style='font-family:fa-brands;'>&#xf09b;</span>\")\nicon_mastodon <- glue(\"<span style='font-family:fa-brands;'>&#xf4f6;</span>\")\nusuario <- glue(\"<span style='color:{col[1]};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\n  \"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {icon_instagram} \",\n  \"{icon_mastodon} {usuario}\")\n\n# datos -------------------------------------------------------------------\n\ntuesdata <- tidytuesdayR::tt_load(2024, 12)\nmutant <- tuesdata$mutant_moneyball\n\n# me interesa la evolución en la popularidad (en precio promedio de los issues)\n# de los 10 personajes más frecuentes\n\n# 10 más frecuentes\npop <- mutant |> \n  slice_max(TotalIssues, n = 10) |> \n  pull(Member) |> \n  sort()\n\n# acomodo los nombres y el ranking por década\nd <- mutant |> \n  filter(Member %in% pop) |> \n  janitor::clean_names() |> \n  select(member, starts_with(\"pp\") & ends_with(\"ebay\")) |> \n  mutate(member = str_replace_all(member, \"([A-Z])\", \" \\1\")) |> \n  mutate(member = str_to_title(member)) |> \n  mutate(\n    across(\n      .cols = -member,\n      .fns = ~ parse_number(.x)\n    )\n  ) |>\n  pivot_longer(\n    cols = -member,\n    names_to = \"decada\",\n    values_to = \"precio\"\n  ) |> \n  mutate(decada = str_remove(decada, \"ppi\") |> str_remove(\"s_ebay\")) |> \n  mutate(decada = as.numeric(decada)) |> \n  mutate(r = rank(precio, ties.method = \"first\"), .by  = decada) |> \n  mutate(member = str_wrap(member, 6))\n\n# arreglo el orden de los nombres y tipo de línea\nd_rank <- d |> \n  filter(decada == 60) |> \n  mutate(member = fct_reorder(member, r)) |> \n  arrange(desc(member)) |> \n  mutate(linetype = if_else(as.numeric(member) > 5, \"1\", \"2\")) |> \n  select(member, pos = r, linetype)\n\n# nombres en la década de los 60 y 90\nd_lim <- d |> \n  filter(decada == 60 | decada == 90) |> \n  mutate(hjust = if_else(decada == 60, 1, 0)) |> \n  mutate(decada = if_else(decada == 60, decada-.5, decada+.5))\n\n# combino los datos\ne <- inner_join(d, d_rank, by = join_by(member)) |> \n  mutate(member = fct_reorder(member, pos))\n\n# figura ------------------------------------------------------------------\n\n# subtítulo y aclaración\nmi_subtitle <- glue(\n  \"Ranking de los personajes más populares del cómic \",\n  \"<b style='color:{col[2]}'>X-MEN</b>,<br>\",\n  \"por precio<b style='color:{col[4]};'>*</b> promedio por publicación en 4 \",\n  \"décadas\"\n)\n\neje_x <- glue(\"<b style='color:{col[4]};'>*</b>basado en ventas en <i>eBay</i>\")\n\n# figura\ng <- ggplot(e, aes(decada, r, color = member, linetype = linetype)) +\n  geom_bump(linewidth = 1.3) +\n  geom_point(size = 3, shape = 23, fill = c1, stroke = 1) +\n  geom_text(\n    data = d_lim, aes(decada, r, label = member, hjust = hjust, color = member),\n    size = 8, family = \"marvel\", lineheight = unit(.8, \"line\"),\n    inherit.aes = FALSE) +\n  scale_x_continuous(\n    labels = (x) glue(\"'{x}\")) +\n  scale_y_continuous(\n    breaks = 1:10, labels = glue(\"#{10:1}\")) +\n  scale_color_manual(values = c(col, col)) +\n  scale_linetype_manual(values = c(\"solid\", \"83\")) +\n  labs(\n    subtitle = mi_subtitle, \n    caption = mi_caption, \n    x = eje_x) +\n  coord_cartesian(clip = \"off\") +\n  theme_void() +\n  theme(\n    aspect.ratio = 1,\n    plot.margin = margin(l = 30, r = 80),\n    plot.background = element_rect(fill = c1, color = col[1], linewidth = 3),\n    plot.title.position = \"plot\",\n    plot.subtitle = element_markdown(\n      color = \"white\", size = 22, hjust = .5, family = \"ubuntu\",\n      margin = margin(t = 10, b = 15)),\n    plot.caption = element_markdown(\n      family = \"ubuntu\", size = 12, color = col[4],\n      margin = margin(t = 20, r = -70, b = 10), lineheight = unit(1.2, \"line\")),\n    legend.position = \"none\",\n    text = element_text(size = 5),\n    axis.title.x = element_markdown(\n      hjust = 0, color = c2, family = \"ubuntu\", size = 17, \n      margin = margin(t = 5, l = -80)),\n    axis.text.x = element_text(\n      family = \"bebas\", size = 50, color = c2, margin = margin(t = 10)),\n    axis.text.y = element_text(\n      margin = margin(r = 90), size = 20, family = \"victor\", color = c2,\n      vjust = 1)\n  )\n\n# guardo\nggsave(\n  plot = g,\n  filename = \"2024/s12/viz.png\",\n  width = 30,\n  height = 28.3,\n  units = \"cm\")\n\n# abro\nbrowseURL(\"2024/s12/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2024/s12/viz.png)\n\n\n",
    "supporting": [
      "semana_12_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}