{
  "hash": "33e886764190616fc662a82e6b04794e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 47\"\nsubtitle: \"Figura semana 47\"\nauthor: Víctor Gauto\ndate: \"2023-11-26\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_sf, geom_segment, geom_richtext]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_47/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(glue)\nlibrary(sf)\nlibrary(ggtext)\nlibrary(showtext)\n\n# fuente ------------------------------------------------------------------\n\n# colores\nc1 <- \"#E8631C\"\nc2 <- \"#E3D885\"\nc3 <- \"white\"\nc4 <- \"#6874AD\"\nc5 <- \"#0D2D4C\"\nc6 <- \"#20222A\"\n\n# texto gral\nfont_add_google(name = \"Ubuntu\", family = \"ubuntu\")\n# números, fechas, ranking\nfont_add_google(name = \"Victor Mono\", family = \"victor\", db_cache = FALSE)\n# título\nfont_add_google(name = \"Bebas Neue\", family = \"bebas\")\n\n# íconos\nfont_add(\"fa-brands\", \"icon/Font Awesome 6 Brands-Regular-400.otf\")\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# caption\nfuente <- glue(\n  \"Datos: <span style='color:{c3};'><span style='font-family:mono;'>\",\n  \"{{<b>tidytuesdayR</b>}}</span> semana 47. \",\n  \"R-Ladies Chapters: Making talks work for diverse audiences, \",\n  \"**Federica Gazzelloni**</span>\")\nautor <- glue(\"<span style='color:{c3};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:fa-brands;'>&#xf099;</span>\")\nicon_github <- glue(\"<span style='font-family:fa-brands;'>&#xf09b;</span>\")\nicon_mastodon <- glue(\"<span style='font-family:fa-brands;'>&#xf4f6;</span>\")\nusuario <- glue(\"<span style='color:{c3};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\n  \"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {icon_mastodon} \n  {usuario}\")\n\n# datos -------------------------------------------------------------------\n\nbrowseURL(\"https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-11-21/readme.md\")\n\nrladies <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-11-21/rladies_chapters.csv')\n\n# me interesa hacer un mapa con los encuentros de Argentina, en qué ciudades, \n# la cantidad, fecha inicial y final\n\n# provincias de Argentina, POSGAR\npcias <- st_read(\"2023/semana_47/pcias_continental.gpkg\")\n\n# ciudades de Argentina donde se realizaron eventos, obtenido de:\nbrowseURL(\"https://rladies.org/\")\n\nciudades <- c(\n  \"bariloche\", \"buenos-aires\", \"cordoba\", \"general-pico\", \"jujuy\", \"mendoza\",\n  \"resistencia-corrientes\", \"santa-fe\", \"santa-rosa\", \"ushuaia\")\n\n# nombres de las ciudades\nciudades_nombres <- c(\n  \"Bariloche\", \"Buenos Aires\", \"Santa Rosa\", \"Mendoza\", \"Santa Fe\", \n  \"Resistencia-Corrientes\", \"General Pico\", \"Ushuaia\", \"Córdoba\", \"Jujuy\")\n\n# coordenadas de las ciudades\nciudad_lon <- c(\n  -71.300000, -58.381944, -64.290556, -68.833333, -60.700000, -58.861760,\n  -63.757766, -68.304444, -64.183333, -65.299444)\nciudad_lat <- c(\n  -41.150000, -34.599722, -36.620278, -32.883333, -31.633333, -27.468502,\n  -35.658688, -54.807222, -31.416667, -24.185556)\n\n# creo un sf con las coordenadas de las ciudades, POSGAR\nciudades_pts <- tibble(\n  ciudad = ciudades_nombres) |> \n  mutate(x = ciudad_lon, y = ciudad_lat) |> \n  st_as_sf(coords = c(\"x\", \"y\")) |> \n  st_set_crs(value = 4326) |> \n  st_transform(crs = st_crs(pcias))\n\n# coordenadas de las ciudades, tibble\nciudades_pts_tbl <- ciudades_pts |> \n  st_coordinates() |> \n  as_tibble()\n  \n# cantidad de eventos, fecha del primer/útlimo evento, nombre de la ciudad, \n# ranking\nciudades_tbl <- rladies |> \n  mutate(chapter = str_remove(chapter, \"rladies-\")) |> \n  filter(chapter %in% ciudades) |> \n  reframe(\n    n = n(),\n    fecha_i = min(date),\n    fecha_f = max(date),\n    .by = chapter) |> \n  arrange(desc(n)) |> \n  mutate(nombre = ciudades_nombres) |> \n  mutate(puesto = row_number())\n\n# longitud de las etiquetas\nder <- 5500000\nizq <- 3600000\n\n# etiquetas por ciudad\nd <- ciudades_tbl |> \n  mutate(fecha_i = format(fecha_i, \"%d/%m/%y\")) |> \n  mutate(fecha_f = format(fecha_f, \"%d/%m/%y\")) |> \n  mutate(label = glue(\n    \"<br><span style='font-family:victor;font-size:15pt;color:{c3}'>#{puesto}</span>\",\n    \"<span style='font-family:bebas;font-size:35pt;color:{c2}'>{nombre}</span>\",\n    \"<span style='font-size:15pt;color:{c3}'> <b style='font-family:victor'>{n}</b> eventos\",\n    \"Inicio: <b style='font-family:victor'>{fecha_i}</b>\",\n    \"Último: <b style='font-family:victor'>{fecha_f}</b>\",\n    \"</span>\",\n    .sep = \"<br>\")) |> \n  mutate(\n    x = ciudades_pts_tbl$X,\n    y = ciudades_pts_tbl$Y,\n    xend = c(\n      izq, der, 4700000, izq, der, 5000000, der, 3700000, izq, 3900000),\n    yend = c(\n      5411386, 6162069, 5100000, 6347028, 6498473, 7324204, 5400000, 3913285, \n      6524189, 7324204),\n    hjust = c(1, 0, 0, 1, 0, 0, 0, 1, 1, 1),\n    vjust = c(1, 1, 1, 1, 0, 0, 1, 0, 0, 0))\n\n# figura ------------------------------------------------------------------\n\n# logo de R-Ladies Argentina\nlogo <- \"2023/semana_47/logo.png\"\nlogo_label <- glue(\"<img src='{logo}' width='200'>\")\n\n# título\ntit_tbl <- tibble(\n  x = 2800000,\n  y = 5740431,\n  label = glue(\"Encuentros <span style='color:{c3}'>R-Ladies</span> Argentina\"))\n\n# figura\ng <- ggplot() +\n  # provincias de Argentina\n  geom_sf(data = pcias, fill = c4, color = c1, linewidth = .5) +\n  # líneas entre ciudad y etiqueta\n  geom_segment(\n    data = d, aes(x, y, xend = xend, yend = yend), color = c2,\n    linewidth = .25, linetype = 1) +\n  # puntos de ciudades\n  geom_sf(data = ciudades_pts, color = c3, size = 3.5, shape = 15) +\n  geom_sf(data = ciudades_pts, color = c3, size = 5, shape = 18) +\n  geom_sf(data = ciudades_pts, color = c1, size = 2, shape = 20) +\n  # etiquetas\n  geom_richtext(\n    data = d, aes(xend, yend, label = label, hjust = hjust, vjust = vjust), \n    fill = c5, label.color = NA, label.r = unit(0, \"mm\"), size = 4,\n    family = \"ubuntu\", color = c3, lineheight = unit(1.5, \"mm\")) +\n  # título\n  geom_richtext(\n    data = tit_tbl, aes(x, y, label = label), angle = 90, color = c2,\n    size = 30, family = \"bebas\", fill = NA, label.color = NA) +\n  # logo R-Ladies Argentina\n  annotate(\n    geom = \"richtext\", x = 5300000, y = 3891909, hjust = 0, vjust = 0,\n    label = logo_label, fill = NA, label.color = NA, label.r = unit(0, \"mm\")) +\n  coord_sf(clip = \"off\") +\n  labs(caption = mi_caption) +\n  theme_void() +\n  theme(\n    plot.background = element_rect(fill = c6, color = c5, linewidth = 3),\n    plot.margin = margin(20, 157.5, 20, 0),\n    plot.caption.position = \"plot\",\n    plot.caption = element_markdown(\n      family = \"ubuntu\", size = 12, color = c1))\n\n# guardo\nggsave(\n  plot = g,\n  filename = \"2023/semana_47/viz.png\",\n  width = 33,\n  height = 40,\n  units = \"cm\")\n\n# abro\nbrowseURL(\"2023/semana_47/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_47/viz.png)\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}