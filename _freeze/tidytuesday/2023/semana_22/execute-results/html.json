{
  "hash": "a548747bca39e182a0a184adbcc572dc",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 22\"\nsubtitle: \"Figura semana 22\"\nauthor: Víctor Gauto\ndate: \"2023-06-04\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_hline, geom_segment, geom_text_repel, geom_richtext, geom_point]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_22/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(rvest)\nlibrary(ggrepel)\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\n\nc1 <- \"#f7f4f9\"\nc2 <- \"grey10\"\nc3 <- \"#381a61\"\nc4 <- \"#fed9a6\"\nc5 <- \"grey70\"\nc6 <- \"#7c4b73\"\n\n# años, eje vertical\nfont_add_google(name = \"Bebas Neue\", family = \"bebas\", db_cache = TRUE)\n# título\nfont_add_google(name = \"Libre Baskerville\", family = \"libre\", db_cache = FALSE)\n# resto del texto\nfont_add_google(name = \"Ubuntu\", family = \"ubuntu\", db_cache = FALSE)\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# íconos\nfont_add(\"fa-brands\", \"icon/Font Awesome 6 Brands-Regular-400.otf\")\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# caption\nfuente <- glue(\"Datos: <span style='color:{c3};'><span style='font-family:mono;'>{{<b>tidytuesdayR</b>}}</span> semana 22, Wikipedia</span>\")\nautor <- glue(\"Autor: <span style='color:{c3};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:fa-brands;'>&#xf099;</span>\")\nicon_github <- glue(\"<span style='font-family:fa-brands;'>&#xf09b;</span>\")\nusuario <- glue(\"<span style='color:{c3};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\"{fuente} {sep} {autor} {sep} {icon_github} {icon_twitter} {usuario}\")\n\n# datos -------------------------------------------------------------------\n\nbrowseURL(\"https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-05-30/readme.md\")\n\ncentenarians <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-05-30/centenarians.csv')\n\n# selecciono la persona más longeva, Jeanne Calment\njeanne <- centenarians |> \n  slice_max(order_by = age, n = 1) |> \n  mutate(y = 0, yend = 1) |> \n  select(name, birth_date, death_date) |> \n  pivot_longer(cols = -name, names_to = \"estado\", values_to = \"fecha\") |> \n  mutate(etq = format(fecha, \"%d/%m/%Y\")) |> \n  mutate(vjust = if_else(estado == \"birth_date\", 1, 0))\n\n# sitio de Wikipedia con una tabla con los presidentes argentinos y fechas\nlink <- \"https://es.wikipedia.org/wiki/Anexo%3APresidentes_de_la_Naci%C3%B3n_Argentina\"\n\n# datos de los presidentes argentinos\nwi <- link %>%\n  read_html() |> \n  html_element(\"table\") %>%\n  html_table()\n\n# limpio datos de presidentes argentinos\npr <- wi |> \n  janitor::clean_names() |> \n  select(-1, -2) |> \n  select(presi = presidente_de_la_nacion_3, inicio = inicio_del_gobierno, fin = fin_del_gobierno) |> \n  filter(!str_detect(presi, \"inexistente\")) |> \n  separate(col = presi, into = c(\"presi\", NA), sep = \"\\(\") |> \n  separate(col = inicio, into = c(\"inicio\", NA), sep = \"\\[\") |> \n  separate(col = fin, into = c(\"fin\", NA), sep = \"\\[\") |> \n  # el presidente actual no posee fecha 'fin'\n  filter(presi != \"Alberto Fernández\") |> \n  mutate(across(.cols = c(inicio, fin), .fns = dmy)) \n\n# filtro los datos de presidentes al intervalo de Jeanne Calment\npr2 <- pr |> \n  # filter(between(inicio, min(jeanne$fecha), max(jeanne$fecha))) |> \n  filter(between(inicio, min(jeanne$fecha), max(jeanne$fecha))) |> \n  distinct() |> \n  mutate(fila = row_number()) |> \n  mutate()\n\n# divido los datos, presidentes pares a la izquierda\npr2_izq <- pr2 |> \n  filter(fila %% 2 == 0)\n\n# divido los datos, presidentes impares a la derecha\npr2_der <- pr2 |> \n  filter(fila %% 2 != 0)\n\nnic_ave <- pr |> \n  filter(year(inicio) == 1874)\n\n# figura ------------------------------------------------------------------\n\ng <- ggplot() +\n  # horizontales c/25 años\n  geom_hline(\n    yintercept = seq(ymd(18750101), ymd(20000101), \"25 year\"),\n    color = c5, linewidth = .25, linetype = \"ff\") +\n  # vertical central\n  geom_segment(\n    aes(x = 0, xend = 0, y = ymd(\"1875-02-21\"), yend = ymd(\"1997-08-04\")),\n    color = c4, linewidth = 3) +\n  # presidentes\n  geom_text_repel(\n    data = pr2_der, aes(x = 0, y = inicio, label = presi), \n    xlim = c(.1, 2), size = 8, seed = 2023, family = \"ubuntu\", color = c3) +\n  geom_text_repel(\n    data = pr2_izq, aes(x = 0, y = inicio, label = presi), \n    xlim = c(-2, -.1), size = 8, seed = 2023, family = \"ubuntu\", color = c3) +\n  geom_text_repel(\n    data = nic_ave, aes(x = 0, y = inicio, label = presi), \n    xlim = c(-2, -.2), size = 8, seed = 2023, family = \"ubuntu\", color = c3) +\n  # nacimiento/fallecimiento\n  geom_richtext(\n    data = jeanne, aes(x = 0, y = fecha, label = etq, vjust = vjust),\n    color = c3, fill = c4, size = 11, label.padding = unit(.4, \"line\"), \n    label.color = NA, family = \"ubuntu\") +\n  # puntos presidentes sobre vertical central\n  geom_point(data = pr2, aes(x = 0, y = inicio), color = \"#ec7014\", size = 2) +\n  # ejes\n  scale_x_continuous(limits = c(-.7, .7), expand = c(0, 0)) +\n  scale_y_date(\n    breaks = seq(ymd(18750101), ymd(20000101), \"25 year\"), \n    expand = c(0, 0), limits = c(ymd(18700101), ymd(20000101)),\n    date_labels = \"%Y\",) +\n  coord_cartesian(clip = \"off\") +\n  labs(x = NULL, y = NULL, \n       title = \"Jeanne Calment vivió 122 años\",\n       subtitle = glue(\n         \"**Jeanne Calment** es considerada la persona más longeva de la \n         historia. Nació en Francia en **1875** y falleció en **1997**. Para dar \n         dimensión a su extensa vida, se muestran los **{nrow(pr2)}** presidentes \n         argentinos (democráticos y de facto) que tuvimos durante este período.\"),\n       caption = mi_caption) +\n  # tema\n  theme(\n    aspect.ratio = 1.95,\n    plot.margin = margin(5, 29.5, 5, 29.5),\n    plot.background = element_rect(\n      fill = c1, color = c6, linewidth = 3),\n    plot.title.position = \"plot\",\n    plot.title = element_markdown(\n      size = 52, color = c3, family = \"libre\", margin = margin(5, 0, 5, 0), hjust = 0),\n    plot.subtitle = element_textbox_simple(\n      color = c2, size = 22, margin = margin(5, 0, 35, 7), family = \"ubuntu\"),\n    plot.caption = element_markdown(\n      hjust = .3, size = 15, color = c2, family = \"ubuntu\"),\n    panel.background = element_rect(fill = NA, color = NA),\n    panel.grid = element_blank(),\n    axis.text.y = element_text(color = c5, family = \"bebas\", size = 40),\n    axis.text.x = element_blank(),\n    axis.ticks = element_blank())\n\n# guardo\nggsave(\n  filename = \"2023/semana_22/viz.png\",\n  plot = g,\n  width = 30,\n  height = 58,\n  units = \"cm\",\n  dpi = 300)\n\n# abro\nbrowseURL(\"2023/semana_22/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_22/viz.png)\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}