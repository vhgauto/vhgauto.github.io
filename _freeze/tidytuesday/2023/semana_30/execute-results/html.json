{
  "hash": "5a2bad90517d59a64ca70cf38106eca5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 30\"\nsubtitle: \"Figura semana 30\"\nauthor: Víctor Gauto\ndate: \"2023-07-30\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_col, geom_vline, geom_hline]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_30/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\n\n# fuentes -----------------------------------------------------------------\n\n# colores, Java\nc1 <- \"#C5DAF6\"\nc2 <- \"#A1C2ED\"\nc3 <- \"#6996E3\"\nc4 <- \"#4060C8\"\nc5 <- \"#1A318B\"\n\n\n# texto gral\nfont_add_google(name = \"Ubuntu\", family = \"ubuntu\")\n# números, eje horizontal\nfont_add_google(name = \"Victor Mono\", family = \"victor\", db_cache = FALSE)\n# título\nfont_add_google(name = \"Waterfall\", family = \"waterfall\", db_cache = FALSE)\n\n# íconos\nfont_add(\"fa-brands\", \"icon/Font Awesome 6 Brands-Regular-400.otf\")\nfont_add(\"fa-solids\", \"icon/Font Awesome 6 Free-Solid-900.otf\")\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# caption\nfuente <- glue(\"Datos: <span style='color:{c3};'><span style='font-family:mono;'>{{<b>tidytuesdayR</b>}}</span> semana 30. **A Treatise on the Scurvy in Three Parts**. James Lind</span>\")\nautor <- glue(\"Autor: <span style='color:{c3};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:fa-brands;'>&#xf099;</span>\")\nicon_github <- glue(\"<span style='font-family:fa-brands;'>&#xf09b;</span>\")\nusuario <- glue(\"<span style='color:{c3};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {usuario}\")\n\n# datos -------------------------------------------------------------------\n\nbrowseURL(\"https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-07-25/readme.md\")\n\nscurvy <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-07-25/scurvy.csv')\n\n# traducción de los tratamientos\ntrad <- c(\n  cider = \"cidra\", dilute_sulfuric_acid = \"ácido diluido\",\n  vinegar = \"vinagre\", sea_water = \"agua de mar\", citrus = \"cítrico\",\n  purgative_mixture = \"purgante\")\n\n# me interesan los valores del estado de salud (0 a 3) por cada síntoma\n# ordenados por id de los pacientes\nd <- scurvy |> \n  # renombro las columnas por comodidad\n  rename(\n    trat = treatment, dosis = dosing_regimen_for_scurvy,\n    \"daño en las encías\" = gum_rot_d6, \n    \"llagas en la piel\" = skin_sores_d6, \n    \"dolor de rodilla\" = weakness_of_the_knees_d6,\n    cansancio = lassitude_d6, apto = fit_for_duty_d6, id = study_id) |> \n  # extraigo los números de la escala de estado de salud\n  mutate(across(.cols = \"daño en las encías\":apto, .fns = parse_number)) |> \n  select(-dosis) |> \n  # tabla larga con los síntomas\n  pivot_longer(\n    cols = \"daño en las encías\":apto, \n    names_to = \"carac\", \n    values_to = \"valor\") |> \n  filter(carac != \"apto\") |> \n  arrange(id) |> \n  # traduzco, agrego mayúsculas y convierto a factor\n  mutate(trat_trad = trad[trat]) |> \n  mutate(trat_trad = str_to_upper(trat_trad)) |> \n  mutate(trat_trad = fct_inorder(trat_trad)) |> \n  # agrego +1 a los valores de la escala de síntomas, para evitar barras = 0\n  mutate(valor = valor + 1) |> \n  # agrego '#' y convierto a factor el id de los pacientes\n  mutate(id_strip = glue(\"#{id}\")) |> \n  mutate(id_strip = fct_inorder(id_strip)) |> \n  mutate(carac = str_to_sentence(carac))\n\n# figura ------------------------------------------------------------------\n\n# título y subtítulo\nmi_title <- \"Cítricos para el escorbuto\"\n\nmi_subtitulo <- \"En **1757** un estudio determinó el mejor método para combatir \nel **escorbuto** en marineros. Se probaron seis tratamientos en 12 participantes, \nde a pares. A los seis días, se registró el estado de salud. Los **cítricos**\nmostraron los mejores resultados, con ningún síntoma, o leves.\"\n\n# figura\ng <- ggplot(data = d, aes(x = valor, y = carac, fill = trat)) +\n  geom_col(color = NA, width = 1, show.legend = FALSE) +\n  geom_vline(xintercept = 0:4, color = c3, linewidth = .25) +\n  geom_hline(yintercept = .5:4.5, color = c3, linewidth = .25) +\n  facet_wrap(id_strip ~ trat_trad, scales = \"free_x\") +\n  scale_x_continuous(\n    breaks = 0:4, labels = c(\"\", \"0\", \"1\", \"2\", \"3\"),\n    limits = c(0, 4), expand = c(0, 0)) +\n  scale_y_discrete(expand = c(0, 0)) +\n  MetBrewer::scale_fill_met_d(name = \"Austria\") +\n  labs(\n    x = \"— **0** Ninguno — **1** Leve — **2** Moderado — **3** Severo —\",\n    y = NULL,\n    title = mi_title,\n    subtitle = mi_subtitulo,\n    caption = mi_caption) +\n  coord_cartesian(clip = \"off\") +\n  theme(\n    aspect.ratio = 1,\n    plot.margin = margin(14, 10.2, 14, 10.2),\n    plot.background = element_rect(\n      fill = c1, color = c2, linewidth = 3),\n    plot.title.position = \"plot\",\n    plot.title = element_text(\n      size = 130, color = c5, family = \"waterfall\", hjust = .5, face = \"bold\"),\n    plot.subtitle = element_textbox_simple(\n      size = 20, color = c4, family = \"ubuntu\", margin = margin(5, -5, 10, 0)),\n    plot.caption = element_markdown(\n      color = c5, size = 12, margin = margin(20, 0, 5, 0)),\n    panel.background = element_rect(fill = NA, color = NA),\n    panel.grid = element_blank(),\n    panel.spacing.x = unit(.75, \"line\"),\n    panel.spacing.y = unit(1, \"line\"),\n    strip.background = element_rect(fill = NA, color = NA),\n    strip.text = element_markdown(family = \"ubuntu\", color = c4, size = 20),\n    axis.title.x = element_markdown(\n      family = \"ubuntu\", size = 22, color = c4, margin = margin(20, 0, 0, 0)),\n    axis.text.x = element_markdown(\n      family = \"victor\", color = c5, size = 15, hjust = 2.7, face = \"bold\"),\n    axis.text.y = element_markdown(family = \"ubuntu\", color = c5, size = 17),\n    axis.ticks = element_blank()\n  )\n\n# guardo\nggsave(\n  plot = g,\n  filename = \"2023/semana_30/viz.png\",\n  width = 30,\n  height = 37,\n  units = \"cm\")\n\n# abro\nbrowseURL(\"2023/semana_30/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_30/viz.png)\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}