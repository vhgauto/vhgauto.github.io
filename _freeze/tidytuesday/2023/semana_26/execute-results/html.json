{
  "hash": "674eb6eabcc6940caf030f6a8170d798",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 26\"\nsubtitle: \"Figura semana 26\"\nauthor: Víctor Gauto\ndate: \"2023-07-02\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_sf, geom_from_path]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_26/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(tidytext)\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(ggpath)\n\n# fuentes -----------------------------------------------------------------\n\n# colores\nc1 <- \"#3C0D02\"\nc2 <- \"#8D1C06\"\nc3 <- \"white\"\n\n# texto gral\nfont_add_google(name = \"Ubuntu\", family = \"ubuntu\")\n# título\nfont_add_google(name = \"STIX Two Text\", family = \"stix\")\n\n# íconos\nfont_add(\"fa-brands\", \"icon/Font Awesome 6 Brands-Regular-400.otf\")\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# caption\nfuente <- glue(\"Datos: <span style='color:{c3};'><span style='font-family:mono;'>{{<b>tidytuesdayR</b>}}</span> semana 26</span>\")\nautor <- glue(\"Autor: <span style='color:{c3};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:fa-brands;'>&#xf099;</span>\")\nicon_github <- glue(\"<span style='font-family:fa-brands;'>&#xf09b;</span>\")\nusuario <- glue(\"<span style='color:{c3};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\"{fuente} {sep} {autor} {sep} {icon_github} {icon_twitter} {usuario}\")\n\n# datos -------------------------------------------------------------------\n\nbrowseURL(\"https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-06-27/readme.md\")\nus_place_names <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-06-27/us_place_names.csv')\n\n# más datos\nbrowseURL(\"https://www.usgs.gov/us-board-on-geographic-names/what-geographic-names-information-system-gnis#1\")\n\n# sistema de coordenadas de EEUU\ncrs_eeuu <- \"+proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs\"\n\n# mapa de EEUU, entero\neeuu <- giscoR::gisco_get_countries(country = \"US\", resolution = \"01\") |> \n  # transformo las coordenadas\n  st_transform(crs = crs_eeuu)\n\n# extención de la parte continental de EEUU, tbl\nbb_tbl <- tibble(\n  lon = c(-129, -62.5, -62.5, -129, -129),\n  lat = c(20, 20, 50.5, 50.5, 20))\n\n# convierto a sf\nbb <- bb_tbl |> \n  # uso coordenadas 4326\n  st_as_sf(coords = c(\"lon\", \"lat\"), crs = 4326) |> \n  mutate(geometry = st_combine(geometry)) |> \n  # convierto a polígono\n  st_cast(\"POLYGON\") |> \n  # transformo a sistema de coordenadas EEUU\n  st_transform(crs = crs_eeuu)\n\n# recorto el mapa de EEUU a la región continental\neeuu_bb <- st_crop(eeuu, bb)\n\n# convierto los datos de nombres de lugares a sf\nnombres_sf2 <- us_place_names |> \n  # remuevo sitios sin coordenadas\n  drop_na(prim_lat_dec, prim_long_dec) |> \n  # indico columnas de coordenadas , CRS\n  st_as_sf(coords = c(\"prim_long_dec\", \"prim_lat_dec\"), crs = 4326) |> \n  # transformo a sistema de coordendas de EEUU\n  st_transform(crs = crs_eeuu)\n\n# recorto los datos a la región continental\nnombres_sf <- st_crop(nombres_sf2, bb)\n\n# me intereso en molinos (mill)\nd <- nombres_sf |> \n  # convierto todo a minúscula\n  mutate(feature_name = str_to_lower(feature_name)) |> \n  # molinos\n  filter(str_detect(feature_name, \"mill\")) |> \n  # columnas de interés\n  select(geometry)\n\n# figura ------------------------------------------------------------------\n\n# cantidad de molinos\nn_molinos <- nrow(d) |> \n  gt::vec_fmt_number(dec_mark = \",\", sep_mark = \".\", decimals = 0)\n\n# .png molino\nmolino <-(\"2023/semana_26/molino.svg\")\n\n# figura\ng <- ggplot() +\n  geom_sf(data = eeuu_bb, fill = c2, color = NA) +\n  geom_sf(data = d, color = c3, alpha = .6, size = .75, shape = 16) +\n  geom_from_path(aes(x = -2100000, y = -1600000, path = molino), width = .05) +\n  annotate(\n    geom = \"richtext\", x = -2200000, y = -2000000, \n    label = glue(\n      \"Cada punto representa la ubicación<br>de los {n_molinos}\n      sitios en **EE.UU.**<br>asociados a **molinos**, en el<br>\n      territorio continental.\"),\n    label.color = NA, color = c3, fill = NA, hjust = 0, family = \"ubuntu\", \n    size = 5) +\n  coord_sf() +\n  labs(\n    title = \"Molinos en EE.UU.\",\n    caption = mi_caption) +\n  theme_void() +\n  theme(\n    plot.background = element_rect(fill = c1, color = c2, linewidth = 3),\n    # plot.margin = margin(7.3, 0, 7.3, 0),\n    plot.margin = margin(6.9, 0, 6.9, 0),\n    plot.title.position = \"plot\",\n    plot.title = element_markdown(\n      family = \"stix\", size = 36, color = c3, hjust = .5, \n      margin = margin(0, 0, -30, 0)),\n    plot.caption = element_markdown(\n      color = c2, margin = margin(0, 10, 0, 0), family = \"ubuntu\"))\n\n# guardo\nggsave(\n    plot = g,\n    filename = \"2023/semana_26/viz.png\",\n    width = 30,\n    height = 19,\n    units = \"cm\",\n    dpi = 300)\n\n# abro\nbrowseURL(\"2023/semana_26/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_26/viz.png)\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}