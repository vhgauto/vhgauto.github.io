{
  "hash": "3539eb4edd96362db9701ca055f1ddb8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 36\"\nsubtitle: \"Figura semana 36\"\nauthor: Víctor Gauto\ndate: \"2023-09-10\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_line, geom_richtext, geom_point]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_36/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\nBrecha de género entre diferentes grupos demográficos, en dólares/hora, en EEUU.\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(patchwork)\n\n# fuente ------------------------------------------------------------------\n\n# colores, RColorBrewer, Set1\nc1 <- \"#F781BF\"\nc2 <- \"#FFD92F\"\nc3 <- \"#B3E2CD\"\nc4 <- \"#4DAF4A\"\nc5 <- \"grey90\"\n\n# texto gral\nfont_add_google(name = \"Ubuntu\", family = \"ubuntu\")\n# wage, eje vertical\nfont_add_google(name = \"Victor Mono\", family = \"victor\", db_cache = FALSE)\n# años, eje horizontal\nfont_add_google(name = \"Bebas Neue\", family = \"bebas\", db_cache = FALSE)\n# título\nfont_add_google(name = \"Taviraj\", family = \"taviraj\")\n\n# íconos\nfont_add(\"fa-brands\", \"icon/Font Awesome 6 Brands-Regular-400.otf\")\nfont_add(\"fa-solids\", \"icon/Font Awesome 6 Free-Solid-900.otf\")\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# caption\nfuente <- glue(\"Datos: <span style='color:{c3};'><span style='font-family:victor;'>{{<b>tidytuesdayR</b>}}</span> semana 36. Union Membership and Coverage Database. B. Hirsch, D. Macpherson, W. Even</span>\")\nautor <- glue(\"Autor: <span style='color:{c3};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:fa-brands;'>&#xf099;</span>\")\nicon_github <- glue(\"<span style='font-family:fa-brands;'>&#xf09b;</span>\")\nusuario <- glue(\"<span style='color:{c3};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {usuario}\")\n\n# datos -------------------------------------------------------------------\n\nbrowseURL(\"https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-09-05/readme.md\")\n\nwages <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-09-05/wages.csv')\n\n# me interesa ver la diferencia entre el sueldo de varones y mujeres, y comparar\n# grupos demográficos distintos\n\n# traducción de los grupos demográficos\ntipo_nivel_trad <- c(\n  white = \"Personas blancas\", \n  black = \"Personas afroamericanas\",\n  hispanic = \"Personas hispanas\")\n\nd <- wages |> \n  filter(str_detect(facet, \"demographics\") & str_detect(facet, \"male|female\")) |> \n  select(year, facet, wage) |> \n  mutate(facet = str_remove(facet, \"demographics: \")) |> \n  filter(facet != \"male\" & facet != \"female\") |> \n  separate_wider_delim(\n    cols = facet, delim = \" \", names = c(\"tipo\", \"sex\"),\n    too_few = \"align_end\") |> \n  mutate(tipo = tipo_nivel_trad[tipo]) |> \n  mutate(tipo = factor(tipo, levels = tipo_nivel_trad))\n\n# personas blancas, referencia para todos los paneles\nw <- wages |> \n  filter(str_detect(facet, \"demographics\") & str_detect(facet, \"male|female\")) |> \n  select(year, facet, wage) |> \n  mutate(facet = str_remove(facet, \"demographics: \")) |> \n  filter(str_detect(facet, \"white\")) |> \n  separate_wider_delim(\n    cols = facet, delim = \" \", names = c(\"tipo\", \"sex\"), \n    too_few = \"align_end\") |> \n  select(-tipo)\n\n# figura ------------------------------------------------------------------\n\n# función que genera las figuras, por grupo demográfico\nf_gg <- function(x) {\n  \n  e <- d |> \n    filter(tipo == x)\n  \n  g <- ggplot(e, aes(year, wage, color = sex)) +\n    # recuadros de cada panel\n    annotate(\n      geom = \"segment\",\n      x = c(1973, 2022, 2022, 1973),\n      xend = c(2022, 2022, 1973, 1973),\n      y = c(0, 0, 40, 40),\n      yend = c(0, 40, 40, 0),\n      color = \"grey30\",\n      lineend = \"round\",\n      linewidth = 1) +\n    # referencia\n    geom_line(data = w, linewidth = .5, linetype = 3) +\n    # sueldo\n    geom_line(\n      linewidth = 2, lineend = \"round\", show.legend = FALSE) +\n    # escalas\n    scale_x_continuous(expand = c(0, 0)) +\n    scale_y_continuous(\n      breaks = seq(0, 40, 10), limits = c(0, 40), expand = c(0, 0),\n      labels = scales::label_dollar()) +\n    scale_color_manual(values = c(c4, c1)) +\n    coord_cartesian(clip = \"off\") +\n    labs(x = NULL, y = \"Dólares/hora, nominales (EEUU)\", title = x) +\n    theme_minimal() +\n    theme(\n      aspect.ratio = 1,\n      legend.position = \"none\",\n      plot.margin = margin(13, 13, 13, 13),\n      plot.background = element_blank(),\n      plot.title = element_text(\n        color = \"white\", size = 25, family = \"ubuntu\", hjust = 1),\n      panel.background = element_blank(),\n      panel.grid.minor = element_blank(),\n      panel.grid.major = element_line(\n        color = \"grey60\", linewidth = .1, linetype = \"8f\"),\n      panel.spacing = unit(2, \"line\"),\n      axis.text.y = element_text(color = c5, family = \"ubuntu\", size = 15),\n      axis.text.x = element_text(color = c5, family = \"bebas\", size = 20),\n      axis.title.y = element_text(color = c5, family = \"ubuntu\", size = 20)\n    )\n  \n  return(g)\n}\n\n# título y subtítulo\nmi_title <- str_to_upper(\"La brecha de género<br>no discrimina\")\n\nmi_texto <- glue(\n  \"Una de las formas de la **brecha de género** es la diferencia entre la \n  remuneración de los trabajadores varones sobre las trabajadoras mujeres, en \n  favor de ellos. Esta desigualdad también está presente en otros grupos \n  demográficos. Las líneas punteadas representan a las personas blancas, para \n  mejor comparación entre grupos.\") |> \n  str_wrap(width = 34) |> \n  # cambio a '<br>' para usar ggtext::geom_richtext()\n  str_replace_all(pattern = \"\\n\", replacement = \"<br>\") |> \n  str_replace(\n    pattern = \"trabajadores varones\", \n    replacement = glue(\"<span style='color:{c1}'>trabajadores varones</span>\")) |> \n  str_replace(\n    pattern = \"trabajadoras mujeres\", \n    replacement = glue(\"<span style='color:{c4}'>trabajadoras mujeres</span>\"))\n\n# figura que contiene el subtítulo\ng_texto <- ggplot(tibble(x = 0, y = 0), aes(x, y)) +\n  annotate(\n    geom = \"richtext\", family = \"ubuntu\", label.color = NA, \n    hjust = 0, vjust = 1, fill = NA,\n    label = mi_texto, x = -1, y = 0, size = 8, color = c5) +\n  geom_point(color = NA) +\n  coord_cartesian(xlim = c(0, 10), ylim = c(-10, 0), expand = FALSE, clip = \"off\") +\n  theme_void() +\n  theme(\n    aspect.ratio = 1,\n  )\n\n# lista que contiene las figuras por grupo demográfico y el subtítulo\ng_lista <- c(list(g_texto), map(unique(d$tipo), f_gg))\n\n# diseño de posición de las figuras\narreglo <- \"\nAB\nCD\n\"\n\n# figura\ng <- wrap_plots(g_lista, design = arreglo) +\n  plot_annotation(\n    caption = mi_caption,\n    title = mi_title,\n    theme = theme(\n      plot.margin = margin(21.2, 5, 15, 5),\n      plot.background = element_rect(\n        fill = \"grey20\", color = c5, linewidth = 3),\n      plot.title = element_markdown(\n        size = 70, color = c3, hjust = 0, family = \"taviraj\"),\n      plot.caption = element_markdown(\n        color = c5, family = \"ubuntu\", size = 13, margin = margin(10, 0, 5, 0)),\n    )\n  )\n\n# guardo\nggsave(\n  plot = g,\n  filename = \"2023/semana_36/viz.png\",\n  width = 30,\n  height = 37,\n  units = \"cm\")\n\n# abro\nbrowseURL(\"2023/semana_36/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_36/viz.png)\n\n\n",
    "supporting": [
      "semana_36_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}