{
  "hash": "12b46d64d0305ab228091196e8f2e1ef",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 34\"\nsubtitle: \"Figura semana 34\"\nauthor: Víctor Gauto\ndate: \"2023-08-27\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_sf, geom_hline, geom_line, geom_point, argentina]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_34/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\nCantidad anual de refugiados que llegan y provienen de Argentina.\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(patchwork)\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\n\n# fuente ------------------------------------------------------------------\n\n# colores, MoMA, Koons\nc1 <- \"#CC3A6A\"\nc2 <- \"#5DBBA3\"\nc3 <- \"#E9C063\"\nc4 <- \"#4A1910\"\nc5 <- \"#A41620\"\n\n# texto gral\nfont_add_google(name = \"Ubuntu\", family = \"ubuntu\")\n# cantidad, eje vertical\nfont_add_google(name = \"Victor Mono\", family = \"victor\", db_cache = FALSE)\n# años, eje horizontal\nfont_add_google(name = \"Bebas Neue\", family = \"bebas\")\n# título\nfont_add_google(name = \"Vidaloka\", family = \"vidaloka\")\n\n# íconos\nfont_add(\"fa-brands\", \"icon/Font Awesome 6 Brands-Regular-400.otf\")\nfont_add(\"fa-solids\", \"icon/Font Awesome 6 Free-Solid-900.otf\")\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# caption\nfuente <- glue(\"Datos: <span style='color:{c3};'><span style='font-family:mono;'>{{<b>tidytuesdayR</b>}}</span> semana 34. UNHCR, {{refugees}}</span>\")\nautor <- glue(\"Autor: <span style='color:{c3};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:fa-brands;'>&#xf099;</span>\")\nicon_github <- glue(\"<span style='font-family:fa-brands;'>&#xf09b;</span>\")\nusuario <- glue(\"<span style='color:{c3};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {usuario}\")\n\n# datos -------------------------------------------------------------------\n\nbrowseURL(\"https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-08-22/readme.md\")\n\npopulation <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-08-22/population.csv')\n\n# me interesa saber la cantidad total, anual, de refugiados que ingresan y salen\n# de Argentina\nd <- population |> \n  select(\n    año = year, origen = coo_name, origen_iso = coo_iso, llegada = coa_name,\n    llegada_iso = coa_iso, n = refugees) |> \n  select(año, starts_with(\"o\"), starts_with(\"l\"), n)\n\n# entran a Argentina\narg_in <- d |> \n  filter(llegada == \"Argentina\") |> \n  summarise(n = sum(n), .by = año) |> \n  mutate(estado = \"entran\")\n\n# se originan en Argentina\narg_out <- d |> \n  filter(origen == \"Argentina\") |> \n  summarise(n = sum(n), .by = año) |> \n  mutate(estado = \"salen\")\n\n# combino ambos\narg <- bind_rows(arg_in, arg_out)\n\n# vector del contorno de Argentina\narg_sf <- st_read(\"extra/arg_continental.gpkg\")\n\n# figura ------------------------------------------------------------------\n\n# mapa de Argentina\ngg_arg <- ggplot() +\n  geom_sf(data = arg_sf, fill = alpha(\"#90A8C0\", .2), color = NA) +\n  theme_void()\n\n# labels del eje horizontal, años\neje_x_label <- tibble(xx = 10:22) |> \n  mutate(eje_x = if_else(xx %% 5 == 0, glue(\"20{xx}\"), glue(\"'{xx}\"))) |> \n  pull(eje_x)\n\n# título y subtítulo\nmi_title <- \"Refugiados desde y en Argentina\"\n\nmi_subtitle <- glue(\n  \"El **Alto Comisionado de la ONU para los Refugiados** (UNHCR)\n  registra estadísticas<br>\n  anuales de personas en busca de asilo. \n  Se muestran las cantidades de desplazados<br>\n  que <span style='color:{c2}'>**llegan**</span> y \n  <span style='color:{c3}'>**provienen**</span> de **Argentina**.\"\n)\n\n# figura de líneas, cantidad de refugiados ~ años\ngg_ref <- arg |> \n  ggplot(aes(año, n, color = estado)) +\n  geom_hline(\n    yintercept = seq(0, 4000, 1000), color = c5, linewidth = .1, linetype = \"ff\") +\n  geom_line(show.legend = FALSE, linewidth = 3, lineend = \"round\") +\n  geom_point(show.legend = FALSE, color = \"white\", size = .4) +\n  scale_x_continuous(breaks = 2010:2022, labels = eje_x_label) +\n  scale_y_continuous(\n    breaks = seq(0, 4000, 1000),\n    labels = scales::label_number(big.mark = \".\", decimal.mark = \",\"),\n    expand = c(0, 0)) +\n  scale_color_manual(values = c(c2, c3)) +\n  coord_cartesian(clip = \"off\") +\n  labs(\n    x = NULL,\n    y = \"Cantidad de refugiados\",\n    title = mi_title,\n    subtitle = mi_subtitle,\n    caption = mi_caption) +\n  theme_minimal() +\n  theme(\n    aspect.ratio = 1,\n    plot.margin = margin(5.5, 11, 5.5, 11),\n    plot.title.position = \"plot\",\n    plot.title = element_text(size = 58, family = \"vidaloka\", color = c5),\n    plot.subtitle = element_markdown(\n      size = 18, color = c4, family = \"ubuntu\", margin = margin(5, 0, 25, 0)),\n    plot.caption = element_markdown(\n      color = c2, size = 12, margin = margin(20, 0, 5, 0)),\n    axis.title.y = element_text(color = c4, family = \"ubuntu\", size = 20),\n    axis.text.x = element_text(color = c4, family = \"bebas\", size = 25, margin = margin(5, 0, 0, 0)),\n    axis.text.y = element_text(color = c4, family = \"ubuntu\", size = 20),\n    axis.ticks.x = element_line(color = c4),\n    axis.ticks.length.x = unit(.25, \"line\"),\n    panel.grid = element_blank()\n  )\n\n# combino ambas figuras, con el mapa de Argentina de fondo\ng <- gg_ref + \n  inset_element(\n    gg_arg, left = .2, bottom = 0, right = .8, top = 1) +\n  plot_annotation(\n    theme = theme(\n      plot.background = element_rect(fill = c1, color = c4, linewidth = 3)\n    ))\n\n# guardo\nggsave(\n  plot = g,\n  filename = \"2023/semana_34/viz.png\",\n  width = 30,\n  height = 34.5,\n  units = \"cm\")\n\n# abro\nbrowseURL(\"2023/semana_34/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_34/viz.png)\n\n\n",
    "supporting": [
      "semana_34_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}