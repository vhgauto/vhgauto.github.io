{
  "hash": "29b53b2c1df07959fd7d6497be3de362",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 37\"\nsubtitle: \"Figura semana 37\"\nauthor: Víctor Gauto\ndate: \"2023-09-17\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_col, geom_point, geom_richtext]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_37/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\n\n# fuente ------------------------------------------------------------------\n\n# colores, RColorBrewer, Set1\nc1 <- \"grey10\"\nc2 <- \"#EE9569\"\nc3 <- \"#75AEE0\"\nc4 <- \"#CAB2D6\"\nc5 <- \"#FDBF6F\"\nc6 <- \"grey90\"\nc7 <- \"grey40\"\n\n# texto gral, categorías (eje vertical)\nfont_add_google(name = \"Ubuntu\", family = \"ubuntu\")\n# horas, porcentajes\nfont_add_google(name = \"Victor Mono\", family = \"victor\", db_cache = FALSE)\n# título\nfont_add_google(name = \"Taviraj\", family = \"taviraj\")\n\n# íconos\nfont_add(\"fa-brands\", \"icon/Font Awesome 6 Brands-Regular-400.otf\")\nfont_add(\"fa-solids\", \"icon/Font Awesome 6 Free-Solid-900.otf\")\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# caption\nfuente <- glue(\"Datos: <span style='color:{c3};'><span style='font-family:victor;'>{{<b>tidytuesdayR</b>}}</span> semana 37. The Human Chronome Project</span>\")\nautor <- glue(\"Autor: <span style='color:{c3};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:fa-brands;'>&#xf099;</span>\")\nicon_github <- glue(\"<span style='font-family:fa-brands;'>&#xf09b;</span>\")\nusuario <- glue(\"<span style='color:{c3};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {usuario}\")\n\n# datos -------------------------------------------------------------------\n\nbrowseURL(\"https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-09-12/readme.md\")\n\nall_countries <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-09-12/all_countries.csv')\nglobal_human_day <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-09-12/global_human_day.csv')\n\n# me interesan una selección de categorías, y comparo Argentina con el mundo\n\n# traducción de las categorías\nsubcat_trad <- c(\n  `Food preparation` = \"Preparación de comida\",\n  `Sleep & bedrest` = \"Dormir y descanso\",\n  `Physical child care` = \"Cuidado de niños\",\n  `Health care` = \"Cuidado de la salud\",\n  `Hygiene & grooming` = \"Higiene y aseo\",\n  `Schooling & research` = \"Escuela e investigación\",\n  `Religious practice` = \"Práctica religiosa\",\n  `Social` = \"Actividades sociales\",\n  `Active recreation` = \"Actividades recreativas\",\n  `Meals` = \"Comidas\"\n)\n\n# categorías de interés, en inglés\nsubcat_interes <- names(subcat_trad)\n\n# Argentina\narg <- all_countries |> \n  filter(country_iso3 == \"ARG\") |> \n  rename_with(.cols = everything(), .fn = str_to_lower) |> \n  rename(hr = hoursperdaycombined) |> \n  filter(subcategory %in% subcat_interes) |> \n  mutate(categ = subcat_trad[subcategory]) |> \n  select(categ, hr)\n\n# mundo\nmundo <- global_human_day |> \n  rename_with(.cols = everything(), .fn = str_to_lower) |> \n  rename(hr = hoursperday) |> \n  filter(subcategory %in% subcat_interes) |> \n  mutate(categ = subcat_trad[subcategory]) |> \n  select(categ, hr)\n\n# calculo la diferencia entre horas por categorías, Argentina y el mundo\n# agrego el porcentaje del día que representa c/categoría\nd1 <- bind_rows(\n  arg |> mutate(grupo = \"Argentina\"),\n  mundo |> mutate(grupo = \"Mundo\")) |> \n  pivot_wider(names_from = grupo, values_from = hr) |> \n  mutate(porcent = Argentina/24) |> \n  mutate(porcent = gt::vec_fmt_percent(porcent, decimals = 1, dec_mark = \",\", sep_mark = \"\")) |> \n  mutate(label = glue(\"<span style='font-size:30px'>{porcent}</span>\")) |> \n  rowwise() |> \n  mutate(x = max(c(Argentina, Mundo))) |> \n  mutate(categ = str_wrap(categ, width = 15))\n  \n# transformo a tabla larga para graficar\nd2 <- d1 |> \n  pivot_longer(cols = c(Argentina, Mundo), names_to = \"grupo\", values_to = \"hm\") |> \n  mutate(grupo = fct(grupo, levels = c(\"Mundo\", \"Argentina\"))) |> \n  mutate(categ = str_wrap(categ, width = 15)) |> \n  mutate(categ = fct_reorder(categ, hm))\n\n# figura ------------------------------------------------------------------\n\n# título y subtítulo\nmi_tit <- \"UN DÍA ARGENTINO\"\nmi_sub <- glue(\n  \"Más de un tercio del día la pasamos<br>descansando y durmiendo.<br><br>\n  Se comparan las horas dedicadas<br>\n  por <b style='color:{c3}'>argentinos</b> y el <b style='color:{c2}'>promedio\n  mundial</b><br>en 10 actividades cotidianas seleccionadas.<br><br>\n  Se agregan los porcentajes que cada<br>\n  actividad nos ocupa en el día.\")\n\n# figura\ng <- ggplot(d2, aes(hm, categ, color = grupo, fill = grupo)) +\n  geom_col(\n    position = position_dodge(width = .9), show.legend = FALSE, width = .1) +\n  geom_point(\n    position = position_dodge(width = .9), show.legend = FALSE, size = 4) +\n  geom_richtext(\n    data = d1, aes(x+.25, categ, label = label), inherit.aes = FALSE,\n    family = \"victor\", color = c6,\n    label.color = NA, fill = NA, hjust = 0, position = position_dodge(width = .9)) +\n  annotate(\n    geom = \"richtext\", x = 3.25, y = 2, hjust = 0, vjust = 0, label = mi_sub,\n    label.color = c7, label.margin = unit(rep(2, 4), \"lines\"), fill = c1, \n    color = c6, size = 7.5, family = \"ubuntu\") +\n  scale_x_continuous(\n    breaks = seq(1, 10, 1),\n    expand = c(0, 0),\n    limits = c(0, 10),\n    labels = scales::label_number(suffix = \"H\")) +\n  scale_color_manual(values = c(c2, c3)) +\n  scale_fill_manual(values = c(c2, c3)) +\n  coord_cartesian(clip = \"off\") +\n  labs(\n    title = mi_tit,\n    caption = mi_caption,\n    x = \"Horas diarias dedicadas a la actividad\", y = NULL) +\n  theme(\n    aspect.ratio = 1,\n    plot.margin = margin(8.25, 40, 8.25, 20),\n    plot.background = element_rect(fill = c1, color = c6, linewidth = 3),\n    plot.title = element_text(\n      family = \"taviraj\", size = 70, color = \"white\", hjust = .5,\n      margin = margin(15, 0, 5, 0)),\n    plot.title.position = \"plot\",\n    plot.caption = element_markdown(\n      color = c6, family = \"ubuntu\", hjust = 1, size = 10, \n      margin = margin(10, 0, 0, 0)),\n    panel.background = element_rect(fill = c1, color = NA),\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_line(\n      linewidth = .1, linetype = \"8f\", color = c7),\n    panel.grid.major.y = element_blank(),\n    axis.ticks = element_blank(),\n    axis.title.x = element_text(\n      family = \"ubuntu\", color = c6, size = 20, margin = margin(10, 0, 0, 0)),\n    axis.text.y = element_text(\n      size = 20, family = \"sans\", color = c6, margin = margin(0, 10, 0, 0)),\n    axis.text.x = element_text(size = 15, family = \"victor\", color = c6)\n  )\n\n# guardo\nggsave(\n  plot = g,\n  filename = \"2023/semana_37/viz.png\",\n  width = 30,\n  height = 29,\n  units = \"cm\")\n\n# abro\nbrowseURL(\"2023/semana_37/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_37/viz.png)\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}