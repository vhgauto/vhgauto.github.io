{
  "hash": "c7e9c061955a74c165176f4155f65341",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 27\"\nsubtitle: \"Figura semana 27\"\nauthor: Víctor Gauto\ndate: \"2023-07-09\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_sf, geom_richtext]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_27/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(tidytext)\nlibrary(sf)\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\n\n# fuentes -----------------------------------------------------------------\n\n# colores\nc1 <- \"#192914\"\nc2 <- \"#1E3D14\"\nc3 <- \"#E7E5CC\"\nc4 <- alpha(\"#FFCD11\", .5)\nc5 <- alpha(\"#B86092\", .5)\n\n# texto gral\nfont_add_google(name = \"Ubuntu\", family = \"ubuntu\")\n# título\nfont_add_google(name = \"STIX Two Text\", family = \"stix\")\n\n# íconos\nfont_add(\"fa-brands\", \"icon/Font Awesome 6 Brands-Regular-400.otf\")\nfont_add(\"fa-solids\", \"icon/Font Awesome 6 Free-Solid-900.otf\")\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# caption\nfuente <- glue(\"Datos: <span style='color:{c3};'><span style='font-family:mono;'>{{<b>tidytuesdayR</b>}}</span> semana 27</span>\")\nautor <- glue(\"Autor: <span style='color:{c3};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:fa-brands;'>&#xf099;</span>\")\nicon_github <- glue(\"<span style='font-family:fa-brands;'>&#xf09b;</span>\")\nusuario <- glue(\"<span style='color:{c3};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\"{fuente} {sep} {autor} {sep} {icon_github} {icon_twitter} {usuario}\")\n\n# datos -------------------------------------------------------------------\n\nbrowseURL(\"https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-07-04/readme.md\")\nhistorical_markers <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-07-04/historical_markers.csv')\n\n# sistema de coordenadas de EEUU\ncrs_eeuu <- \"+proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs\"\n\n# me interesan los cementerios de Texas\nd <- historical_markers |> \n  # filtro por Texas\n  filter(state_or_prov == \"Texas\") |> \n  # selecciono columnas de coordenadas, título y estado\n  select(title,latitude_minus_s, longitude_minus_w) |> \n  # convierto a minúscula\n  mutate(title = str_to_lower(title)) |> \n  # filtro por 'cemetery'\n  filter(str_detect(title, \"church|cemetery\")) |> \n  # divido en Iglesia / Cementerio\n  mutate(sitio = if_else(str_detect(title, \"church\"), \"Iglesia\", \"Cementerio\")) |> \n  # transformo a 'sf'\n  st_as_sf(coords = c(\"longitude_minus_w\", \"latitude_minus_s\"), crs = 4326) |> \n  # convierto a coordenadas de EEUU\n  st_transform(crs = crs_eeuu)\n\n# mapa de los estados de EEUU\nusa <- st_as_sf(maps::map(\"state\", fill = TRUE, plot = FALSE)) |> \n  # convierto a coordenadas de EEUU\n  st_transform(crs = crs_eeuu)\n\n# selecciono Texas\ntexas <- usa |> \n  filter(ID == \"texas\")\n\n# figura ------------------------------------------------------------------\n\n# cantidad de cementerios e iglesias\nn_cementerio <- length(d$sitio[d$sitio == \"Cementerio\"]) |> \n  gt::vec_fmt_number(sep_mark = \".\", dec_mark = \",\", decimals = 0)\n\nn_iglesia <- length(d$sitio[d$sitio == \"Iglesia\"]) |> \n  gt::vec_fmt_number(sep_mark = \".\", dec_mark = \",\", decimals = 0)\n\n# texto descriptivo\ntexto <- tibble(\n  x = -630000,\n  y = -2000000,\n  label = glue(\n    \"Distribución geográfica de sitios<br>\n    históricos relacionados con<br>\n    <span style='color:#B86092;'>**iglesias**</span> ({n_iglesia}) y \n    <span style='color:#FFCD11;'>**cementerios**</span> ({n_cementerio})<br>\n    en el Estado de **Texas**, EE.UU.\"))\n\n# figura\ng <- ggplot() +\n  geom_sf(data = texas, fill = c2, color = c3, linewidth = .05) +\n  geom_sf(\n    data = d, aes(color = sitio), \n    size = 4, alpha = .6, show.legend = FALSE, shape = 18) +\n  geom_richtext(\n    data = texto, aes(x = x, y = y, label = label),\n    color = \"grey90\", label.color = NA, fill = NA, size = 7, hjust = 0,\n    family = \"ubuntu\") +\n  scale_color_manual(values = c(c4, c5)) +\n  labs(caption = mi_caption) +\n  theme_void() +\n  theme(\n    # plot.margin = margin(8, 5, 8, 5),\n    plot.margin = margin(9.3, 5, 9.3, 5),\n    plot.background = element_rect(fill = c1, color = c2, linewidth = 3),\n    plot.caption = element_markdown(size = 12, color = c4, family = \"ubuntu\")\n  )\n\n# guardo\nggsave(\n    plot = g,\n    filename = \"2023/semana_27/viz.png\",\n    width = 30, \n    height = 29,\n    units = \"cm\",\n    dpi = 300\n  )\n\n# abro\nbrowseURL(\"2023/semana_27/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_27/viz.png)\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}