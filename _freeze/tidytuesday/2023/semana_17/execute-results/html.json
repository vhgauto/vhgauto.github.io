{
  "hash": "7060c3b782b2867c0f15bcca4b871a0d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 17\"\nsubtitle: \"Figura semana 17\"\nauthor: Víctor Gauto\ndate: \"2023-04-30\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_vline, geom_hline, geom_smooth, geom_richtext, geom_textbox]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_17/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(patchwork)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(ggpath)\nlibrary(glue)\n\n# fuentes -----------------------------------------------------------------\n\nfondo <- \"#2e233c\"\ncol1 <- \"#b86092\"\ncol2 <- \"#df9ed4\"\ncol3 <- \"#574571\"\n\n# título\nfont_add_google(name = \"Bonheur Royale\", family = \"royale\", db_cache = FALSE)\n# subtítulo\nfont_add_google(name = \"Anuphan\", family = \"anuphan\", db_cache = FALSE)\n# texto vertical\nfont_add_google(name = \"Cutive Mono\", family = \"cutive\", db_cache = FALSE)\n# texto horizontal\nfont_add_google(name = \"Bebas Neue\", family = \"bebas\", db_cache = FALSE)\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# íconos\nfont_add(\"fa-reg\", \"icon/Font Awesome 6 Free-Regular-400.otf\")\nfont_add(\"fa-brands\", \"icon/Font Awesome 6 Brands-Regular-400.otf\")\nfont_add(\"fa-solid\", \"icon/Font Awesome 6 Free-Solid-900.otf\")\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# caption\nfuente <- glue(\"Datos: <span style='color:{col2};'><span style='font-family:mono;'>{{<b>tidytuesdayR</b>}}</span> semana 17</span>\")\nautor <- glue(\"Autor: <span style='color:{col2};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:fa-brands;'>&#xf099;</span>\")\nicon_github <- glue(\"<span style='font-family:fa-brands;'>&#xf09b;</span>\")\nusuario <- glue(\"<span style='color:{col2};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\"{fuente} {sep} {autor} {sep} {icon_github} {icon_twitter} {usuario}\")\n\n# ícono de correr\ncorrer <- \"<span style='font-family:fa-solid;'>&#xf70c;</span>\"\n\n# datos -------------------------------------------------------------------\n\nbrowseURL(\"https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-04-25/readme.md\")\n\nwinners <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-04-25/winners.csv') |> \n  janitor::clean_names()\nlondon_marathon <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-04-25/london_marathon.csv') |> \n  janitor::clean_names()\n\n# arreglo de los datos\n# me interesa la relación entre los que inician la maratón y los que la terminan\ndatos <- london_marathon |> \n  drop_na(finishers, starters) |> \n  mutate(rel = finishers/starters*100) |> \n  filter(rel > 80) |> \n  mutate(año = year(date)) |> \n  mutate(icon = correr)\n\n# figura ------------------------------------------------------------------\n\n# texto subtítulo\nsubtitulo <- tibble(\n  año = 1995,\n  rel = 93,\n  label = glue(\n    \"La <span style='color:{col2};'>**Maratón de Londres**</span> se realiza todos \n    los años desde <span style='color:{col2};'>**{min(datos$año)}**</span>. El \n    porcentaje (<span style='color:{col2};'>**{correr}**</span>) de corredores \n    que terminan la carrera del total de participantes siempre se mantuvo sobre \n    el <span style='color:{col2};'>**90%**</span> (con excepción de la primera \n    edición). Con el pasar de los años, dicho porcentaje fue aumentando, \n    acercándose al <span style='color:{col2};'>**100%**</span>. Últimamente \n    parece haber una leve tendencia a la baja.\"))\n\n# figura\ng1 <- datos |> \n  ggplot(aes(x = año, y = rel)) +\n  # líneas verticales\n  geom_vline(\n    xintercept = seq(1980, 2020, 10), color = col3, linewidth = .15) +\n  # líneas horizontales\n  geom_hline(\n    yintercept = c(90, 100), color = col3, linewidth = 1, linetype = 2) +\n  # tendencia\n  geom_smooth(\n    method = \"loess\", formula = y ~ x, span = 2, color = col3, linewidth = .5,\n    se = FALSE, linetype = 1, lineend = \"round\") +\n  # puntos\n  geom_richtext(\n    aes(label = icon), color = col2, label.color = NA, fill = NA, size = 9) +\n  # subtítulos\n  geom_textbox(\n    data = subtitulo, aes(label = label), box.color = NA, fill = fondo, size = 9,\n    color = col1, hjust = 0, vjust = 1, family = \"anuphan\", \n    width = unit(6, \"inch\")) +\n  # ejes\n  scale_x_continuous(\n    breaks = c(1975, seq(1980, 2020, 10), 2025),\n    labels = c(\"\", seq(1980, 2020, 10), \"\"),\n    limits = c(1975, 2025),\n    expand = c(0, 0)) +\n  scale_y_continuous(\n    breaks = c(90, 100),\n    limits = c(88, 100),\n    labels = scales::label_number(\n      big.mark = \".\", decimal.mark = \",\", suffix = \"%\"),\n    expand = c(0, 0)) +\n  coord_cartesian(clip = \"off\") +\n  labs(title = \"Corre, Londres, Corre\", x = NULL, y = NULL, caption = mi_caption) +\n  # temas\n  theme_minimal() +\n  theme(\n    aspect.ratio = 2,\n    plot.margin = margin(14, 25, 29, 25),\n    plot.background = element_rect(\n      fill = fondo, color = col1, linewidth = 3),\n    plot.title.position = \"plot\",\n    plot.title = element_markdown(\n      size = 120, color = col2, family = \"royale\", hjust = .5,\n      margin = margin(10, 0, 20, 0)),\n    plot.caption = element_markdown(\n      color = col1, size = 20, hjust = -6.6, margin = margin(25, 0, 0, 0)),\n    axis.text = element_markdown(color = col1),\n    axis.text.x = element_markdown(\n      margin = margin(25, 0, 0, 0), family = \"bebas\", size = 60),\n    axis.text.y = element_markdown(vjust = .5, family = \"cutive\",  size = 35),\n    panel.grid = element_blank()\n  )\n\n# guardo\nggsave(\n  plot = g1,\n  filename = \"2023/semana_17/viz.png\",\n  width = 30,\n  height = 61,\n  units = \"cm\",\n  dpi = 300)\n\n# abro\nbrowseURL(\"2023/semana_17/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_17/viz.png)\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}