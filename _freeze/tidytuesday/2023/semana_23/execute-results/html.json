{
  "hash": "dec196a7f1312360af0493d3eab25598",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 23\"\nsubtitle: \"Figura semana 23\"\nauthor: Víctor Gauto\ndate: \"2023-06-11\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_textpath, geom_richtext, geom_textbox]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_23/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(geomtextpath)\nlibrary(glue)\nlibrary(showtext)\nlibrary(ggtext)\n\n# fuentes -----------------------------------------------------------------\n\n# colores\nc1 <- \"#183471\"\nc2 <- \"#43429B\"\nc3 <- \"#DF9ED4\"\nc4 <- \"#EACC62\"\nc5 <- \"#7EC5F4\"\nc6 <- \"#FFCD11\"\nc7 <- \"grey90\"\n\n# años, eje horizontal\nfont_add_google(name = \"Bebas Neue\", family = \"bebas\", db_cache = TRUE)\n# eje vertical\nfont_add_google(name = \"Inconsolata\", family = \"inconsolata\", db_cache = FALSE)\n# resto del texto\nfont_add_google(name = \"Ubuntu\", family = \"ubuntu\", db_cache = FALSE)\n# título\nfont_add_google(name = \"Yeseva One\", family = \"yeseva\", db_cache = FALSE)\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# íconos\nfont_add(\"fa-brands\", \"icon/Font Awesome 6 Brands-Regular-400.otf\")\n\n# caption\nfuente <- glue(\"Datos: <span style='color:{c3};'><span style='font-family:mono;'>{{<b>tidytuesdayR</b>}}</span> semana 23</span>\")\nautor <- glue(\"Autor: <span style='color:{c3};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:fa-brands;'>&#xf099;</span>\")\nicon_github <- glue(\"<span style='font-family:fa-brands;'>&#xf09b;</span>\")\nusuario <- glue(\"<span style='color:{c3};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\"{fuente} {sep} {autor} {sep} {icon_github} {icon_twitter} {usuario}\")\n\n# datos -------------------------------------------------------------------\n\nbrowseURL(\"https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-06-06/readme.md\")\n\nenergia <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-06-06/owid-energy.csv')\n\n# limpio los datos, enfocándome en el mundo y Argentina, renovable y fósiles\nd <- energia |> \n  # filtro por Argentina y el mundo\n  filter(country %in% c(\"Argentina\", \"World\")) |> \n  # selecciono energías renovables y fósiles\n  select(year, country, renewables_energy_per_capita, fossil_energy_per_capita) |> \n  # tabla larga\n  pivot_longer(cols = -c(year, country)) |> \n  # remuevo NA\n  drop_na(value) |> \n  # acomodo los nombres\n  mutate(name = str_remove(name, \"_energy_per_capita\")) |>\n  mutate(name = str_replace(name, \"_\", \" \")) |>\n  # traduzco\n  mutate(country = case_match(country, \"World\" ~ \"Mundo\", .default = country)) |> \n  # agrego justificación horizontal p/usar en la figura (geom_textpath)\n  mutate(hjust = case_when(\n    country == \"Argentina\" & name == \"fossil\" ~ .9,\n    country == \"Argentina\" & name == \"renewables\" ~ .3,\n    country == \"Mundo\" & name == \"fossil\" ~ .42,\n    country == \"Mundo\" & name == \"renewables\" ~ .01))\n\n# figura ------------------------------------------------------------------\n\n# {geomtextpath} \nbrowseURL(\"https://github.com/AllanCameron/geomtextpath\")\n\n# título\nti <- tibble(\n  year = 1969,\n  value = 11000,\n  label = \"Argentina sigue la tendencia<br>energética mundial\")\n\n# subtítulo\nsu <- tibble(\n  year = 1969,\n  value = 8500,\n  label = glue(\n    \"El consumo energético per cápita de <b style='color:{c3};'>combustibles fósiles</b>\n    se mantiene aún por encima de las <b style='color:{c4};'>energías renovables</b>. \n    **Argentina** tiene una evolución energética que se asemeja a los valores \n    medios mundiales.\"))\n\n# figura\ng <- ggplot(data = d, aes(x = year, y = value, color = name, linetype = country)) +\n  # líneas y texto\n  geom_textpath(\n    aes(label = glue(\"**{country}**\"), hjust = I(hjust)),\n    vjust = -0.2, show.legend = FALSE, text_smoothing = 30, family = \"ubuntu\",\n    size = 7, linewidth = 1, rich = TRUE, lineend = \"round\") +\n  # título\n  geom_richtext(\n    data = ti, aes(x = year, y = value, label = label), inherit.aes = FALSE,\n    fill = NA, label.color = NA, color = c7, size = 14, show.legend = FALSE,\n    hjust = 0, vjust = 1, family = \"yeseva\") +\n  # subtítulo\n  geom_textbox(\n    data = su, aes(x = year, y = value, label = label), inherit.aes = FALSE,\n    fill = NA, box.color = NA, color = c7, size = 6, show.legend = FALSE,\n    hjust = 0, vjust = 1, family = \"ubuntu\", width = unit(20, \"cm\")) +\n  # ejes\n  scale_x_continuous(\n    breaks = seq(1960, 2021, 10), limits = c(1965, 2021), expand = c(0, 1)) +\n  scale_y_continuous(\n    breaks = seq(0, 20e3, 5e3), limits = c(-250, 21e3), expand = c(0, 0),\n    labels = scales::label_number(scale = .001)) +\n  scale_color_manual(guide = \"none\", values = c(c3, c4)) +\n  scale_linetype_manual(name = NULL, values = c(\"solid\", \"dotted\")) +\n  coord_cartesian(clip = \"off\") +\n  labs(x = NULL, y = \"Consumo energético, miles de kW-h per cápita\",\n       caption = mi_caption) +\n  # tema\n  theme_minimal() +\n  theme(\n    aspect.ratio = 1,\n    plot.margin = margin(5, 12, 5, 12),\n    plot.background = element_rect(fill = c1, color = c2, linewidth = 3),\n    plot.caption = element_markdown(\n      color = c7, hjust = .436, size = 11, margin = margin(20, 0, 3, 0)),\n    axis.text.x = element_text(color = c5, family = \"bebas\", size = 30),\n    axis.text.y = element_text(color = c5, family = \"inconsolata\", size = 20),\n    axis.title.y = element_text(\n      color = c5, family = \"ubuntu\", size = 15, margin = margin(0, 10, 0, 0)),\n    panel.grid.major = element_line(color = c2, linewidth = .1),\n    panel.grid.minor = element_blank(),\n  )\n\n# guardo\nggsave(\n  plot = g,\n  filename = \"2023/semana_23/viz.png\",\n  width = 30,\n  height = 30,\n  units = \"cm\",\n  dpi = 300)\n\n# abro\nbrowseURL(\"2023/semana_23/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_23/viz.png)\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}