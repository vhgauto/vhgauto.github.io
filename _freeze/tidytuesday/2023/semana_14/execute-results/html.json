{
  "hash": "1b629334c8c35b5d90f4dd6f1f9e44ef",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 14\"\nsubtitle: \"Figura semana 14\"\nauthor: Víctor Gauto\ndate: \"2023-04-09\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_segment, geom_label, geom_text, geom_richtext]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_14/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\nPremier League.\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(here)\nlibrary(glue)\nlibrary(patchwork)\nlibrary(showtext)\nlibrary(fontawesome)\nlibrary(ggtext)\n\n# fuentes -----------------------------------------------------------------\n\nfont_add(family = \"radikal\", regular = here(\"fuente/Nootype - Radikal.otf\")) # títulos\nfont_add_google(name = \"Share Tech Mono\", family = \"share\") # números\nfont_add_google(name = \"Heebo\", family = \"heebo\") # resto del texto\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# íconos\nfont_add(\"fa-reg\", \"icon/Font Awesome 5 Free-Regular-400.otf\")\nfont_add(\"fa-brands\", \"icon/Font Awesome 5 Brands-Regular-400.otf\")\nfont_add(\"fa-solid\", \"icon/Font Awesome 5 Free-Solid-900.otf\")\n\n# caption\nicon_twitter <- \"<span style='font-family:fa-brands; color:#e50312;'>&#xf099;</span>\"\nicon_github <- \"<span style='font-family:fa-brands; color:#e50312;'>&#xf09b;</span>\"\nfuente <- \"<span style='color:#e50312;'>Datos:</span> <span style='color:#ffee01;'><span style='font-family:mono;'>{**tidytuesdayR**}</span> semana 14</span>\"\nautor <- \"<span style='color:#e50312;'>Autor:</span> <span style='color:#ffee01;'>**Víctor Gauto**</span>\"\nsep <- glue(\"<span style = 'color:#e50312;'>**|**</span>\")\nusuario <- glue(\"<span style = 'color:#ffee01;'>**vhgauto**</span>\")\n\nmi_caption <- glue(\"{fuente} {sep} {autor} {sep} {icon_github} {icon_twitter} {usuario}\")\n\n# datos -------------------------------------------------------------------\n\nbrowseURL(glue(\"https://github.com/rfordatascience/tidytuesday/blob/master/data/\n               2023/2023-04-04/readme.md\"))\n\nfutbol <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-04-04/soccer21-22.csv')\n\nfutbol <- futbol |> \n  janitor::clean_names()\n\n# por árbitro -------------------------------------------------------------\n\ndatos_ref <- futbol |> \n  select(referee, ay, ar, hy, hr) |> \n  group_by(referee) |> \n  summarise(ay = sum(ay),\n            ar = sum(ar),\n            hy = sum(hy),\n            hr = sum(hr)) |> \n  ungroup() |> \n  mutate(AMARILLA = hy + ay,\n         ROJA = hr + ar) |> \n  mutate(tot_tar = AMARILLA + ROJA) |> \n  select(-ay, -ar, -hy, -hr) |> \n  left_join(count(futbol, referee), by = \"referee\") |> \n  mutate(\n    AMARILLA = AMARILLA/n,\n    ROJA = ROJA/n,\n    tot_tar = tot_tar/n\n  ) |> \n  select(-n) |> \n  pivot_longer(cols = AMARILLA:ROJA,\n               values_to = \"valor\",\n               names_to = \"tarjeta\") |> \n  select(referee, tarjeta, valor, tot_tar) |> \n  mutate(tarjeta = factor(tarjeta, levels = c(\"ROJA\", \"AMARILLA\"))) |> \n  pivot_wider(names_from = tarjeta,\n              values_from = valor) |> \n  mutate(ROJA_x = ROJA) |> \n  mutate(AMARILLA_x = AMARILLA) |> \n  mutate(across(AMARILLA:ROJA, ~ format(round(.x, 1), nsmall = 1))) |> \n  mutate(referee = fct_reorder(referee, AMARILLA)) |> \n  mutate(ROJA = str_replace(ROJA, \"0\", \"\"))\n\n# por equipos -------------------------------------------------------------\n\nlocal_tar <- futbol |>\n  select(home_team, hy, hr) |>\n  group_by(equipo = home_team) |>\n  summarise(AMARILLA = sum(hy),\n            ROJA = sum(hr))\n\nvisit_tar <- futbol |>\n  select(away_team, ay, ar) |>\n  group_by(equipo = away_team) |>\n  summarise(AMARILLA = sum(ay),\n            ROJA = sum(ar))\n\npath_logos <- \"2023/semana_14/logo_png/\"\n\ndatos_equ <- bind_rows(local_tar,\n                       visit_tar) |>\n  group_by(equipo) |>\n  summarise(AMARILLA = sum(AMARILLA),\n            ROJA = sum(ROJA)) |>\n  pivot_longer(cols = AMARILLA:ROJA,\n               values_to = \"valor\",\n               names_to = \"tarjeta\") |>\n  group_by(equipo) |>\n  mutate(tot_tar = sum(valor)) |>\n  ungroup() |>\n  mutate(tarjeta = factor(tarjeta, levels = c(\"ROJA\", \"AMARILLA\"))) |>\n  # mutate(equipo = fct_reorder(equipo, tot_tar)) |> \n  pivot_wider(names_from = tarjeta,\n              values_from = valor) |> \n  mutate(equipo_png = glue(\"{equipo}.png\")) |> \n  mutate(equipo_label = glue(\"<img src='{paste0(path_logos, {equipo_png})}' width='30'>\")) |> \n  mutate(equipo = fct_reorder(equipo, AMARILLA)) |> \n  mutate(equipo_label = fct_reorder(equipo_label, AMARILLA)) \n\n# figuras -----------------------------------------------------------------\n\n# parámetros de la figura\ntamaño_tarjeta <- 7\ntamaño_nro <- 8\ndesp_equ <- 9\ndesp_ref <- .45\nlogo_a <- \"2023/semana_14/logo_a.png\"\nlogo_r <- \"2023/semana_14/logo_r.png\"\n\n# tema p/ambas figuras\ntheme_set(\n  theme_minimal() +\n    theme(aspect.ratio = 3,\n          text = element_text(color = \"white\"),\n          axis.text.y.left = element_markdown(color = \"white\", family = \"radikal\",\n                                     size = 19, margin = margin(5, 20, 5, 5)),\n          axis.text.x = element_blank(),\n          axis.title.x = element_text(family = \"heebo\", size = 20, \n                                      hjust = .5, margin = margin(5, 0, 5, 40)),\n          plot.background = element_rect(fill = NA, color = NA),\n          plot.title = element_text(hjust = .5, size = 20,\n                                    family = \"radikal\"),\n          panel.background = element_rect(fill = NA, color = NA),\n          panel.grid = element_blank()\n    )\n)\n\n# figura EQUIPOS\ng_equ <- ggplot(data = datos_equ, aes(y = equipo)) +\n  # linea punteada\n  geom_segment(aes(x = ROJA + 17, xend = AMARILLA - 6, yend = equipo), \n               color = \"white\", linetype = 2, linewidth = .25) +\n  # tarjeta ROJA\n  geom_label(aes(x = ROJA, label = \" \"), color = \"#e50312\", \n             fill = \"#e50312\", size = tamaño_tarjeta, hjust = 0) +\n  geom_text(aes(x = ROJA, label = ROJA), color = \"#e50312\", \n            size = tamaño_nro,\n            nudge_x = desp_equ, hjust = 0, family = \"share\") +\n  # tarjeta AMARILLA\n  geom_label(aes(x = AMARILLA, label = \" \"), color = \"#ffee01\", \n             fill = \"#ffee01\", size = tamaño_tarjeta, hjust = 0) +\n  geom_text(aes(x = AMARILLA, label = AMARILLA), color = \"#ffee01\",\n            size = tamaño_nro,\n            nudge_x = desp_equ, hjust = 0, family = \"share\") +\n  # logo equipos\n  geom_richtext(aes(x = -15, y = equipo, label = equipo_label), fill = NA, \n                color = NA, size = 6) +\n  # manual\n  scale_x_continuous(limits = c(-20, 117), expand = c(0, 0)) +\n  scale_y_discrete(labels = (x) str_to_upper(x)) +\n  scale_fill_manual(breaks = c(\"AMARILLA\", \"ROJA\"),\n                    values = c(\"#ffee01\", \"#e50312\")) +\n  coord_cartesian(clip = \"off\") +\n  # ejes\n  labs(x = \"Cantidad total de tarjetas\",\n       y = NULL) \n\n# figura ÁRBITROS\ng_ref <- ggplot(data = datos_ref, aes(y = referee,)) +\n  # linea punteada\n  geom_segment(aes(x = ROJA_x + 1.1, xend = AMARILLA_x - .3, yend = referee), \n               color = \"white\", linetype = 2, linewidth = .25) +\n  # tarjeta ROJA\n  geom_label(aes(x = ROJA_x, label = \" \"), color = \"#e50312\", \n             fill = \"#e50312\", size = tamaño_tarjeta, hjust = 0) +\n  geom_text(aes(x = ROJA_x, label = ROJA), color = \"#e50312\",\n            size = tamaño_nro,\n            nudge_x = desp_ref, hjust = 0, family = \"share\") +\n  # tarjeta AMARILLA\n  geom_label(aes(x = AMARILLA_x, label = \" \"), color = \"#ffee01\", \n             fill = \"#ffee01\", size = tamaño_tarjeta, hjust = 0) +\n  geom_text(aes(x = AMARILLA_x, label = AMARILLA), color = \"#ffee01\",\n            size = tamaño_nro,\n            nudge_x = desp_ref, hjust = 0, family = \"share\") +\n  # manual\n  scale_x_continuous(limits = c(-.1, 6), expand = c(0, 0)) +\n  scale_y_discrete(labels = (x) str_replace(x, \" \", \". \")) +\n  scale_fill_manual(breaks = c(\"AMARILLA\", \"ROJA\"),\n                    values = c(\"#ffee01\", \"#e50312\")) +\n  coord_cartesian(clip = \"off\") +\n  # ejes\n  labs(x = \"Cantidad promedio de tarjetas,npor partido\",\n       y = NULL)\n\n# figura compuesta\ng_comp <- g_equ + plot_spacer() + g_ref + \n  # distribución figuras\n  plot_layout(widths = c(.8, .2, .8)) &\n  plot_annotation(\n    title = glue(\n      \"<img src='{logo_r}' width='55'> PREMIER LEAGUE \n      <img src='{logo_a}' width='55'>\"\n      ),\n    subtitle = \"Cantidad de tarjetas <span style='color:#e50312;'>**rojas**</span> \n    y <span style='color:#ffee01;'>**amarillas**</span> en la liga inglesa de \n    fútbol, durante la<br>temporada **2021**-**2022**, por equipos (izquierda) y \n    árbitros (derecha).\",\n    caption = mi_caption,\n    theme = theme(\n      plot.title = element_markdown(\n        family = \"radikal\", size = 75, hjust = .5, color = \"white\"),\n      plot.title.position = \"plot\",\n      plot.subtitle = element_markdown(\n        color = \"white\", size = 26, family = \"heebo\", margin = margin(10, 0, 15, 0)),\n      plot.background = element_rect(fill = \"#360c3a\", color = NA),\n      plot.margin = margin(5, 12, 5, 12),\n      plot.caption = element_markdown(hjust = .5, size = 18),\n      axis.text.x = element_blank(),\n      panel.background = element_rect(fill = \"#360c3a\", color = NA),\n    )\n  )\n\n# guardo\nggsave(\n  plot = g_comp,\n  filename = here(\"2023/semana_14/viz.png\"),\n  width = 35,\n  height = 35,\n  units = \"cm\",\n  dpi = 300)\n\n# abro\nbrowseURL(here(\"2023/semana_14/viz.png\"))\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_14/viz.png)\n\n\n",
    "supporting": [
      "semana_14_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}