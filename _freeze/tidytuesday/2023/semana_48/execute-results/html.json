{
  "hash": "1643264e234acc967d77d5c32e52e8ba",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 48\"\nsubtitle: \"Figura semana 48\"\nauthor: Víctor Gauto\ndate: \"2023-12-03\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_dotplot, geom_richtext]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_48/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(datardis)\n\n# fuente ------------------------------------------------------------------\n\n# colores\ncc <- scico::scico(palette = \"devon\", n = 10)\nc1 <- cc[3]\nc2 <- cc[4]\nc3 <- cc[5]\nc4 <- cc[6]\nc5 <- cc[1]\nc6 <- cc[10]\nc7 <- cc[9]\n\n# texto gral\nfont_add_google(name = \"Ubuntu\", family = \"ubuntu\")\n# números, fechas, ranking\nfont_add_google(name = \"Victor Mono\", family = \"victor\", db_cache = FALSE)\n\n# íconos\nfont_add(\"fa-brands\", \"icon/Font Awesome 6 Brands-Regular-400.otf\")\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# caption\nfuente <- glue(\n  \"Datos: <span style='color:{c3};'><span style='font-family:mono;'>\",\n  \"{{<b>tidytuesdayR</b>}}</span> semana 48. \",\n  \"<b style='font-family:mono;'>{{datardis}}</b>, \",\n  \"**Jonathan Kitt**</span>\")\nautor <- glue(\"<span style='color:{c3};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:fa-brands;'>&#xf099;</span>\")\nicon_github <- glue(\"<span style='font-family:fa-brands;'>&#xf09b;</span>\")\nicon_mastodon <- glue(\"<span style='font-family:fa-brands;'>&#xf4f6;</span>\")\nusuario <- glue(\"<span style='color:{c3};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\n  \"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {icon_mastodon} \n  {usuario}\")\n\n# datos -------------------------------------------------------------------\n\nbrowseURL(\"https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-11-28/readme.md\")\n\n# guionistas & episodios\ndrwho_writers\ndrwho_episodes <- drwho_episodes |> \n  mutate(rating = as.numeric(rating))\n\n# me interesa el rating que tiene los guionistas que más capítulos escribieron\n\n# top 4 guinistas con más capítulos\nescritores_top <- count(drwho_writers, writer, sort = TRUE) |> \n  slice(1:4) |> \n  pull(writer)\n\n# calculo la proporción de capítulos escritos por los guionistas top\n\n# guionistas que más capítulos escribieron\nn_top_gionistas <- drwho_writers |> \n  filter(writer %in% escritores_top) |> \n  distinct(story_number) |> \n  nrow()\n\n# total de capítulos\nn_tot <- drwho_episodes |> \n  distinct(story_number) |> \n  nrow()\n\nrel <- round(n_top_gionistas/n_tot*100)\n\n# agrego las imágenes de los guionistas y acomodo respecto del número de \n# capítulos\nd <- inner_join(\n  drwho_episodes, drwho_writers, by = join_by(story_number)) |> \n  select(rating, writer) |> \n  filter(writer %in% escritores_top) |> \n  mutate(writer = fct_reorder(writer, rating)) |> \n  mutate(orden = as.numeric(writer)) |> \n  mutate(foto = glue(\"2023/semana_48/{writer}.jpg\")) |> \n  mutate(label = glue(\"**{writer}**<br><img src='{foto}' width='120'>\")) |> \n  mutate(label = fct_reorder(label, rating))\n\n# figura ------------------------------------------------------------------\n\n# logo de Doctor Who\nlogo <- \"2023/semana_48/logo.png\"\nlogo_label <- glue(\"<img src='{logo}' width='400'>\")\n\n# subtítulo\nmi_sub <- glue(\n  \"Rating (en millones de espectadores, **Reino Unido**)<br>\",\n  \"de los cuatro **guionistas** con mayor participación.<br>\",\n  \"En total escribieron el **{rel}**% de los episodios.\")\n\n# figura\ng <- ggplot(d, aes(writer, rating)) +\n  # puntos\n  geom_dotplot(\n    aes(color = writer, fill = writer), stroke = 1,\n    binaxis = \"y\", stackdir = \"center\", binwidth = .5, show.legend = FALSE) +\n  # fotos de los escritores\n  geom_richtext(\n    aes(y = 74, label = label), vjust = 1, show.legend = FALSE, size = 6,\n    fill = NA, label.color = NA, color = c6, family = \"ubuntu\") +\n  # logo Doctor Who\n  annotate(\n    geom = \"richtext\", x = .5, y = 89, hjust = .26, vjust = 0, \n    label = logo_label, fill = NA, label.color = NA) +\n  # línea horizontal en la mediana\n  stat_summary(\n    aes(color = writer), geom = \"crossbar\", fun = median, width = .6, \n    show.legend = FALSE) +\n  # valor de la mediana\n  stat_summary(aes(x = orden-.3, y = stage(rating, after_stat = median+.3),\n    label = after_stat(str_replace(median, \"\\.\", \",\"))), geom = \"text\",\n    size = 6, color = c6, hjust = 0, show.legend = FALSE,\n    fun.data = ~ round(data.frame(median = median(.x)), 1), family = \"victor\") +\n  scale_y_continuous(\n    limits = c(68, 91), expand = c(0, 0), breaks = seq(75, 90, 5)) +\n  scale_fill_manual(values = alpha(c(c1, c2, c3, c4), .3)) +\n  scale_color_manual(values = c(c1, c2, c3, c4)) +\n  labs(subtitle = mi_sub, caption = mi_caption) +\n  coord_cartesian(clip = \"off\", xlim = c(.5, 4.5), expand = FALSE) +\n  theme_void() +\n  theme(\n    aspect.ratio = 1,\n    plot.margin = margin(100, 22, 0, 22),\n    plot.background = element_rect(fill = c5, color = c1, linewidth = 3),\n    plot.subtitle = element_markdown(\n      family = \"ubuntu\", size = 20, color = c7, margin = margin(0, 0, 20, 250)),\n    plot.caption = element_markdown(\n      family = \"ubuntu\", size = 12, margin = margin(20, 5, 5, 0), color = c6),\n    panel.grid.major.y = element_line(color = c1, linetype = 2),\n    axis.text.x = element_blank(),\n    axis.text.y = element_text(\n      color = c2, family = \"victor\", vjust = 0, margin = margin(0, 20, 0, 0),\n      size = 13))\n\n# guardo\nggsave(\n  plot = g,\n  filename = \"2023/semana_48/viz.png\",\n  width = 30,\n  height = 35,\n  units = \"cm\")\n\n# abro\nbrowseURL(\"2023/semana_48/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_48/viz.png)\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}