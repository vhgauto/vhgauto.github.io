{
  "hash": "d22502dcbf636581e5bdf016cc5e769e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 40\"\nsubtitle: \"Figura semana 40\"\nauthor: Víctor Gauto\ndate: \"2023-10-08\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_point, geom_text_repel]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_40/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\nOportunidades de subvención del Gobierno de EEUU.\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(glue)\nlibrary(ggrepel)\nlibrary(ggtext)\nlibrary(showtext)\n\n# fuente ------------------------------------------------------------------\n\n# colores, Isfahan\nc1 <- \"#E3C28B\"\nc2 <- \"#AE8448\"\nc3 <- \"#175F5D\"\nc4 <- \"#4E3810\"\nc5 <- \"#054544\"\n\n# agencias, texto gral\nfont_add_google(name = \"Ubuntu\", family = \"ubuntu\")\n# ejes vertical  horizontal\nfont_add_google(name = \"Victor Mono\", family = \"victor\", db_cache = FALSE)\n# título\nfont_add_google(name = \"Lora\", family = \"lora\")\n\n# íconos\nfont_add(\"fa-brands\", \"icon/Font Awesome 6 Brands-Regular-400.otf\")\nfont_add(\"fa-solids\", \"icon/Font Awesome 6 Free-Solid-900.otf\")\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# caption\nfuente <- glue(\"Datos: <span style='color:{c3};'><span style='font-family:victor;'>{{<b>tidytuesdayR</b>}}</span> semana 40. US Government Grant Opportunities, *grants.gov*</span>\")\nautor <- glue(\"Autor: <span style='color:{c3};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:fa-brands;'>&#xf099;</span>\")\nicon_github <- glue(\"<span style='font-family:fa-brands;'>&#xf09b;</span>\")\nusuario <- glue(\"<span style='color:{c3};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {usuario}\")\n\n# datos -------------------------------------------------------------------\n\nbrowseURL(\"https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-10-03/readme.md\")\n\ngrants <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-10-03/grants.csv')\n\n# me interesa la relación entre cantidad de oportunidades de las agencias, y \n# la cantidad de dinero estimada, por oprtunidad\n\n# selecciono las 100 agencias con mayor presencia\nagencia <- grants |> \n  drop_na(estimated_funding) |> \n  count(agency_name, sort = TRUE) |> \n  slice(1:100) |> \n  pull(agency_name)\n\n# calculo el cociente entre dinero estimado y número de presentaciones\n# obtengo la distancia de cada punto respecto del origen\nd <- grants |> \n  filter(agency_name %in% agencia) |> \n  drop_na(estimated_funding) |> \n  summarise(\n    cantidad = n(),\n    tot = sum(estimated_funding),\n    .by = agency_name) |> \n  mutate(ratio = tot/cantidad) |> \n  mutate(distancia = sqrt(tot^2 + ratio^2))\n\n# puntos extremos\ne <- d |> \n  filter(\n    cantidad == max(d$cantidad) | \n      cantidad == min(d$cantidad) |\n      ratio == max(d$ratio) | ratio == min(d$ratio) |\n      distancia == max(d$distancia) | distancia == min(d$distancia)) |> \n  mutate(label = str_wrap(agency_name, width = 20)) |> \n  mutate(hjust = c())\n\n# selecciono dos casos extremos, de muchas presentaciones con poca plata,\n# y pocas presentaciones con mucha plata\nnps <- e |> \n  filter(agency_name == \"National Park Service\")\n\nnps_cantidad <- nps$cantidad |> \n  gt::vec_fmt_number(sep_mark = \".\", decimals = 0, dec_mark = \",\")\n\nnps_ratio <- nps$ratio |> \n  gt::vec_fmt_number(sep_mark = \".\", decimals = 0, dec_mark = \",\")\n\nafo <- e |> \n  filter(agency_name == \"Air Force Office of Scientific Research\")\n\nafo_cantidad <- afo$cantidad |> \n  gt::vec_fmt_number(sep_mark = \".\", decimals = 0, dec_mark = \",\")\n\nafo_ratio <- afo$ratio |> \n  gt::vec_fmt_number(sep_mark = \".\", decimals = 0, dec_mark = \",\")\n\n# figura ------------------------------------------------------------------\n\n# tpitulo & subtítulo\nmi_title <- \"Subvenciones by *grants.gov*\"\nmi_sub <- glue(\n  \"Cuantas más oportunidades de subvención ofrece un organismo del \n  Gobierno de<br>**EEUU**, menor es el monto disponible. *{nps$agency_name}* \n  presentó {nps_cantidad}<br>oportunidades de financiamiento,\n  con un valor medio de USD $*{nps_ratio}*. En cambio,<br>en solo {afo_cantidad}\n  veces, *{afo$agency_name}* ofreció USD $*{afo_ratio}*.\")\n\n# figura\ng <- d |> \n  mutate(tipo = agency_name %in% e$agency_name) |> \n  ggplot(aes(cantidad, ratio, color = tipo, alpha = tipo)) +\n  geom_point(size = 8, show.legend = FALSE) +\n  geom_text_repel(\n    data = e, aes(cantidad, ratio, label = label), inherit.aes = FALSE,\n    hjust = 0, color = c5, seed = 2024, nudge_y = .175, family = \"ubuntu\",\n    size = 5) +\n  scale_x_log10(\n    labels = scales::label_number(decimal.mark = \",\", big.mark = \".\")) +\n  scale_y_log10(\n    breaks = c(1e5, 1e6, 10e6, 100e6),\n    labels = glue(\"USD {c('0,1', '1', '10', '100')}M\")) +\n  scale_color_manual(values = c(c2, c3)) +\n  scale_alpha_manual(values = c(.7, 1)) +\n  coord_cartesian(clip = \"off\") +\n  labs(\n    title = mi_title,\n    subtitle = mi_sub,\n    x = \"# de oportunidades\",\n    y = \"$ estimado, por oportunidad\",\n    caption = mi_caption) +\n  theme_minimal() +\n  theme(\n    aspect.ratio = 1,\n    plot.margin = margin(15, 32, 15, 12),\n    plot.background = element_rect(fill = c1, color = c2, linewidth = 3),\n    plot.title = element_markdown(\n      size = 62, color = c5, family = \"lora\", hjust = .5),\n    plot.title.position = \"plot\",\n    plot.subtitle = element_markdown(\n      family = \"ubuntu\", size = 21, color = c3, margin = margin(5, 0, 25, 0),\n      lineheight = unit(1.1, \"line\"), hjust = .5),\n    plot.caption = element_markdown(color = c2, family = \"ubuntu\", size = 12),\n    axis.text = element_text(family = \"victor\", color = c4, size = 15),\n    axis.text.x = element_text(hjust = 1),\n    axis.text.y = element_text(vjust = 0),\n    axis.title.x = element_text(\n      family = \"ubuntu\", size = 22, hjust = 1, color = c5, \n      margin = margin(20, 0, 20, 0)),\n    axis.title.y = element_text(\n      family = \"ubuntu\", size = 22, hjust = 1, color = c5, \n      margin = margin(0, 20, 0, 20)),\n    panel.grid.minor = element_blank(),\n    panel.grid.major = element_line(\n      color = c2, linewidth = .3, linetype = \"8f\")\n  )\n\n# guardo\nggsave(\n  plot = g,\n  filename = \"2023/semana_40/viz.png\",\n  width = 30,\n  height = 35,\n  units = \"cm\")\n\n# abro\nbrowseURL(\"2023/semana_40/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_40/viz.png)\n\n\n",
    "supporting": [
      "semana_40_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}