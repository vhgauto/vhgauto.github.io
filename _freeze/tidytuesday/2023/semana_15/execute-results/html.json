{
  "hash": "7cbee0914b9d1c9ab55a51070e55d53d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 15\"\nsubtitle: \"Figura semana 15\"\nauthor: Víctor Gauto\ndate: \"2023-04-16\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_vline, geom_smooth, geom_segment, geom_richtext, geom_from_path]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_15/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\nProducción de huevos.\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(fontawesome)\nlibrary(showtext)\nlibrary(glue)\nlibrary(ggtext)\nlibrary(ggpath)\n\n# fuentes -----------------------------------------------------------------\n\nfont_add_google(name = \"Share Tech Mono\", family = \"share\") # rendimiento, eje y\nfont_add_google(name = \"Lato\", family = \"lato\") # resto del texto\nfont_add_google(name = \"Bebas Neue\", family = \"bebas\") # años, eje x\nfont_add_google(name = \"Merriweather\", family = \"merriweather\") # título\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# íconos\nfont_add(\"fa-reg\", \"icon/Font Awesome 5 Free-Regular-400.otf\")\nfont_add(\"fa-brands\", \"icon/Font Awesome 5 Brands-Regular-400.otf\")\nfont_add(\"fa-solid\", \"icon/Font Awesome 5 Free-Solid-900.otf\")\n\n# caption\nicon_twitter <- \"<span style='font-family:fa-brands; color:grey90;'>&#xf099;</span>\"\nicon_github <- \"<span style='font-family:fa-brands; color:grey90;'>&#xf09b;</span>\"\nfuente <- \"<span style='color:grey90;'>Datos:</span> <span style='color:gold;'><span style='font-family:mono;'>{**tidytuesdayR**}</span> semana 15</span>\"\nautor <- \"<span style='color:grey90;'>Autor:</span> <span style='color:gold;'>**Víctor Gauto**</span>\"\nsep <- glue(\"<span style = 'color:grey90;'>**|**</span>\")\nusuario <- glue(\"<span style = 'color:gold;'>**vhgauto**</span>\")\n\nmi_caption <- glue(\"{fuente} {sep} {autor} {sep} {icon_github} {icon_twitter} {usuario}\")\n\n# datos -------------------------------------------------------------------\n\nbrowseURL(\"https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-04-11/readme.md\")\n\neggproduction  <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-04-11/egg-production.csv')\n\n# acomodo datos\ndatos <- eggproduction |> \n  filter(prod_type == \"table eggs\" & prod_process == \"all\") |> \n  mutate(rendimiento = n_eggs/n_hens) |> \n  mutate(año = factor(year(observed_month))) |> \n  select(año, gallina = n_hens, huevo = n_eggs, rendimiento)\n\n# valores mínimos 2017-2020, todos en febrero\nflecha <- eggproduction |> \n  filter(prod_type == \"table eggs\" & prod_process == \"all\") |> \n  mutate(rendimiento = n_eggs/n_hens) |> \n  mutate(año = factor(year(observed_month))) |> \n  group_by(año) |> \n  slice_min(order_by = rendimiento, n = 1) |> \n  filter(month(observed_month) == 2) |> \n  select(año, rendimiento) |> \n  ungroup() |> \n  mutate(xend = 2:5,\n         x = 4.8,\n         yend = rendimiento - 0,\n         y = 21.95)\n\n# figura ------------------------------------------------------------------\n\ng <- ggplot(data = datos, aes(x = año, y = rendimiento)) +\n  # verticales\n  geom_vline(xintercept = 1.5:5.5, color = \"grey30\", linewidth = .1) +\n  # tendencia\n  geom_smooth(aes(x = as.numeric(año), y = rendimiento), linewidth = 4,\n              color = \"gold\",\n              inherit.aes = FALSE, se = FALSE, formula = y ~ x, method = \"lm\") +\n  # flechas\n  geom_segment(data = flecha, aes(x = x, xend = xend, y = y, yend = yend),\n               color = \"grey40\", linewidth = .5, alpha = 1) +\n  geom_richtext(aes(x = 4.8, y = 21.95, \n                    label = \"Los valores más bajos<br>de **rendimiento** se<br>\n                    dieron en febrero por<br>**4** años consecutivos\"), \n                inherit.aes = FALSE, color = \"grey90\", size = 3.5, vjust = 1,\n                fill = \"grey10\", label.color = \"grey40\", hjust = 0, family = \"lato\") +\n  # huevo .png, jitter\n  geom_from_path(aes(path = \"2023/semana_15/egg.png\"), width = .05,\n                 position = position_jitter(width = .1, seed = 2023)) +\n  # leyenda\n  geom_richtext(aes(x = 4.5, y = 26, \n                    label = \"<img src='2023/semana_15/egg.png' width='10'> = Rendimiento mensual\"),\n                color = \"grey90\", fill = NA, inherit.aes = FALSE, hjust = 0,\n                label.color = NA, vjust = 0, size = 3.7, family = \"lato\") +\n  # manual\n  scale_y_continuous(breaks = seq(21, 26, 1),\n                     limits = c(20.75, 26),\n                     expand = c(0, 0)) +\n  scale_x_discrete(breaks = 2016:2021,\n                   labels = glue(\"'{16:21}\")) +\n  coord_cartesian(clip = \"off\") +\n  # ejes\n  labs(x = NULL, y = \"Rendimiento\",\n       title = \"Año a año, las <span style='color:gold;'>gallinas</span><br>ponen \n       más huevo(s)\",\n       subtitle = \"La tendencia (línea <span style='color:gold;'>**amarilla**</span>) \n       muestra que el rendimiento de huevos de mesa en **Estados Unidos** se ha \n       incrementado levemente. Se entiende el **rendimiento** como la cantidad de huevos \n       que pone una gallina, por mes.\",\n       caption = mi_caption) +\n  theme_minimal() +\n  theme(\n    aspect.ratio = 1,\n    axis.text.x = element_text(\n      family = \"bebas\", size = 27, color = \"gold\", margin = margin(0, 0, 20, 0)),\n    axis.text.y = element_text(family = \"share\", size = 13, color = \"gold\"),\n    axis.title.y = element_text(color = \"gold\", family = \"lato\", size = 16),\n    plot.background = element_rect(fill = \"grey10\", color = \"gold\", linewidth = 2),\n    plot.title = element_markdown(\n      family = \"merriweather\", size = 40, margin = margin(10, 0, 5, 0),\n      color = \"grey90\"),\n    plot.title.position = \"plot\",\n    plot.subtitle = element_textbox_simple(\n      size = 12, family = \"lato\", margin = margin(10, 0, 25, 0),\n      color = \"grey90\"),\n    plot.caption = element_markdown(\n      hjust = .3, size = 9, margin = margin(0, 0, 5, 0)),\n    plot.margin = margin(5, 17, 5, 17),\n    panel.background = element_rect(fill = \"grey10\", color = NA),\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_blank(),\n    panel.grid.major.y = element_line(color = \"grey30\", linewidth = .2)\n  )\n\n# guardo\nggsave(plot = g,\n       filename = \"2023/semana_15/viz.png\",\n       width = 2000,\n       height = 2700,\n       units = \"px\",\n       dpi = 300)\n\n# abro\nbrowseURL(\"2023/semana_15/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_15/viz.png)\n\n\n",
    "supporting": [
      "semana_15_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}