{
  "hash": "d6fdc819649fda43b3b53c1a9d2fc39f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 16\"\nsubtitle: \"Figura semana 16\"\nauthor: Víctor Gauto\ndate: \"2023-04-23\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_sf, geom_label_repel]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_16/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\nAlimentación del período Neolítico.\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(ggrepel)\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(fontawesome)\n\n# fuentes -----------------------------------------------------------------\n\nfont_add_google(name = \"Poltawski Nowy\", family = \"poltawski\", db_cache = FALSE) # título\nfont_add_google(name = \"Anuphan\", family = \"anuphan\", db_cache = FALSE) # resto del texto\nfont_add_google(name = \"Share Tech Mono\", family = \"share\", db_cache = FALSE) # coordenadas\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# íconos\nfont_add(\"fa-reg\", \"icon/Font Awesome 5 Free-Regular-400.otf\")\nfont_add(\"fa-brands\", \"icon/Font Awesome 5 Brands-Regular-400.otf\")\nfont_add(\"fa-solid\", \"icon/Font Awesome 5 Free-Solid-900.otf\")\n\n# caption\nicon_twitter <- \"<span style='font-family:fa-brands;'>&#xf099;</span>\"\nicon_github <- \"<span style='font-family:fa-brands;'>&#xf09b;</span>\"\nfuente <- \"Datos: <span style='color:#a41400;'><span style='font-family:mono;'>{**tidytuesdayR**}</span> semana 16</span>\"\nautor <- \"Autor: <span style='color:#a41400;'>**Víctor Gauto**</span>\"\nsep <- glue(\"**|**\")\nusuario <- glue(\"<span style='color:#a41400;'>**vhgauto**</span>\")\n\nmi_caption <- glue(\"{fuente} {sep} {autor} {sep} {icon_github} {icon_twitter} {usuario}\")\n\n# datos -------------------------------------------------------------------\n\nbrowseURL(\"https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-04-18/readme.md\")\n\nfounder_crops <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-04-18/founder_crops.csv')\n\n# convierto las coordenadas a sf\nfounder_crops_sf <- st_as_sf(founder_crops,\n                             coords = c(\"longitude\", \"latitude\"),\n                             crs = st_crs(4326))\n\n# mapa del mundo\nworld <- rnaturalearth::ne_countries(scale = \"medium\", returnclass = \"sf\")\n\n# región de interés, bbox de la base de datos\nl <- st_bbox(founder_crops_sf) |> \n  st_as_sfc() |> \n  st_as_sf()\n\n# evito errores al recortar el mapa del mundo\nsf_use_s2(FALSE)\n\n# recorto el mapa del mundo a la base de datos\nworld_subset <- st_crop(world, l)\n\n# me interesan las ubicaciones y 'comestibilidad', solo tomo datos únicos\n# incluye 'Edible seed/fruit'\nsub <- founder_crops_sf |> \n  drop_na(edibility) |> \n  distinct(geometry, edibility) |>  \n  mutate(edibility2 = fct_lump_n(f = edibility, n = 3))\n\n# remuevo la categoría que se repite en TODOS los puntos (Edible seed/fruit)\n# conservo las restantes, elijo las 3 más frecuentes y lump el resto\nsub2 <- founder_crops_sf |> \n  # remuevo NA\n  drop_na(edibility) |> \n  # mantengo ubicaciones únicas\n  distinct(geometry, edibility) |> \n  # remuevo la categoría que se repite en todas las ubicaciones\n  filter(edibility != \"Edible seed/fruit\") |> \n  # lump categorías poco frecuentes\n  mutate(edibility2 = fct_lump_n(\n    f = edibility, \n    n = 3, \n    ties.method = \"first\",\n    other_level = \"Otros\")) |>\n  # traduzco\n  mutate(edibility2 = case_match(\n    edibility2,\n    \"leaves, stems\" ~ \"Hoja, tallo\",\n    \"flowers, stems\" ~ \"Flor, tallo\",\n    \"leaves, root\" ~ \"Hoja, raíz\", \n    .default = edibility2))\n\n# categoría Otros\nsub3 <- sub2 |> \n  filter(edibility2 == \"Otros\") |> \n  mutate(edibility = case_match(\n    edibility,\n    \"stems\" ~ \"Tallo\",\n    \"rhizomes, stems and leaves,\" ~ \"Rizoma, tallo, hoja\",\n    \"bulbs\" ~ \"Bulbo\",\n    \"flowers\" ~ \"Flor\",\n    \"leaves\" ~ \"Hoja\",\n    .default = edibility))\n\n# figura ------------------------------------------------------------------\n\n# función p/colorear palabras\nf_c <- function(x) {\n  glue(\"<span style='color:#a41400'>**{x}**</span>\")\n}\n\n# figura\ng1 <- sub2 |> \n  ggplot() +\n  # mundo\n  geom_sf(data = world_subset, fill = \"grey90\", color = \"grey20\", \n          linewidth = .2, linetype = 2) +\n  # todos los puntos\n  geom_sf(data = sub |> select(-edibility2),\n          color = \"#007e2e\", alpha = 1, size = 1) +\n  # puntos de las facetas\n  geom_sf(alpha = .8, color = \"#a41400\", size = 3, show.legend = TRUE) +\n  # otros\n  geom_label_repel(\n    data = sub3,\n    aes(label = edibility, geometry = geometry),\n    color = \"#59386c\",\n    label.size = 0,\n    label.padding = unit(.1, \"line\"),\n    fill = alpha(\"white\", .75),\n    stat = \"sf_coordinates\",\n    force = 7,\n    size = 4.25,\n    family = \"anuphan\",\n    max.overlaps = 20,\n    min.segment.length = 0) +\n  # manual\n  coord_sf(expand = FALSE, clip = \"off\") +\n  labs(x = NULL, y = NULL, \n       title = \"Dieta neolítica\",\n       subtitle = glue(\n         \" {f_c('Flores')}, {f_c('tallos')}, {f_c('hojas')}, {f_c('raíces')}, \n         {f_c('bulbos')} y {f_c('rizomas')} eran parte de la dieta de nuestros \n         antepasados. Se muestra la distribución geográfica de estas partes \n         comestibles de las plantas en el **sudoeste asiático**. En todos los \n         paneles se indican las ubicaciones de \n         <span style='color:#007e2e'>**semillas**</span> y \n         <span style='color:#007e2e'>**frutas**</span>.\"),\n       caption = mi_caption) +\n  # faceta\n  facet_wrap(~ edibility2, ncol = 2, nrow = 2) +\n  # tema\n  theme_minimal() +\n  theme(\n    plot.background = element_rect(\n      fill = \"#e7e5cc\", color = \"#59386c\", linewidth = 2),\n    plot.title.position = \"panel\",\n    plot.title = element_markdown(\n      size = 65, family = \"poltawski\", color = \"#59386c\"),\n    plot.subtitle = element_textbox_simple(\n      size = 16, family = \"anuphan\", color = \"#59386c\", \n      margin = margin(10, 0, 10, 0)),\n    plot.caption = element_markdown(\n      size = 12, hjust = .46, family = \"anuphan\", margin = margin(15, 0, 5, 0),\n      color = \"#59386c\"),\n    plot.margin = margin(5, 10, 0, 10),\n    strip.text = element_markdown(\n      family = \"anuphan\", size = 16, color = \"#59386c\", face = \"bold\"),\n    axis.text = element_markdown(family = \"share\", size = 12, color = \"#59386c\"),\n    axis.ticks = element_line(color = \"#59386c\"),\n    panel.grid = element_blank(),\n    panel.ontop = TRUE,\n    panel.background = element_rect(fill = NA, color = \"#59386c\", linewidth = .3),\n    panel.spacing.x = unit(1, \"line\"),\n    panel.spacing.y = unit(1.25, \"line\"))\n\n# guardo\nggsave(\n  plot = g1,\n  filename = \"2023/semana_16/viz.png\",\n  width = 30,\n  height = 27.37,\n  units = \"cm\",\n  dpi = 300)\n\n# abro\nbrowseURL(\"2023/semana_16/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_16/viz.png)\n\n\n",
    "supporting": [
      "semana_16_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}