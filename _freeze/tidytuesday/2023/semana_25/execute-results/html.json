{
  "hash": "b9de76c018786bcda34b1c98604b581f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 25\"\nsubtitle: \"Figura semana 25\"\nauthor: Víctor Gauto\ndate: \"2023-06-25\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_text_wordcloud_area]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_25/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paqute ------------------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(glue)\nlibrary(tidytext)\nlibrary(ggwordcloud)\nlibrary(ggtext)\nlibrary(showtext)\n\n# fuentes -----------------------------------------------------------------\n\n# colores\nc1 <- \"#341648\"\nc2 <- \"#05A3BD\"\nc3 <- \"#FFD352\"\nc4 <- \"#621F5E\"\n\n# texto gral\nfont_add_google(name = \"Ubuntu\", family = \"ubuntu\", db_cache = FALSE)\n\n# fuente del título\nfont_add(\"starseeds\", \"fuente/Starseeds.ttf\")\n\n# íconos\nfont_add(\"fa-brands\", \"icon/Font Awesome 6 Brands-Regular-400.otf\")\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# caption\nfuente <- glue(\"Datos: <span style='color:{c3};'><span style='font-family:mono;'>{{<b>tidytuesdayR</b>}}</span> semana 25</span>\")\nautor <- glue(\"Autor: <span style='color:{c3};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:fa-brands;'>&#xf099;</span>\")\nicon_github <- glue(\"<span style='font-family:fa-brands;'>&#xf09b;</span>\")\nusuario <- glue(\"<span style='color:{c3};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\"{fuente} {sep} {autor} {sep} {icon_github} {icon_twitter} {usuario}\")\n\n# datos -------------------------------------------------------------------\n\nbrowseURL(\"https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-06-20/readme.md\")\n\nufo_sightings <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-06-20/ufo_sightings.csv')\n\n# figura ------------------------------------------------------------------\n\n# palabras comunes p/remover del listado de las descripciones (summary)\npalabras_comunes <- c(tm::stopwords(\"en\"), 1:100, \"seen\", \"saw\", \"pd\", \"nuforc\")\n\n# obtengo las palabras individuales\novni_palabras <- ufo_sightings |> \n  # conservo summary\n  select(summary) |> \n  # separo p/palabra\n  unnest_tokens(word, summary) |> \n  # remuevo las palabras comunes\n  anti_join(tibble(word = palabras_comunes), by = join_by(word)) |> \n  # arreglo algunas palabras manualmente\n  mutate(word = case_match(\n    word,\n    \"lights\" ~ \"light\",\n    \"objects\" ~ \"object\", \n    \"shaped\" ~ \"shape\",\n    .default = word)\n  )\n\n# top de palabras más frecuentes\nn_ovni <- 40\n\n# función p/generar la paleta de colores\nf_color <- colorRampPalette(MetBrewer::met.brewer(palette_name = \"Egypt\"))\n\n# colores\novni_color <- f_color(n = n_ovni)\n\n# tibble con las 'n_top_tit' palabras más frecuentes\novni_conteo <- ovni_palabras |> \n  # cuento la cantidad de palabras\n  count(word, sort = TRUE) |> \n  # conservo sólo el top\n  slice_max(n, n = n_ovni, with_ties = FALSE) |> \n  # agrego color, aleatoriamente\n  mutate(color = sample(ovni_color)) |> \n  # agrego el ángulo, con 40% de probabilidad de rotación de 90°\n  mutate(angle = 90 * sample(c(0, 1), n(), replace = TRUE, prob = c(60, 40))) |> \n  # convierto a mayúscula\n  mutate(word = str_to_upper(word))\n\n# rotación de las palabras\nbrowseURL(\"https://lepennec.github.io/ggwordcloud/articles/ggwordcloud.html#word-cloud-and-rotation\")\n\n# cantidad de reportes, p/el subtítulo\nnro <- nrow(ufo_sightings) |> \n  format(big.mark = \".\", decimal.mark = \",\")\n\n# figura de un OVNI\nbrowseURL(\"https://www.svgrepo.com/svg/480707/ufo-sucking-up-something\")\n\novni <- \"2023/semana_25/ovni.png\"\n\n# imagen p/tag\novni_tag <- glue(\"<img src='{ovni}' width='40'></img>\")\n\n# figura\ng_nube_tit <- ggplot(data = ovni_conteo) + \n  # palabras\n  geom_text_wordcloud_area(\n    aes(label = word, size = n, \n        color = I(color),\n        angle = angle),\n    seed = 2023, \n    shape = \"square\", \n    area_corr = TRUE) +\n  scale_size_area(max_size = 80) +\n  coord_cartesian(clip = \"off\") +\n  labs(\n    title = \"OVNIS\",\n    subtitle = glue(\n      \"Nube de palabras a partir de las descripciones aportadas\n      por quienes avistaron OVNIs.<br>Se analizaron {nro} testimonios en todo \n      el mundo.\"),\n    tag = ovni_tag,\n    caption = mi_caption) +\n  theme_void() +\n  theme(\n    aspect.ratio = 1,\n    plot.background = element_rect(fill = c1, color = c4, linewidth = 3),\n    plot.title = element_markdown(\n      size = 150, family = \"starseeds\", color = c3, hjust = .5,\n      margin = margin(5, 0, 15, 0)),\n    plot.title.position = \"plot\",\n    plot.subtitle = element_markdown(\n      color = c2, size = 20, family = \"ubuntu\", hjust = .5),\n    plot.tag.position = c(.9, .83),\n    plot.tag = element_markdown(),\n    plot.caption.position = \"plot\",\n    plot.caption = element_markdown(\n      color = c2, hjust = 1, family = \"ubuntu\", size = 13),\n    plot.margin = margin(5, 14, 5, 14)\n  )\n\n# guardo\nggsave(\n  plot = g_nube_tit,\n  filename = \"2023/semana_25/viz.png\",\n  width = 30, height = 35,\n  units = \"cm\", dpi = 300)\n\n# abro\nbrowseURL(\"2023/semana_25/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_25/viz.png)\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}