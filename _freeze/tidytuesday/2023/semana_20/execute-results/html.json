{
  "hash": "e252f9f308995fcd4b47ad2052d0eeba",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 20\"\nsubtitle: \"Figura semana 20\"\nauthor: Víctor Gauto\ndate: \"2023-05-21\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_tile]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_20/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(showtext)\nlibrary(ggtext)\nlibrary(glue)\n\n# fuente ------------------------------------------------------------------\n\n# eje vertical, años\nfont_add_google(name = \"Bebas Neue\", family = \"bebas\")\n# eje horizontal, meses\nfont_add_google(name = \"Inconsolata\", family = \"inconsolata\")\n# título\nfont_add_google(name = \"Gloock\", family = \"gloock\", db_cache = FALSE)\n# resto del texto\nfont_add_google(name = \"Schibsted Grotesk\", family = \"grotesk\", db_cache = FALSE)\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# íconos\nfont_add(\"fa-brands\", \"icon/Font Awesome 6 Brands-Regular-400.otf\")\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# MetBrewer: Monet\nc1 <- \"#e3cacf\"\nc2 <- \"#c399a2\"\nc3 <- \"#9f6d71\"\nc4 <- \"#41507b\"\n\n# caption\nfuente <- glue(\"Datos: <span style='color:{c3};'><span style='font-family:mono;'>{{<b>tidytuesdayR</b>}}</span> semana 20</span>\")\nautor <- glue(\"Autor: <span style='color:{c3};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:fa-brands;'>&#xf099;</span>\")\nicon_github <- glue(\"<span style='font-family:fa-brands;'>&#xf09b;</span>\")\nusuario <- glue(\"<span style='color:{c3};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\"{fuente} {sep} {autor} {sep} {icon_github} {icon_twitter} {usuario}\")\n\n# datos -------------------------------------------------------------------\n\nbrowseURL(\"https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-05-16/readme.md\")\n\ntornados <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-05-16/tornados.csv')\n\n# sumas mensuales, desde 1960\ndatos <- tornados |> \n  group_by(yr, mo) |> \n  summarise(n = n()) |> \n  ungroup() |> \n  filter(yr >= 1960)\n\n# iniciales de los meses, para el eje x\nm <- tibble(x = seq(ymd(20200101), ymd(20201201), by = \"1 month\")) |> \n  mutate(m = format(x, \"%B\")) |> \n  mutate(mes = str_sub(m, 1, 1) |> str_to_upper())\n\n# mes con la mayor cantidad de tornados\nmax_n <- datos |>\n  slice_max(order_by = n)\n\nfecha_max <- ymd(glue(\"{max_n$yr}-{max_n$mo}-01\"))\n\n# figura ------------------------------------------------------------------\n\n# breaks\nb <- classInt::classIntervals(var = datos$n, n = 6, style = \"pretty\")$brks\n\n# figura\ng <- ggplot(data = datos, aes(x = mo, y = yr, fill = n)) +\n  # tile\n  geom_tile(\n    color = c1, linewidth = 1) +\n  # manual\n  scale_y_continuous(\n    breaks = seq(1950, 2020, 10),\n    sec.axis = dup_axis()) +\n  scale_x_continuous(\n    breaks = seq(1, 12, 1),\n    labels = m$mes,\n    sec.axis = dup_axis()) +\n  scale_fill_viridis_c(\n    option = \"turbo\",\n    breaks = b) +\n  coord_fixed(ylim = c(1960, 2022), expand = FALSE, clip = \"off\") +\n  # ejes\n  labs(x = NULL, y = NULL, fill = \"Cantidadnde eventosnpor mes\",\n       title = \"TWISTER!\",\n       subtitle = glue(\n         \"Cantidad mensual de **tornados** en EEUU, entre 1950 y 2022. El mes \n         con mayor cantidad de eventos fue en {format(fecha_max, '%B')} de \n         {format(fecha_max, '%Y')} con **{max_n$n}** tornados.\"),\n       caption = mi_caption) +\n  # tema\n  theme_minimal() +\n  theme(\n    plot.background = element_rect(\n      fill = c1, color = c2, linewidth = 3),\n    plot.margin = margin(0, 55, 0, 55),\n    plot.title.position = \"plot\",\n    plot.title = element_text(\n      color = c4, family = \"gloock\", size = 135, hjust = .5, \n      margin = margin(10, 0, 0, 0)),\n    plot.subtitle = element_textbox_simple(\n      color = c4, size = 30, family = \"grotesk\",\n      margin = margin(5, -10, 25, -40)),\n    plot.caption = element_markdown(\n      color = c4, hjust = .19, size = 21, family = \"grotesk\", \n      margin = margin(20, 0, 5, 0)),\n    panel.grid = element_blank(),\n    axis.text.y = element_text(\n      color = c3, family = \"bebas\", size = 45),\n    axis.text.x = element_text(\n      color = c3, family = \"inconsolata\", size = 40),\n    axis.text.x.bottom = element_text(\n      margin = margin(15, 0, 0, 0), face = \"bold\"),\n    axis.text.x.top = element_text(\n      margin = margin(0, 0, 15, 0), face = \"bold\"),\n    legend.box.margin = margin(0, 0, 0, 80),\n    legend.title = element_text(\n      colour = c4, size = 30, family = \"grotesk\"),\n    legend.text = element_text(\n      color = c4, size = 35, family = \"inconsolata\"),\n    legend.key.height = unit(3.5, \"cm\"),\n    legend.key.width = unit(2, \"cm\")\n  )\n\n# guardo\nggsave(\n  plot = g,\n  filename = \"2023/semana_20/viz.png\",\n  width = 30,\n  height = 75,\n  units = \"cm\",\n  dpi = 300)\n\n# abro\nbrowseURL(\"2023/semana_20/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_20/viz.png)\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}