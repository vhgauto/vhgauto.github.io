{
  "hash": "6117c2d137d2eca1ae0021e7897a964a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 12\"\nsubtitle: \"Figura semana 12\"\nauthor: Víctor Gauto\ndate: \"2023-03-26\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_segment, geom_point, geom_label]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_12/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(showtext)\nlibrary(here)\nlibrary(ggtext)\nlibrary(glue)\nlibrary(fontawesome)\n\n# fuentes -----------------------------------------------------------------\n\nfont_add_google(name = \"Share Tech Mono\", family = \"share\") # nombres de programas\nfont_add_google(name = \"Heebo\", family = \"heebo\") # resto del texto\nfont_add_google(name = \"Roboto Mono\", family = \"roboto\") # título\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# íconos\nfont_add(\"fa-reg\", here(\"icon/Font Awesome 5 Free-Regular-400.otf\"))\nfont_add(\"fa-brands\", here(\"icon/Font Awesome 5 Brands-Regular-400.otf\"))\nfont_add(\"fa-solid\", here(\"icon/Font Awesome 5 Free-Solid-900.otf\"))\n\n# Sys.getenv(\"GITHUB_PAT\")\n# Sys.unsetenv(\"GITHUB_PAT\")\n\n# funciones ---------------------------------------------------------------\n\n# función p/agregar el punto de las unidades de mil\nf_punto <- scales::label_number(big.mark = \".\", decimal.mark = \",\")\n\n# función p/escribir en mono, en blanco\nf_code <- function(x) {\n  glue(\"<span style='font-family:share; color:white'>{x}</span>\")\n}\n\n# datos -------------------------------------------------------------------\n\n# browseURL(\"https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-03-21/readme.md\")\ndatos_raw <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-03-21/languages.csv')\n\nglimpse(datos_raw)\n\ndatos_raw |> \n  drop_na(line_comment_token) |> \n  count(line_comment_token, sort = TRUE)\n\n# selecciono y renombro\ndatos_sub <- datos_raw |> \n  select(title, line_comment_token, wikipedia_daily_page_views, appeared) |> \n  drop_na()\n\n# escribo los datos y leo\n# write_tsv(datos_saved, here(\"2023/semana 12/datos_saved.tsv\"))\n# datos_saved <- read_tsv(here(\"2023/semana 12/datos_saved.tsv\"))\n\n# datos p/la figura\ndatos <- datos_sub |> \n  group_by(line_comment_token) |> \n  slice_max(wikipedia_daily_page_views, n = 10) |> \n  mutate(suma = sum(wikipedia_daily_page_views)) |> \n  arrange(desc(suma), desc(wikipedia_daily_page_views)) |> \n  ungroup() |> \n  slice(1:50) |> \n  rename(nombre = title, comentario = line_comment_token, \n         visitas = wikipedia_daily_page_views, año = appeared) |> \n  mutate(nombre = fct_inorder(nombre)) |> \n  mutate(nombre = fct_rev(nombre)) |> \n  mutate(comentario = fct_reorder(comentario, -suma)) |> \n  mutate(decada = año - (año %% 10)) |> \n  mutate(decada = factor(decada)) |> \n  mutate(suma = f_punto(x = suma)) |> \n  mutate(comentario_label = glue(\"<span style='font-size:25pt;background-color:#003354'>{comentario}<br></span><br><span style='font-size:9pt;'>{suma}<br>visitas<br>totales</span>\")) |> \n  mutate(comentario_label = fct_inorder(comentario_label))\n\n# círculo que encierra el signo del comentario\ncirculo <- datos |> \n  distinct(comentario_label) |> \n  mutate(x = 7600,\n         y = 5)\n\n# lenguaje más nuevo/viejo\nmin_max <- bind_rows(datos |> slice_max(año, n = 1),\n                     datos |> slice_min(año, n = 1))\n\n# figura ------------------------------------------------------------------\n\n# caption\nicon_twitter <- \"<span style='font-family:fa-brands; color:white;'>&#xf099;</span>\"\nicon_github <- \"<span style='font-family:fa-brands; color:white;'>&#xf09b;</span>\"\nfuente <- \"<span style='color:white;'>Datos:</span> <span style='color:#003354;'><span style='font-family:share;'>{**tidytuesdayR**}</span> semana 12</span>\"\nautor <- \"<span style='color:white;'>Autor:</span> <span style='color:#003354;'>**Víctor Gauto**</span>\"\nsep <- glue(\"<span style = 'color:#a4cac8;'>**|**</span>\")\nusuario <- glue(\"<span style = 'color:#003354;'>**vhgauto**</span>\")\n\nmi_caption <- glue(\"{fuente} {sep} {autor} {sep} {icon_github} {icon_twitter} {usuario}\")\n\n# plot\ng1 <- ggplot(data = datos, aes(x = visitas, y = nombre)) +\n  # segmentos\n  geom_segment(aes(x = 0, xend = visitas, yend = nombre), \n               linewidth = .5, color = \"#0970a5\") +\n  # puntos de cantidad de visitas\n  geom_point(aes(shape = decada), size = 1, color = \"white\", fill = \"#a4cac8\") +\n  # círculo alrededor del comentario\n  annotation_custom(grid::circleGrob(default.units=\"npc\",\n                                     x = 1.055,\n                                     y = .7,\n                                     r = .18,\n                                     gp = grid::gpar(col = \"white\", \n                                                     vjust = 0.5, \n                                                     hjust = 0.5, \n                                                     fill = \"#a4cac8\"))) +\n  # lenguajes más nuevo/viejo\n  geom_label(data = min_max[1, ], \n             aes(x = visitas+150, y = nombre, label = glue(\"El lenguaje más nuevo, {nombre}, aparece en {año} \")),\n             hjust = 0, vjust = .5, color = \"white\", family = \"mono\", size = 3,\n             fill = \"#5fb0b8\", label.size = 0, label.r = unit(0, \"line\")) +\n  geom_label(data = min_max[2, ], \n             aes(x = visitas+150, y = nombre, label = glue(\"El lenguaje más viejo, {nombre}, aparece en {año} \")),\n             hjust = 0, vjust = .5, color = \"white\", family = \"mono\", size = 3,\n             fill = \"#5fb0b8\", label.size = 0, label.r = unit(0, \"line\")) +\n  # faceta\n  facet_wrap(~ comentario_label, ncol = 1, scales = \"free\", \n             strip.position = \"right\") +\n  # manual\n  scale_x_continuous(breaks = seq(0, 7000, 1000),\n                     limits = c(0, 7500),\n                     expand = c(0, 0)) +\n  scale_shape_manual(values = c(3, 8, 21:24)) +\n  coord_cartesian(clip = \"off\") +\n  # ejes\n  labs(x = \"Visitas diarias a la entrada del lenguaje en Wikipedia\", y = NULL,\n       shape = \"Década de aparición:\",\n       title = \"Su <span style='color:white'>comentario</span> no molesta\",\n       subtitle = glue(\n         \"Cada lenguaje de programación posee un caracter especial \n         que habilita los <span style='color:white'>comentarios</span> en el \n         script. Se muestra una selección de <span style='color:white'>5</span> \n         caracteres: [{f_code('//')}], [{f_code('#')}], [{f_code('-')}], \n         [{f_code('%')}] y [{f_code(';')}] y los 10 lenguajes más populares que \n         lo utilizan, de acuerdo a la cantidad de <span style='color:white'>visitas \n         diarias</span> de sus correspondientes entradas en \n         <span style='color:white'>Wikipedia</span>. Se indica también la \n         <span style='color:white'>decada</span> de salida del lenguaje.\"),\n       caption = mi_caption) +\n  # guide\n  guides(shape = guide_legend(nrow = 1, override.aes = list(size = 3))) +\n  # tema\n  theme(aspect.ratio = .25,\n        legend.position = c(.45, 1.03),\n        legend.key.size = unit(1, \"line\"),\n        legend.text = element_text(family = \"share\"),\n        legend.title = element_text(hjust = .5, family = \"heebo\", color = \"#003354\"),\n        legend.direction = \"horizontal\",\n        legend.key = element_rect(fill = \"#5fb0b8\", color = NA),\n        legend.background = element_rect(fill = \"#5fb0b8\", color = NA),\n        plot.background = element_rect(fill = \"#5fb0b8\", color = \"white\",\n                                       linewidth = 3),\n        plot.title = element_markdown(size = 35, margin = margin(0, 5, 5, 5),\n                                      family = \"roboto\", color = \"#003354\"),\n        plot.title.position = \"plot\",\n        plot.subtitle = element_textbox_simple(margin = margin(5, 5, 30, 5),\n                                               color = \"#003354\"),\n        plot.caption = element_markdown(hjust = .5, size = 10, \n                                        margin = margin(20, 0, 0, 0)),\n        plot.caption.position = \"plot\",\n        plot.margin = margin(16.4, 16, 16.4, 16),\n        panel.grid = element_line(linewidth = .1, color = \"grey90\"),\n        panel.grid.minor = element_blank(),\n        panel.background = element_rect(fill = \"#a4cac8\", color = NA),\n        panel.grid.major.y = element_blank(),\n        axis.ticks = element_blank(),\n        axis.title.x = element_text(family = \"heebo\", color = \"#003354\",\n                                    margin = margin(5, 0, 0, 0)),\n        axis.text = element_text(family = \"share\", color = \"black\"),\n        strip.background.y = element_rect(fill = NA, color = NA),\n        strip.text.y.right = element_markdown(angle = 0, color = \"#003354\",\n                                              family = \"heebo\"))\n\n# guardo\nggsave(plot = g1,\n       filename = here(\"2023/semana 12/viz.png\"),\n       width = 19,\n       height = 27,\n       dpi = 300,\n       units = \"cm\")\n# abro\nbrowseURL(here(\"2023/semana 12/viz.png\"))\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_12/viz.png)\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}