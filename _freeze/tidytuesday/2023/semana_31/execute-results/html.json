{
  "hash": "4fb505a7b6732d97cc3dd8e65aeb1bcb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Semana 31\"\nsubtitle: \"Figura semana 31\"\nauthor: Víctor Gauto\ndate: \"2023-08-06\"\neditor_options:\n  chunk_output_type: console\ncategories: [geom_are, geom_textbox, geom_ribbon, geom_line, geom_point, geom_richtext]\nimage: https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_31/viz.png\nexecute:\n  eval: false\n  echo: true\ncode-fold: true\n---\n\n\n\n\nPorcentaje de superficie cubierta por agua en Estados de EEUU.\n\n# Script\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# paquetes ----------------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(ggrepel)\n\n# fuentes -----------------------------------------------------------------\n\n# colores, Lakota\nc1 <- \"#931E17\"\nc2 <- \"#20235B\"\nc3 <- \"#F0BE3D\"\nc4 <- \"#EDC775\"\n\n# Estados\nfont_add_google(name = \"Lato\", family = \"lato\")\n# procentajes\nfont_add_google(name = \"Victor Mono\", family = \"victor\", db_cache = FALSE)\n# título\nfont_add_google(name = \"Bree Serif\", family = \"bree\", db_cache = FALSE)\n\n# íconos\nfont_add(\"fa-brands\", \"icon/Font Awesome 6 Brands-Regular-400.otf\")\nfont_add(\"fa-solids\", \"icon/Font Awesome 6 Free-Solid-900.otf\")\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n# caption\nfuente <- glue(\"Datos: <span style='color:{c3};'><span style='font-family:mono;'>{{<b>tidytuesdayR</b>}}</span> semana 31. **List of states and territories of the United States**, Wikipedia</span>\")\nautor <- glue(\"Autor: <span style='color:{c3};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:fa-brands;'>&#xf099;</span>\")\nicon_github <- glue(\"<span style='font-family:fa-brands;'>&#xf09b;</span>\")\nusuario <- glue(\"<span style='color:{c3};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {usuario}\")\n\n# datos -------------------------------------------------------------------\n\nbrowseURL(\"https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-08-01/readme.md\")\n\nstates <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-08-01/states.csv')\n\n# por c/Estado, me interesa el porcentaje de la superficie cubierta por agua\nd <- states |> \n  transmute(estado = state, agua = water_area_km2/total_area_km2) |> \n  # me quedo con los que tengan al menos 1%\n  filter(agua >= .01) |> \n  # agrego formato a las etiquetas de los Estados\n  mutate(estado = glue(\"<span style='font-family:lato;font-size:15pt;color:white;'>{estado}</span>\")) |> \n  # ordeno de acuerdo a la fracción de agua\n  mutate(estado = fct_reorder(estado, agua)) |> \n  # convierto las fracciones a porcentajes, aplico formato\n  mutate(agua_label = gt::vec_fmt_percent(agua, decimals = 1)) |> \n  mutate(agua_label = glue(\"<span style='font-family:victor;font-size:7pt;color:{c4};'>**{agua_label}**</span>\")) |> \n  # acomodo de acuerdo a la fracción de agua\n  arrange(agua) |> \n  # agrego nro de fila, para usar como eje vertical en la figura\n  # si no, geom_are() no funciona\n  mutate(fila = row_number()) |> \n  # alterno etiquetas a izquierda y derecha de la superficie\n  mutate(\n    hjust = rep(c(1, 0), length.out = max(fila)), \n    vjust = .5\n    ) |> \n  # alterno la posición de los Estados y porcentajes en las etiquetas\n  mutate(label = if_else(\n    condition = fila %% 2 != 0,\n    true = glue(\"{agua_label} {estado}\"),\n    false = glue(\"{estado} {agua_label}\")\n  )) |> \n  # alterno espacio extra entre el punto y la etiqueta\n  mutate(extra_x = if_else(\n    condition = fila %% 2 != 0,\n    true = -.0025,\n    false = .0025\n  )) |> \n  mutate(agua_x = agua + extra_x) |> \n  # condiciones especiales para HAWAII\n  mutate(hjust = if_else(\n    condition = str_detect(label, \"Hawaii\"),\n    true = 1,\n    false = hjust\n  )) |> \n  mutate(label = if_else(\n    condition = str_detect(label, \"Hawaii\"),\n    true = glue(\"{agua_label} {estado}\"),\n    false = label\n  )) |> \n  mutate(agua_x = if_else(\n    condition = str_detect(label, \"Hawaii\"),\n    true = agua - extra_x,\n    false = agua_x\n  ))\n\n# vector con los Estados que tienen menos del 1% de agua\nultimos_estados <- states |> \n  transmute(estado = state, agua = water_area_km2/total_area_km2) |> \n  filter(agua < .01) |> \n  pull(estado) |> \n  str_flatten_comma(last = \" y \")\n\n# figura ------------------------------------------------------------------\n\n# título y \ntitulo <- \"Los Estados<br>con más agua\"\n\n# subtítulo, es conveniente hacerlo como tibble, ya que puedo usar \n# geom_textbox(), para facilitar el ancho del texto\nsubtitulo <- glue(\n  \"Se muestran los Estados de **EEUU** que poseen\n  mayor porcentaje de <b style='color:white;'>superficie cubierta por\n  agua</b>, respecto del total.<br><br>{ultimos_estados}\n  se omitieron debido a que poseen valores menores al 1%.\")\n\nsubtitulo_tbl <- tibble(\n  x = .2,\n  y = 16,\n  label = subtitulo\n)\n\n# figura\ng <- ggplot(data = d, aes(x = agua, y = fila)) +\n  # área de la derecha\n  geom_ribbon(aes(ymin=0, ymax=fila), fill = c1) +\n  # línea\n  geom_line(color = \"black\", linetype = 1, linewidth = .25) +\n  geom_line(color = \"white\", linetype = \"88\", linewidth = .25) +\n  # puntos concentricos\n  geom_point(size = 1.5, color = \"white\", shape = 19) +\n  geom_point(size = 1, color = \"black\", shape = 19) +\n  # estados y porcentajes\n  geom_richtext(\n    aes(x = agua_x, label = label, hjust = hjust, vjust = vjust), fill = NA, \n    label.r = unit(0, \"line\"), label.size = 0) +\n  # título\n  annotate(\n    geom = \"richtext\", x = .2, y = 23, hjust = 0, vjust = 1, label = titulo,\n    size = 19, fill = NA, color = c3, label.color = NA, family = \"bree\") +\n  # subtítulo\n  geom_textbox(\n    data = subtitulo_tbl, aes(x = x, y = y, label = label),\n    size = 6, fill = NA, color = c4, box.color = NA, \n    hjust = 0, vjust = 1, width = unit(13, \"cm\")) +\n  # caption\n  annotate(\n    geom = \"richtext\", x = .4, y = 2, hjust = 1, vjust = 1, label = mi_caption,\n    size = 3.5, fill = NA, color = \"white\", label.color = NA, family = \"lato\") +\n  scale_x_continuous(expand = c(0, 0), limits = c(0, max(d$agua)*1.003)) +\n  scale_y_continuous(expand = c(0, 0), limits = c(0, max(d$fila))) +\n  coord_cartesian(clip = \"off\") +\n  theme_void() +\n  theme(\n    aspect.ratio = 1,\n    plot.margin = margin(12, 0, 0, 103),\n    plot.background = element_rect(fill = c2, color = c1, linewidth = 3),\n    panel.background = element_blank(),\n    panel.grid = element_blank()\n  )\n\n# guardo\nggsave(\n  plot = g,\n  filename = \"2023/semana_31/viz.png\",\n  width = 30,\n  height = 26.8,\n  units = \"cm\")\n\n# abro\nbrowseURL(\"2023/semana_31/viz.png\")\n```\n:::\n\n\n\n\n# Figura\n\n![](https://raw.githubusercontent.com/vhgauto/tidytuesday/refs/heads/main/2023/semana_31/viz.png)\n\n\n",
    "supporting": [
      "semana_31_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}