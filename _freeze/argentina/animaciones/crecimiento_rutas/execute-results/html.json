{
  "hash": "7e332cc605ca45c8ec3c9364a1ebe40f",
  "result": {
    "engine": "knitr",
    "markdown": "---\nformat:\n  html:\n    code-fold: show\n    code-summary: \"Ocultar código\"\n    code-line-numbers: false\n    code-annotations: false\n    code-link: true\n    code-tools:\n        source: true\n        toggle: true\n        caption: \"Código\"\n    code-overflow: scroll\n    page-layout: full\neditor_options:\n  chunk_output_type: console\ncategories: [\"geom_sf\"]\nexecute:\n  eval: false\n  echo: true\n  warning: false\ntitle: \"Crecimientos de rutas\"\ndate: 2024-08-03\nauthor: Víctor Gauto\n---\n\n\n\n\nAnimación de crecimiento de rutas nacionales y provinciales, con centro en el Obelisco de Ciudad Autónoma de Buenos Aires.\n\n![Animación de crecimiento de rutas.](crecimiento_rutas.mp4)\n\n## Paquetes\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(terra)\nlibrary(tidyterra)\nlibrary(magick)\nlibrary(showtext)\nlibrary(glue)\nlibrary(ggtext)\nlibrary(ggplot2)\nlibrary(purrr)\n```\n:::\n\n\n\n\n## Estilos\n\nColores.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nc1 <- \"dodgerblue\"\nc2 <- \"violetred\"\nc3 <- \"grey95\"\nc4 <- \"grey90\"\n```\n:::\n\n\n\n\nFuentes: Ubuntu y JetBrains Mono.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfont_add(\n  family = \"ubuntu\",\n  regular = \"./fuente/Ubuntu-Regular.ttf\",\n  bold = \"./fuente/Ubuntu-Bold.ttf\",\n  italic = \"./fuente/Ubuntu-Italic.ttf\"\n)\n\nfont_add(\n  family = \"jet\",\n  regular = \"./fuente/JetBrainsMonoNLNerdFontMono-Regular.ttf\"\n)\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n```\n:::\n\n\n\n\n## Epígrafe\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfuente <- glue(\n  \"Datos: <b style='color: {c1};'>Instituto Geográfico Nacional</b>\"\n)\nautor <- glue(\"<span style='color:{c1};'>**Víctor Gauto**</span>\")\nicon_twitter <- glue(\"<span style='font-family:jet;'>&#xf099;</span>\")\nicon_instagram <- glue(\"<span style='font-family:jet;'>&#xf16d;</span>\")\nicon_github <- glue(\"<span style='font-family:jet;'>&#xf09b;</span>\")\nicon_mastodon <- glue(\"<span style='font-family:jet;'>&#xf0ad1;</span>\")\nicon_bsky <- glue(\"<span style='font-family:jet;'>&#xe28e;</span>\")\nusuario <- glue(\"<span style='color:{c1};'>**vhgauto**</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\n  \"{fuente}<br>{autor} {sep} {icon_github} {icon_twitter} {icon_instagram} \",\n  \"{icon_mastodon} {icon_bsky} {usuario}\"\n)\n```\n:::\n\n\n\n\n## Funciones\n\nLectura y transformación de sistema de coordenadas geográficas.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nf_proj <- function(v) {\n  project(vect(v), \"EPSG:5346\")\n}\n```\n:::\n\n\n\n\nGeneración y almacenamiento de mapas.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nf_gg <- function(x) {\n\n  if (x < 10) {\n    i <- paste0(\"0\", x)\n  } else {\n    i <- x\n  }\n\n  g <- ggplot() +\n    geom_spatvector(data = arg, fill = c4, color = NA) +\n    geom_spatvector(\n      data = lista_crop_pro[[x]], aes(color = \"pro\"), linewidth = .1,\n      show.legend = TRUE, key_glyph = \"path\"\n    ) +\n    geom_spatvector(\n      data = lista_crop_nac[[x]], fill = NA, aes(color = \"nac\"), linewidth = .2,\n      show.legend = TRUE, key_glyph = \"path\"\n    ) +\n    scale_color_manual(\n      breaks = c(\"nac\", \"pro\"),\n      labels = c(\"Ruta Nacional\", \"Ruta Provincial\"),\n      values = c(c1, c2)\n    ) +\n    labs(color = NULL, caption = mi_caption) +\n    guides(\n      color = guide_legend(override.aes = list(linewidth = 1))\n    ) +\n    theme_void() +\n    theme(\n      plot.background = element_rect(fill = c3, color = NA),\n      plot.caption = element_markdown(\n        family = \"ubuntu\", size = 8, color = c2, lineheight = 1.2,\n        margin = margin(b = 5)\n      ),\n      legend.text = element_text(family = \"ubuntu\"),\n      legend.position = \"inside\",\n      legend.position.inside = c(.7, .3),\n      legend.key.width = unit(20, \"pt\")\n    )\n\n  ggsave(\n    plot = g,\n    filename = paste0(\"./argentina/animaciones/crecimiento_rutas/\", i, \".png\"),\n    width = 1000,\n    height = 2084,\n    units = \"px\"\n  )\n\n  print(glue::glue(\"\\n\\n--- Figura {i} generada ---\\n\\n\"))\n}\n```\n:::\n\n\n\n\n## Datos\n\nVector de Argentina, rutas nacionales y provinciales, y coordenadas del Obelisco.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\narg <- f_proj(\"./argentina/vectores/arg_continental.gpkg\")\n\nr_nac <- f_proj(\"./argentina/vectores/extras/LíneaRed vial nacional.json\")\nr_pro <- f_proj(\"./argentina/vectores/extras/LíneaRed vial provincial.json\")\n\no <- vect(\n  data.frame(x = -58.38162, y = -34.60376), geom = c(\"x\", \"y\"),\n  crs = \"EPSG:4326\"\n) |>\n  project(\"EPSG:5346\")\n```\n:::\n\n\n\n\n## Figura\n\nLista de buffers alrededor del Obelisco, y los recortes de las rutas de cada uno.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlista_buffer_nac <- map(seq(50, 2500, 25)*1e3, ~buffer(o, .x, quadsegs = 250))\nlista_crop_nac <- map(lista_buffer_nac, ~terra::crop(r_nac, .x))\nlista_crop_pro <- map(lista_buffer_nac, ~terra::crop(r_pro, .x))\n```\n:::\n\n\n\n\nCreación de cada figura.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap(1:length(lista_buffer_nac), f_gg)\n```\n:::\n\n\n\n\n## Animación\n\nGeneración de la animación a partir de todas las figuras. El archivo de salida está en formato `.mp4`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nav::av_encode_video(\n  input = list.files(\n    path = \"./argentina/animaciones/crecimiento_rutas/\",\n    full.names = TRUE, pattern = \".png\"\n  ),\n  output = \"./argentina/animaciones/crecimiento_rutas.mp4\"\n)\n```\n:::\n\n\n\n\nElimino los mapas creados y la carpeta que los contiene.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunlink(\"./argentina/animaciones/crecimiento_rutas/\", recursive = TRUE)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}