{
  "hash": "27566a1550ff83cf1cd206821da44e53",
  "result": {
    "engine": "knitr",
    "markdown": "---\nformat:\n  html:\n    code-fold: show\n    code-summary: \"Ocultar código\"\n    code-line-numbers: false\n    code-annotations: false\n    code-link: true\n    code-tools:\n        source: true\n        toggle: true\n        caption: \"Código\"\n    code-overflow: scroll\n    page-layout: full\neditor_options:\n  chunk_output_type: console\ncategories: \"geom_sf\"\nexecute:\n  eval: false\n  echo: true\n  warning: false\ntitle: \"Plantas potabilizadoras\"\ndate: 2024-08-03\nauthor: Víctor Gauto\n---\n\n\n\n\nMapa de plantas de tratamiento de agua de Argentina.\n\n![Plantas potabilizadoras de agua activas en Argentina.](plantas_potabilizadoras.png)\n\n## Paquetes\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(glue)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(tidyverse)\n```\n:::\n\n\n\n\n## Estilos\n\nPaleta de colores.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncol <- MoMAColors::moma.colors(palette_name = \"Smith\")\nc1 <- \"#FFFFFF\"\nc2 <- \"#000000\"\n```\n:::\n\n\n\n\nFuentes: Ubuntu y JetBrains Mono.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfont_add(\n  family = \"ubuntu\",\n  regular = \"././fuente/Ubuntu-Regular.ttf\",\n  bold = \"././fuente/Ubuntu-Bold.ttf\",\n  italic = \"././fuente/Ubuntu-Italic.ttf\"\n)\n\nfont_add(\n  family = \"jet\",\n  regular = \"././fuente/JetBrainsMonoNLNerdFontMono-Regular.ttf\"\n)\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n```\n:::\n\n\n\n\n## Epígrafe\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfuente <- glue(\n  \"<b>Datos:</b> <span style='color:{col[4]};'>IGN</span>\")\nautor <- glue(\"<span style='color:{col[4]};'>Víctor Gauto</span>\")\nicon_twitter <- glue(\"<span style='font-family:jet;'>&#xeb72;</span>\")\nicon_instagram <- glue(\"<span style='font-family:jet;'>&#xf16d;</span>\")\nicon_github <- glue(\"<span style='font-family:jet;'>&#xf09b;</span>\")\nicon_mastodon <- glue(\"<span style='font-family:jet;'>&#xf0ad1;</span>\")\nusuario <- glue(\"<span style='color:{col[4]};'>vhgauto</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\n  \"{fuente} {sep} {autor} {sep} <b>{icon_github} {icon_twitter} \",\n  \"{icon_instagram} {icon_mastodon}</b> {usuario}\"\n)\n```\n:::\n\n\n\n\n## Datos\n\nVectores de las provincias con sus departamentos. Obtengo el vector de plantas potabilizadoras del [Instituto Geográfico Nacional](https://www.ign.gob.ar/NuestrasActividades/InformacionGeoespacial/CapasSIG), y conservo únicamente los que se encuentran en actividad. Asigno a cada provincia un color de la gama del azul.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndeptos <- st_read(\"argentina/vectores/dptos_continental.gpkg\") |>\n  st_transform(crs = 5346) |>\n  st_geometry()\n\ncol_pcias <- colorRampPalette(\n  c(col[5], scales::muted(col[5])), alpha = .6)(24)\n\npcias <- st_read(\"argentina/vectores/pcias_continental.gpkg\") |>\n  mutate(fill_pcias = col_pcias)\n\nv <- st_read(\n  \"argentina/vectores/extras/puntos_de_fabricacion_y_procesamiento_BH220.json\") |>\n  filter(fun == 6) |>\n  st_transform(crs = 5346)\n```\n:::\n\n\n\n\n## Figura\n\nSubtítulo y posición.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx_sub <- st_bbox(deptos)$xmax\ny_sub <- st_bbox(deptos)$ymax\n\nmi_subtitle <- glue(\n  \"En <b style='color: {c1}'>Argentina</b> hay en\",\n  \"funcionamiento <b style='color:#EF7923'>{nrow(v)}</b>\",\n  \"plantas de tratamiento\",\n  \"de agua.\",\n  .sep = \"<br>\"\n)\n```\n:::\n\n\n\n\nFigura.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ng <- ggplot() +\n  # provincias\n  geom_sf(\n    data = pcias, aes(fill = fill_pcias), linewidth = .4, color = c1,\n    show.legend = TRUE\n  ) +\n  # departamentos\n  geom_sf(\n    data = deptos, fill = NA, color = c1, linewidth = .1, linetype = \"55\"\n  ) +\n  # plantas potabilizadoras\n  geom_sf(\n    data = v, shape = 21, fill = col[4], size = 7, color = c2, alpha = .9\n  ) +\n  # subtítulo\n  annotate(\n    geom = \"richtext\", x = x_sub*.84, y = y_sub*.66, label = mi_subtitle,\n    fill = NA, label.color = NA, size = 12, color = col[4], hjust = 0,\n    family = \"ubuntu\"\n  ) +\n  scale_fill_identity() +\n  scale_shape_identity() +\n  labs(caption = mi_caption) +\n  theme_void() +\n  theme(\n    plot.margin = margin(r = 8, l = 8, t = 2),\n    plot.background = element_rect(\n      fill = col[5], color = col[2], linewidth = 3),\n    plot.caption = element_markdown(\n      family = \"jet\", color = c1, hjust = .5, size = 20,\n      margin = margin(b = 10))\n  )\n```\n:::\n\n\n\n\nGuardo.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\n  plot = g,\n  filename = \"argentina/plantas_potabilizadoras.png\",\n  width = 30,\n  height = 65,\n  units = \"cm\"\n)\n```\n:::\n",
    "supporting": [
      "plantas_potabilizadoras_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}