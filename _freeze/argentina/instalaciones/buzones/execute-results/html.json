{
  "hash": "2fb5de63f8abac6ba980346c177823dd",
  "result": {
    "engine": "knitr",
    "markdown": "---\nformat:\n  html:\n    code-fold: show\n    code-summary: \"Ocultar código\"\n    code-line-numbers: false\n    code-annotations: false\n    code-link: true\n    code-tools:\n        source: true\n        toggle: true\n        caption: \"Código\"\n    code-overflow: scroll\n    page-layout: full\neditor_options:\n  chunk_output_type: console\ncategories: [\"geom_sf\"]\nexecute:\n  eval: false\n  echo: true\n  warning: false\ntitle: \"📮 Buzones\"\ndate: 2024-04-27\nauthor: Víctor Gauto\n---\n\n\n\n\nMapa de buzones en Argentina, con detalle de la Provincia de Buenos Aires y Ciudad Autónoma de Buenos Aires.\n\n![Buzones en Argentina.](buzones.png)\n\n## Paquetes\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(glue)\nlibrary(patchwork)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(tidyverse)\n```\n:::\n\n\n\n\n## Estilos\n\nColores.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nc1 <- \"#FFCE00\"\nc2 <- \"white\"\nc3 <- \"#152663\"\nc4 <- \"#BE5660\"\n```\n:::\n\n\n\n\nFuentes: Ubuntu, JetBrains Mono y Diphylleia.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfont_add(\n  family = \"ubuntu\",\n  regular = \"././fuente/Ubuntu-Regular.ttf\",\n  bold = \"././fuente/Ubuntu-Bold.ttf\",\n  italic = \"././fuente/Ubuntu-Italic.ttf\"\n)\n\nfont_add(\n  family = \"jet\",\n  regular = \"././fuente/JetBrainsMonoNLNerdFontMono-Regular.ttf\"\n)\n\nfont_add_google(name = \"Diphylleia\", family = \"diphylleia\", db_cache = FALSE)\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n```\n:::\n\n\n\n\n## Epígrafe\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfuente <- glue(\n  \"<b>Datos:</b> <span style='color:{c1};'>@matiasprofeta</span>\n  <span style='color:{c1};'>@rescatandobuzones</span>\")\nautor <- glue(\"<span style='color:{c1};'>Víctor Gauto</span>\")\nicon_twitter <- glue(\"<span style='font-family:jet;'>&#xeb72;</span>\")\nicon_instagram <- glue(\"<span style='font-family:jet;'>&#xf16d;</span>\")\nicon_github <- glue(\"<span style='font-family:jet;'>&#xf09b;</span>\")\nicon_mastodon <- glue(\"<span style='font-family:jet;'>&#xf0ad1;</span>\")\nicon_bluesky <- glue(\"<span style='font-family:jet;'>&#xe28e;</span>\")\nusuario <- glue(\"<span style='color:{c1};'>vhgauto</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\n  \"{fuente} {sep} {autor} {sep} <b>{icon_github} {icon_twitter} \",\n  \"{icon_instagram} {icon_mastodon} {icon_bluesky}</b> {usuario}\"\n)\n```\n:::\n\n\n\n\n## Datos\n\nVectores de las provincias y sus departamentos, obtenidos del [Instituto Geográfico Nacional](https://www.ign.gob.ar/NuestrasActividades/InformacionGeoespacial/CapasSIG).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npcias <- st_read(\"argentina/vectores/pcias_continental.gpkg\") |>\n  select(provincia = NAM)\n\ndptos <- st_read(\"argentina/vectores/dptos_continental.gpkg\") |>\n  st_transform(crs = 5346) |>\n  st_make_valid() |>\n  st_crop(pcias) |>\n  select(departamento = NAM)\n```\n:::\n\n\n\n\nSelecciono la Provincia de Buenas y la Ciudad Autónoma de Buenos Aires para ver con mayor detalle. Incluyo los departamentos y comunas, respectivamente.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbsas <- pcias |>\n  filter(provincia == \"Buenos Aires\")\n\ncaba <- pcias |>\n  filter(provincia == \"Ciudad Autónoma de Buenos Aires\")\n\ndptos_bsas <- terra::crop(terra::vect(dptos), terra::vect(bsas)) |>\n  st_as_sf()\n\ndptos_caba <- filter(dptos, str_detect(departamento, \"Comuna\"))\n```\n:::\n\n\n\n\nLos buzones provienen de un [mapa en Google Maps](https://www.google.com/maps/d/u/0/viewer?mid=1sUgXir-dlyHnVkSN5EVSW_qgakk). Leo las capas del archivo `.kml`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlayers <- st_layers(\"argentina/vectores/buzones.kml\")\ncapas <- layers$name\n```\n:::\n\n\n\n\nDefino una función para la lectura de cada capa disponible y aplico.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nf_kml <- function(x) {\n  l <- st_read(\n    dsn = \"argentina/vectores/buzones.kml\",\n    layer = x) |>\n    st_transform(crs = 5346)\n\n  return(l)\n}\n\nbuzones <- map(capas, f_kml) |>\n  list_rbind() |>\n  st_as_sf() |>\n  st_geometry() |>\n  st_sf() |>\n  rename(geometry = 1) |>\n  mutate(nro = row_number())\n```\n:::\n\n\n\n\nExtraigo los buzones ubicados en Provincia de Buenos Aires y Ciudad Autónoma de Buenos Aires.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbuzones_bsas <- st_intersection(bsas, buzones)\nbuzones_caba <- st_intersection(caba, buzones)\n```\n:::\n\n\n\n\nCuento la cantidad de buzones en Provincia de Buenos Aires y Ciudad Autónoma de Buenos Aires. Para ello cuento la cantidad existente en cada departamento, luego combino con los vectores de las regiones.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncentros_dptos <- st_point_on_surface(dptos)\n\ncentros_pcias <- st_join(centros_dptos, pcias)\n\npolig_dptos <- st_join(dptos, centros_pcias) |>\n  rename(departamento = departamento.x) |>\n  select(-departamento.y)\n\nbuzones_dptos <- st_join(polig_dptos, buzones)\n```\n:::\n\n\n\n\nCantidad de buzones por región y porcentaje.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn_bsas <- buzones_dptos |>\n  filter(provincia == \"Buenos Aires\") |>\n  drop_na() |>\n  nrow()\n\nn_caba <- buzones_dptos |>\n  filter(provincia == \"Ciudad Autónoma de Buenos Aires\") |>\n  drop_na() |>\n  nrow()\n\nn_buzones <- nrow(buzones)\n\nporcentaje_bsas <- gt::vec_fmt_percent(x = n_bsas/n_buzones, decimals = 0)\nporcentaje_caba <- gt::vec_fmt_percent(x = n_caba/n_buzones, decimals = 0)\n```\n:::\n\n\n\n\n## Figura\n\nTítulo y subtítulo\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmi_title <- \"Buzones Argentinos\"\n\nmi_subtitle <- glue(\n  \"En **Argentina** hay {n_buzones} buzones. En Provincia de Buenos Aires<br>\",\n  \"se encuentra el {porcentaje_bsas}. Capital Federal posee el \",\n  \"{porcentaje_caba}.\")\n```\n:::\n\n\n\n\nIncluyo la [imagen](http://upaep.filatelia.free.fr/argentina.html) de una estampilla dedicada a los buzones, [emitida en 2011](https://www.correoargentino.com.ar/filatelia/planes-de-emisiones/emisiones-2011).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nestampilla_label <- glue(\n  \"Estampilla emitida por<br>\",\n  \"el **Correo Argentino**.<br>\",\n  \"América UPAEP-Buzones,<br>\",\n  \"2011.\")\n```\n:::\n\n\n\n\nFigura de la estampilla.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nestampilla <- ggplot() +\n  annotate(\n    geom = \"richtext\", x = 0, y = 0, fill = NA, label.color = NA, hjust = 0,\n    label = glue(\n      \"<img src='argentina/extras/buzones_estampilla.jpg' width='140'></img><br>\",\n      \"{estampilla_label}\"), family = \"ubuntu\", size = 5, color = c2) +\n  coord_cartesian(xlim = c(-.01, .01), ylim = c(-.01, .01), expand = FALSE) +\n  theme_void()\n```\n:::\n\n\n\n\nLogo del Correo Argentino.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlogo <- ggplot() +\n  annotate(\n    geom = \"richtext\", x = 0, y = 0, fill = NA, label.color = NA, hjust = 0,\n    label = glue(\n      \"<img src='argentina/extras/buzones_logo.png' width='100'></img>\")\n  ) +\n  coord_cartesian(xlim = c(-.01, .01), ylim = c(-.01, .01), expand = FALSE) +\n  theme_void()\n```\n:::\n\n\n\n\nMapa de Argentina, Provincia de Buenos Aires y Ciudad Autónoma de Buenos Aires.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ng1 <- ggplot() +\n  geom_sf(data = pcias, fill = c1, color = c2, linewidth = .5) +\n  geom_sf(\n    data = buzones, color = c3, size = 2, alpha = .6, shape = 4, stroke = 1) +\n  coord_sf(clip = \"off\") +\n  theme_void()\n\ng2 <- ggplot() +\n  geom_sf(data = dptos_bsas, fill = c1, color = c2, linewidth = .4) +\n  geom_sf(\n    data = buzones_bsas, color = c3, size = 2, alpha = .5, shape = 4,\n    stroke = 1) +\n  theme_void()\n\ng3 <- ggplot() +\n  geom_sf(data = dptos_caba, fill = c1, color = c2, linewidth = .4) +\n  geom_sf(\n    data = buzones_caba, color = c3, size = 3, alpha = .6, shape = 4,\n    stroke = 1) +\n  theme_void()\n```\n:::\n\n\n\n\nCombino los mapas de acuerdo con el `diseño` dado.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiseño <- \"\nAB\nAC\n\"\n\ng <- g1 + g2 + g3 + plot_layout(design = diseño)\n```\n:::\n\n\n\n\nCombino los mapas de las regiones con el logo de Correo Argentino y la estampilla de los buzones.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg <- g +\n  inset_element(estampilla, left = 1.2, bottom = 1.1, top = .3, right = -2.2) +\n  inset_element(logo, left = -3.25, bottom = -.95, top = .9, right = .9) +\n  plot_annotation(\n    title = mi_title,\n    subtitle = mi_subtitle,\n    caption = mi_caption,\n    theme = theme(\n      aspect.ratio = 1,\n      plot.background = element_rect(\n        fill = c4, color = c3, linewidth = 3\n      ),\n      plot.title.position = \"plot\",\n      plot.title = element_text(\n        family = \"diphylleia\", size = 80, color = c1,\n        hjust = .5, margin = margin(t = 5)\n      ),\n      plot.subtitle = element_markdown(\n        color = c2, family = \"ubuntu\", size = 20, hjust = .5,\n        lineheight = 1.3\n      ),\n      plot.caption = element_markdown(\n        color = c2, family = \"ubuntu\", size = 15,\n        margin = margin(b = 10, r = 10)\n      )\n    )\n  )\n```\n:::\n\n\n\n\nGuardo.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\n  plot = gg,\n  filename = \"argentina/instalaciones/buzones.png\",\n  width = 30,\n  height = 40,\n  units = \"cm\"\n)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}