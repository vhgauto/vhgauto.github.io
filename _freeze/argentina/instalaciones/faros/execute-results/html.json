{
  "hash": "7fe288fa6290e191c781e3765335f542",
  "result": {
    "engine": "knitr",
    "markdown": "---\nformat:\n  html:\n    anchor-sections: true\n    code-fold: show\n    code-summary: \"Ocultar código\"\n    code-line-numbers: false\n    code-annotations: false\n    code-link: true\n    code-tools:\n        source: true\n        toggle: true\n        caption: \"Código\"\n    code-overflow: scroll\n    page-layout: full\neditor_options:\n  chunk_output_type: console\ncategories: [\"geom_raster\", \"geom_point\"]\nexecute:\n  eval: false\n  echo: true\n  warning: false\ntitle: \"Faros\"\ndate: 2025-04-06\nauthor: Víctor Gauto\n---\n\n\n\n\nFaros en las costas de Argentina, con topografía como mapa base.\n\n![Faros en Argentina](faros.png)\n\n## Paquetes\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(terra)\nlibrary(ggtext)\nlibrary(showtext)\nlibrary(glue)\nlibrary(ggfx)\nlibrary(tidyverse)\n```\n:::\n\n\n\n\n## Estilos\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nc_arriba <- c(\"#131631\", \"#264775\")\nc_abajo <- c(\"#100A2C\", \"#540056\")\n\nc1 <- \"white\"\nc2 <- \"gold\"\n\nfont_add(\n  family = \"ubuntu\",\n  regular = \"././fuente/Ubuntu-Regular.ttf\",\n  bold = \"././fuente/Ubuntu-Bold.ttf\",\n  italic = \"././fuente/Ubuntu-Italic.ttf\"\n)\n\nfont_add(\n  family = \"jet\",\n  regular = \"././fuente/JetBrainsMonoNLNerdFontMono-Regular.ttf\"\n)\n\nshowtext_auto()\nshowtext_opts(dpi = 300)\n```\n:::\n\n\n\n\n## Epígrafe\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfuente <- glue(\n  \"<b>Datos: </b> <span style='color:{c1};'>IGN</span>,\n  </b> <span style='color:{c1};'>OpenTopography</span>\"\n)\nautor <- glue(\"<span style='color:{c1};'>Víctor Gauto</span>\")\nicon_twitter <- glue(\n  \"<span style='font-family:jet;'>&#xeb72;</span>\"\n)\nicon_instagram <- glue(\n  \"<span style='font-family:jet;'>&#xf16d;</span>\"\n)\nicon_github <- glue(\n  \"<span style='font-family:jet;'>&#xf09b;</span>\"\n)\nicon_mastodon <- glue(\n  \"<span style='font-family:jet;'>&#xf0ad1;</span>\"\n)\nicon_bluesky <- glue(\n  \"<span style='font-family:jet;'>&#xe28e;</span>\"\n)\nusuario <- glue(\"<span style='color:{c1};'>vhgauto</span>\")\nsep <- glue(\"**|**\")\n\nmi_caption <- glue(\n  \"{fuente}<br>{autor} {sep} <b>{icon_github} {icon_twitter} \",\n  \"{icon_instagram} {icon_mastodon} {icon_bluesky}</b> {usuario}\"\n)\n```\n:::\n\n\n\n\n## Datos\n\nVector de faros en las costas de Argentina, descargado del Instituto Geográfico Nacional (Hidrografía y oceanografía / Ayuda a la navegación / Punto / Faro).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfaro <- vect(\n  \"argentina/vectores/ayuda_a_la_navegacion_BC050.json\"\n) |>\n  project(\"EPSG:5346\")\n```\n:::\n\n\n\n\n## Elevación\n\nIncremento el contorno del vector de faros para la descarga del modelo digital de elevación.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ne1 <- ext(faro)$xmin\ne2 <- ext(faro)$xmax\ne3 <- ext(faro)$ymin\ne4 <- ext(faro)$ymax\n\nfaro_bb_elev <- vect(\n  ext(e1-8e5, e2+8e5, e3-1e5, e4+1e5), \"EPSG:5346\"\n)\nfaro_bb_elev_sf <- faro_bb_elev |>\n  sf::st_as_sf()\n```\n:::\n\n\n\n\nDescarga de datos de elevación.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nele_arg <- elevatr::get_elev_raster(\n  locations = faro_bb_elev_sf,\n  z = 5,\n  clip = \"locations\"\n) |>\n  rast() |>\n  project(\"EPSG:5346\")\n\nnames(ele_arg) <- \"altura\"\n```\n:::\n\n\n\n\nDivido los datos por arriba y abajo del nivel de 0m, así aplico dos escalas de color.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\narriba <- ele_arg\narriba[arriba<0] <- NA\n```\n:::\n\n\n\n\nPaleta de colores.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nf_arriba <- colorRampPalette(c_arriba)\npaleta_arriba <- f_arriba(length(cells(arriba)))\n```\n:::\n\n\n\n\nConvierto a `tibble` y agrego colores, de acuerdo a la altura.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\narriba_tbl <- arriba |>\n  as.data.frame(xy = TRUE) |>\n  tibble() |>\n  arrange(altura) |>\n  mutate(n = row_number()) |>\n  mutate(color = paleta_arriba[n])\n```\n:::\n\n\n\n\nAbajo, remuevo todo lo mayor a 0m.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nabajo <- ele_arg\nabajo[abajo>0] <- NA\n```\n:::\n\n\n\n\nPaleta de colores.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nf_abajo <- colorRampPalette(c_abajo)\npaleta_abajo <- f_abajo(length(cells(abajo)))\n```\n:::\n\n\n\n\nConvierto a `tibble` y agrego colores, de acuerdo a la altura.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nabajo_tbl <- abajo |>\n  as.data.frame(xy = TRUE) |>\n  tibble() |>\n  arrange(altura) |>\n  mutate(n = row_number()) |>\n  mutate(color = paleta_abajo[n])\n```\n:::\n\n\n\n\nObtengo las coordenadas de los faros.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfaro_tbl <- as.data.frame(faro, geom = \"XY\") |>\n  tibble()\n```\n:::\n\n\n\n\n## Figura\n\nRelación de aspecto del mapa.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\next_bb <- ext(faro_bb_elev)\nasp <- (ext_bb$ymax - ext_bb$ymin)/(ext_bb$xmax - ext_bb$xmin)\n```\n:::\n\n\n\n\nTamaño del mapa, en centímetros.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nancho <- 30\nalto <- ancho*asp\n```\n:::\n\n\n\n\nÍconos y subtítulo.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfaro_icon <- glue(\n  \"<span style='font-family:jet;font-size:150px;'>&#xf0a00;</span>\"\n)\nequis_icon <- \"&#xf467;\"\n\nmi_subtitle <- glue(\n  \"{faro_icon}<br>\",\n  \"{equis_icon}{length(faro)}\"\n)\n```\n:::\n\n\n\n\nFigura.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ng <- ggplot() +\n  # abajo\n  geom_raster(data = abajo_tbl, aes(x, y, fill = color)) +\n  # arriba\n  geom_raster(data = arriba_tbl, aes(x, y, fill = color)) +\n  # faros\n  with_blur(\n    geom_point(\n      data = faro_tbl, aes(x, y), color = c2, size = 6, alpha = 1\n    ),\n    sigma = 20\n  ) +\n  geom_point(\n    data = faro_tbl, aes(x, y), color = c2, size = .5, alpha = 1\n  ) +\n  # subtítulo\n  annotate(\n    geom = \"richtext\", x = ext_bb$xmax*.98, y = ext_bb$ymin*1.8,\n    label = mi_subtitle, family = \"jet\", color = c2, fill = NA,\n    size = 10, label.color = NA, hjust = 1\n  ) +\n  # epígrafe\n  annotate(\n    geom = \"richtext\", x = ext_bb$xmin*1.01, y = ext_bb$ymin*1.02,\n    label = mi_caption, family = \"ubuntu\", color = c2, fill = NA,\n    size = 5, label.color = NA, hjust = 0, vjust = 0\n  ) +\n  # cuadro\n  annotate(\n    geom = \"rect\", xmin = ext_bb$xmin, xmax = ext_bb$xmax, ymin = ext_bb$ymin,\n    ymax = ext_bb$ymax, color = c_abajo[2], linewidth = 3, fill = NA\n  ) +\n  scale_fill_identity() +\n  coord_fixed(expand = FALSE) +\n  theme_void()\n```\n:::\n\n\n\n\nGuardo la figura.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\n  plot = g,\n  filename = \"argentina/instalaciones/faros.png\",\n  width = ancho,\n  height = alto,\n  units = \"cm\"\n)\n```\n:::\n",
    "supporting": [
      "faros_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}